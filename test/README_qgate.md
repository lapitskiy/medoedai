# QGate Analyzer

Инструменты для анализа QGate фильтров и предсказаний модели.

## Проблема

QGate постоянно блокирует торговые сигналы, не давая модели торговать. Нужно понять:
- Какие пороги QGate используются
- Почему сигналы не проходят фильтрацию
- Как оптимизировать пороги для лучшей торговли

## Файлы

### `qgate_analyzer.py`
Основной класс `QGateAnalyzer` для анализа:
- Статистика Q-values (max_q, gap_q)
- Анализ фильтрации QGate по символам и времени
- Связь между уверенностью модели и успешностью торговли
- Рекомендации по оптимизации порогов

### `run_qgate_analysis.py`
Быстрый анализ за последние 3 дня:
```bash
python test/run_qgate_analysis.py
```

## Использование

### Быстрый анализ (рекомендуется)
```bash
# В Docker контейнере
docker exec medoedai python test/run_qgate_analysis.py

# Или локально
python test/run_qgate_analysis.py
```

### Полный анализ
```bash
# В Docker контейнере
docker exec medoedai python test/qgate_analyzer.py

# Или локально
python test/qgate_analyzer.py
```

## Что анализируется

1. **Q-values статистика** - средние, минимальные, максимальные значения max_q и gap_q
2. **Фильтрация QGate** - процент отфильтрованных сигналов по символам и времени
3. **Причины фильтрации** - наиболее частые причины блокировки сигналов
4. **Торговая производительность** - связь между прошедшими QGate сигналами и успешностью торговли
5. **Текущие пороги** - значения QGATE_MAXQ, QGATE_GAPQ и их SELL версий
6. **Рекомендации** - конкретные предложения по оптимизации порогов

## QGate логика

QGate блокирует сигналы если:
- `max_q < QGATE_MAXQ` (максимальный Q-value слишком низкий)
- `gap_q < QGATE_GAPQ` (разница между лучшим и вторым Q-value слишком мала)

Для SELL сигналов используются отдельные пороги:
- `QGATE_SELL_MAXQ`
- `QGATE_SELL_GAPQ`

## Интерпретация результатов

- **Высокая фильтрация (>80%)** - пороги слишком строгие, модель не может торговать
- **Низкая фильтрация (<10%)** - пороги слишком мягкие, пропускаются слабые сигналы
- **Низкие Q-values** - модель не уверена в предсказаниях, нужна переобучение
- **Малый gap_q** - модель не различает действия, нужна переобучение

## Рекомендации

1. **Если фильтрация >80%**: снизить пороги QGATE_MAXQ и QGATE_GAPQ
2. **Если фильтрация <10%**: повысить пороги для лучшего качества сигналов
3. **Если Q-values низкие**: переобучить модель с лучшими данными
4. **Если gap_q мал**: улучшить архитектуру модели или данные обучения
