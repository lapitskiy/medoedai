# XGB GOAL PROMPT (for future runs): 5–6%/мес с 5–10 сделками

## Цель

Мне нужно **5–10 сделок в месяц** и **0.5–1.0% (net) на сделку**. Не нужен “скальпинг 50 сделок”.

## Как мы интерпретируем метрики

- **`pred_non_hold`** (binary): частота сигналов модели (≈ доля баров со сигналом).
- **`y_non_hold`**: частота позитивного label, т.е. “сколько возможностей” в разметке.
- Для `entry_*` отбираем модели по **`prec(1)`**, затем по `f1(1)` (баланс), контролируя `pred_non_hold`.

## Какую разметку целим (entry_long / entry_short)

Разметка `entry_*`: label=1, если в окне `max_hold_steps` вообще можно было получить прибыль >= `min_profit`.

Ручки:

- `min_profit` ↑ → возможностей меньше (`y_non_hold` ↓), сигналов меньше
- `max_hold_steps` ↑ → возможностей больше (`y_non_hold` ↑)

Стартовые диапазоны под “0.5–1% и редкие входы”:

- `min_profit`: **0.006…0.012** (0.6%…1.2%)
- `max_hold_steps`: **96 / 144 / 300** (8ч / 12ч / 25ч)

## Как grid auto выбирает `grid_final` (и как включить “под цель”)

По умолчанию grid выбирает best по F1/accuracy. Чтобы best учитывал “редкие сделки”, включаем hard-фильтры:

- `XGB_GRID_TRADING_FILTER=1` — включить фильтры (только для `entry/exit` grid)
- `XGB_GRID_TARGET_TRADES_PER_MONTH=5` или `10`
- `XGB_GRID_BARS_PER_MONTH=8640` (5m бары за 30 дней)
- `XGB_GRID_TARGET_TOLERANCE=2.0` (допуск по частоте сигналов)
- `XGB_GRID_Y_NON_HOLD_MIN=0.01` и `XGB_GRID_Y_NON_HOLD_MAX=0.70` (не давать деградировать разметке)

Смысл: сперва **отфильтровать** кандидатов по `pred_non_hold/y_non_hold`, затем среди прошедших выбрать лучший по базовой метрике.
Если никто не прошёл — fallback на лучший по базовой метрике.

## Что обязательно проверять потом

Метрики классификации не гарантируют доходность. Для подтверждения 5–6%/мес нужен backtest со:

- fee/slippage,
- правилами выхода,
- риск-менеджментом и drawdown.

