<!DOCTYPE html>
<html lang="ru">
<head>
    <link rel="stylesheet" href="/static/css/styles.css">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MedoedAI - –¢–æ—Ä–≥–æ–≤—ã–π –∞–≥–µ–Ω—Ç</title>
    <style>
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üí∞ –¢–æ—Ä–≥–æ–≤—ã–π –∞–≥–µ–Ω—Ç</h1>
            <p>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–æ—Ä–≥–æ–≤–ª–µ–π –Ω–∞ —Ä–µ–∞–ª—å–Ω–æ–º —Ä—ã–Ω–∫–µ —á–µ—Ä–µ–∑ –æ–±—É—á–µ–Ω–Ω—É—é –º–æ–¥–µ–ª—å DQN</p>
        </div>

        <div class="content">
            <!-- –ö–Ω–æ–ø–∫–∞ –≤–æ–∑–≤—Ä–∞—Ç–∞ -->
            <a href="/" class="btn back-btn">‚Üê –í–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞ –≥–ª–∞–≤–Ω—É—é</a>

            <!-- –°–µ–∫—Ü–∏—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ç–æ—Ä–≥–æ–≤–ª–µ–π -->
            <div class="section">
                <h2>üéØ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–æ—Ä–≥–æ–≤–ª–µ–π</h2>
                <p>–ó–∞–ø—É—Å–∫ –∏ –æ—Å—Ç–∞–Ω–æ–≤–∫–∞ —Ç–æ—Ä–≥–æ–≤–æ–≥–æ –±–æ—Ç–∞</p>
                
                <div class="form-group">
                    <label>–ê–Ω—Å–∞–º–±–ª—å –∏ –≤–µ—Ä—Å–∏–∏:</label>
                    <div style="display:grid; grid-template-columns: 1fr; gap: 12px; align-items:start;">
                        <div>
                            <label style="font-weight:600;">–°–∏–º–≤–æ–ª</label>
                            <select id="ensembleSymbolSelect" class="form-control" onchange="onEnsembleSymbolChange()">
                                <option value="BTCUSDT" selected>BTCUSDT</option>
                                <option value="ETHUSDT">ETHUSDT</option>
                                <option value="SOLUSDT">SOLUSDT</option>
                                <option value="TONUSDT">TONUSDT</option>
                                <option value="ADAUSDT">ADAUSDT</option>
                                <option value="BNBUSDT">BNBUSDT</option>
                                <option value="XMRUSDT">XMRUSDT</option>
                                <option value="XRPUSDT">XRPUSDT</option>
                            </select>
                            <label style="font-weight:600; margin-top:10px;">–ê–Ω—Å–∞–º–±–ª—å</label>
                            <select id="ensembleSelect" class="form-control" onchange="renderEnsembleVersions()">
                                <option value="ensemble-a" selected>ensemble-a</option>
                            </select>
                        </div>
                    </div>
                </div>
                <div class="form-group" style="margin-top:10px;">
                    <div id="ensembleVersions" style="max-height:320px; overflow:auto; border:1px solid #e0e0e0; border-radius:6px; padding:0;">
                        <div class="versions-table">
                            <div class="vt-row vt-head">
                                <div class="c-check">–í—ã–±.</div>
                                <div>–í–µ—Ä—Å–∏—è</div>
                                <div>–ú–æ–¥–µ–ª—å</div>
                                <div>–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</div>
                            </div>
                            <div class="vt-row">
                                <div class="c-check"><input type="checkbox" disabled></div>
                                <div>‚Äî</div>
                                <div><em>–í—ã–±–µ—Ä–∏—Ç–µ —Å–∏–º–≤–æ–ª –∏ –∞–Ω—Å–∞–º–±–ª—å</em></div>
                                <div>‚Äî</div>
                            </div>
                        </div>
                    </div>
                    <small style="color:#666; display:block; margin-top:6px;">–û—Ç–º–µ—Ç—å—Ç–µ –≥–∞–ª–æ—á–∫–∞–º–∏ –≤–µ—Ä—Å–∏–∏, –∫–æ—Ç–æ—Ä—ã–µ —É—á–∞—Å—Ç–≤—É—é—Ç –≤ –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏–∏. –ù–∏–∂–µ ‚Äî –∫—Ä–∞—Ç–∫–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞.</small>
                    <div id="ensembleVersionsStats" style="margin-top:8px;"></div>
                </div>
                
                <!-- –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∫–æ–Ω—Å–µ–Ω—Å—É—Å–∞ -->
                <div class="form-group" style="margin-top:20px; padding:15px; background:#f8f9fa; border-radius:8px; border:1px solid #e0e0e0;">
                    <label style="font-weight:600; margin-bottom:10px; display:block;">üéØ –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∫–æ–Ω—Å–µ–Ω—Å—É—Å–∞</label>
                    
                    <div style="display:grid; grid-template-columns: 1fr 1fr; gap:15px; margin-bottom:15px;">
                        <div>
                            <label style="font-weight:500; margin-bottom:5px; display:block;">–ë–æ–∫–æ–≤–∏–∫ (flat/range)</label>
                            <div style="display:flex; align-items:center; gap:8px;">
                                <input type="range" id="flatConsensus" min="50" max="100" value="80" style="flex:1;">
                                <span id="flatConsensusValue" style="font-weight:600; color:#667eea; min-width:40px;">80%</span>
                            </div>
                            <small style="color:#666;">–°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–µ: 80-90% –∏–∑ 100% –º–æ–¥–µ–ª–µ–π</small>
                        </div>
                        
                        <div>
                            <label style="font-weight:500; margin-bottom:5px; display:block;">–¢—Ä–µ–Ω–¥ (—Å–∏–ª—å–Ω—ã–π –∞–ø/–¥–∞—É–Ω)</label>
                            <div style="display:flex; align-items:center; gap:8px;">
                                <input type="range" id="trendConsensus" min="50" max="100" value="65" style="flex:1;">
                                <span id="trendConsensusValue" style="font-weight:600; color:#667eea; min-width:40px;">65%</span>
                            </div>
                            <small style="color:#666;">–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è: ‚â•60-70% –∏–∑ 100</small>
                        </div>
                    </div>
                    
                    <div style="background:white; padding:10px; border-radius:6px; border:1px solid #dee2e6;">
                        <div style="font-size:14px; color:#495057;">
                            <strong>–¢–µ–∫—É—â–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏:</strong><br>
                            ‚Ä¢ –ë–æ–∫–æ–≤–∏–∫: <span id="flatConsensusDisplay">80%</span> –º–æ–¥–µ–ª–µ–π –¥–æ–ª–∂–Ω—ã —Å–æ–≥–ª–∞—Å–∏—Ç—å—Å—è<br>
                            ‚Ä¢ –¢—Ä–µ–Ω–¥: <span id="trendConsensusDisplay">65%</span> –º–æ–¥–µ–ª–µ–π –¥–æ–ª–∂–Ω—ã —Å–æ–≥–ª–∞—Å–∏—Ç—å—Å—è
                        </div>
                    </div>
                </div>
                
                <div id="modelInfo" class="model-info" style="display: none;">
                    <h4>üìä –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –º–æ–¥–µ–ª–∏</h4>
                    <div id="modelInfoContent"></div>
                </div>
                
                
                
                <div class="button-group">
                    <button class="btn btn-success" onclick="startTrading()">
                        üöÄ –ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç–æ—Ä–≥–æ–≤–ª—é
                    </button>
                    <button class="btn btn-danger" onclick="stopTrading()">
                        üõë –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Ç–æ—Ä–≥–æ–≤–ª—é
                    </button>
                </div>
                
                <div id="tradingResult" class="status" style="display: none;"></div>
            </div>

            <!-- –°–µ–∫—Ü–∏—è —Å—Ç–∞—Ç—É—Å–∞ —Ç–æ—Ä–≥–æ–≤–ª–∏ -->
            <div class="section">
                <h2>üìä –°—Ç–∞—Ç—É—Å —Ç–æ—Ä–≥–æ–≤–ª–∏</h2>
                <p>–¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Ç–æ—Ä–≥–æ–≤–æ–≥–æ –±–æ—Ç–∞</p>
                
                <div class="button-group">
                    <button class="btn btn-info" onclick="getTradingStatus()">
                        üîç –ü–æ–ª—É—á–∏—Ç—å —Å—Ç–∞—Ç—É—Å
                    </button>
                    <button class="btn btn-info" onclick="getBalance()">
                        üí∞ –ë–∞–ª–∞–Ω—Å –Ω–∞ –±–∏—Ä–∂–µ
                    </button>
                    <button class="btn btn-warning" onclick="sendInstantOrder('buy')">
                        üß™ –¢–µ—Å—Ç–æ–≤—ã–π BUY (—Ä–µ–∞–ª—å–Ω–∞—è –ø–æ–∫—É–ø–∫–∞)
                    </button>
                    <button class="btn btn-danger" onclick="sendInstantOrder('sell')">
                        üß™ –¢–µ—Å—Ç–æ–≤—ã–π SELL (—Ä–µ–∞–ª—å–Ω–∞—è –ø—Ä–æ–¥–∞–∂–∞)
                    </button>
                </div>
                
                <div id="tradingStatus" class="trading-status" style="display: none;">
                    <h3>üìä –°—Ç–∞—Ç—É—Å —Ç–æ—Ä–≥–æ–≤–ª–∏</h3>
                    <div id="statusContent"></div>
                </div>
                
                <div id="balanceStatus" class="trading-status" style="display: none;">
                    <h3>üí∞ –ë–∞–ª–∞–Ω—Å –Ω–∞ –±–∏—Ä–∂–µ</h3>
                    <div id="balanceContent"></div>
                </div>
            </div>

            <!-- –°–µ–∫—Ü–∏—è –∏—Å—Ç–æ—Ä–∏–∏ —Ç–æ—Ä–≥–æ–≤–ª–∏ -->
            <div class="section">
                <h2>üìà –ò—Å—Ç–æ—Ä–∏—è —Ç–æ—Ä–≥–æ–≤–ª–∏</h2>
                <p>–î–µ—Ç–∞–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –≤—Å–µ—Ö —Å–¥–µ–ª–∫–∞—Ö</p>
                
                <div class="button-group">
                    <button class="btn btn-primary" onclick="getTradingHistory()">
                        üìä –ò—Å—Ç–æ—Ä–∏—è —Å–¥–µ–ª–æ–∫
                    </button>
                </div>
                
                <div id="tradingHistory" class="trading-history" style="display: none;">
                    <h3>üìà –ò—Å—Ç–æ—Ä–∏—è —Å–¥–µ–ª–æ–∫</h3>
                    <div id="historyContent"></div>
                </div>
            </div>

            <!-- –°–µ–∫—Ü–∏—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ -->
            <div class="section">
                <h2>üîç –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥</h2>
                <p>–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ –∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ —Ç–æ—Ä–≥–æ–≤–ª–∏ –∫–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç</p>
                
                <div class="button-group">
                    <button class="btn btn-info" onclick="startMonitoring()">
                        üîÑ –ó–∞–ø—É—Å—Ç–∏—Ç—å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
                    </button>
                    <button class="btn btn-warning" onclick="stopMonitoring()">
                        ‚è∏Ô∏è –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
                    </button>
                    <button class="btn btn-primary" onclick="getModelPredictions()">
                        üß† –ü—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏—è –ò–ò
                    </button>
                    <button class="btn btn-primary" onclick="getPredictionStatistics()">
                        üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–π
                    </button>
                </div>
                
                <div id="monitoringStatus" class="status info" style="display: none;">
                    –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∞–∫—Ç–∏–≤–µ–Ω - —Å—Ç–∞—Ç—É—Å –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥
                </div>
                
                <!-- –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–æ—Ä–≥–æ–≤–ª–∏ –∏–∑ Celery -->
                <div id="tradingResults" class="trading-history" style="display: none;">
                    <h3>üìä –ü–æ—Å–ª–µ–¥–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–æ—Ä–≥–æ–≤–ª–∏ (Celery)</h3>
                    <div id="tradingResultsContent"></div>
                </div>
                
                <!-- –ò—Å—Ç–æ—Ä–∏—è —Å–¥–µ–ª–æ–∫ –∏–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö -->
                <div id="tradeHistory" class="trading-history" style="display: none;">
                    <h3>üìà –ò—Å—Ç–æ—Ä–∏—è —Å–¥–µ–ª–æ–∫ (–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö)</h3>
                    <div id="tradeHistoryContent"></div>
                </div>
                
                <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Å–¥–µ–ª–æ–∫ -->
                <div id="tradeStatistics" class="trading-history" style="display: none;">
                    <h3>üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Å–¥–µ–ª–æ–∫</h3>
                    <div id="tradeStatisticsContent"></div>
                </div>
                
                <!-- –°—Ç—Ä–∞—Ç–µ–≥–∏—è –¥–ª—è –æ—Å—Ç–∞–≤—à–µ–π—Å—è –ø–æ–∑–∏—Ü–∏–∏ -->
                <div id="remainingPositionStrategy" class="trading-history" style="display: none;">
                    <h3>üéØ –°—Ç—Ä–∞—Ç–µ–≥–∏—è –¥–ª—è –æ—Å—Ç–∞–≤—à–µ–π—Å—è –ø–æ–∑–∏—Ü–∏–∏</h3>
                    <div id="remainingStrategyContent"></div>
                </div>
                
                <!-- –ü—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏—è –º–æ–¥–µ–ª–∏ -->
                <div id="modelPredictions" class="trading-history" style="display: none;">
                    <h3>üß† –ü—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏—è –º–æ–¥–µ–ª–∏ –ò–ò</h3>
                    <div id="predictionsContent"></div>
                </div>
                
                <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–π -->
                <div id="predictionStatistics" class="trading-history" style="display: none;">
                    <h3>üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–π</h3>
                    <div id="predictionStatsContent"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let monitoringInterval = null;

        let modelsData = [];
        
        // –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞—Ç—ã/–≤—Ä–µ–º–µ–Ω–∏ –≤ –º–æ—Å–∫–æ–≤—Å–∫–æ–º —á–∞—Å–æ–≤–æ–º –ø–æ—è—Å–µ
        function formatMoscowDateTime(value) {
            let date;
            if (typeof value === 'string') {
                // –ï—Å–ª–∏ —Å—Ç—Ä–æ–∫–∞ –±–µ–∑ —è–≤–Ω–æ–π –≤—Ä–µ–º–µ–Ω–Ω–æ–π –∑–æ–Ω—ã ‚Äî —Å—á–∏—Ç–∞–µ–º, —á—Ç–æ —ç—Ç–æ UTC –∏ –¥–æ–±–∞–≤–ª—è–µ–º 'Z'
                const hasTimezone = /[zZ]|[\+\-]\d{2}:?\d{2}$/.test(value);
                const isoBasic = /^\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}(?:\.\d+)?$/;
                const src = (!hasTimezone && isoBasic.test(value)) ? (value + 'Z') : value;
                date = new Date(src);
            } else if (typeof value === 'number') {
                // –û–∂–∏–¥–∞–µ–º –º–∏–ª–ª–∏—Å–µ–∫—É–Ω–¥—ã
                date = new Date(value);
            } else {
                date = value;
            }
            if (!date || isNaN(date.getTime())) return 'N/A';
            return date.toLocaleString('ru-RU', {
                timeZone: 'Europe/Moscow',
                year: 'numeric',
                month: '2-digit',
                day: '2-digit',
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit',
                hour12: false
            });
        }

        // –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Å–∏–º–≤–æ–ª–∞ –ø–æ ID –º–æ–¥–µ–ª–∏ (—ç–≤—Ä–∏—Å—Ç–∏–∫–∞)
        function guessSymbolFromModelId(modelId) {
            try {
                if (!modelId || typeof modelId !== 'string') return '';
                const base = modelId.split('_')[0] || '';
                if (!base) return '';
                const low = base.toLowerCase();
                if (['multi', 'multicrypto', '–º—É–ª—å—Ç–∏–≤–∞–ª—é—Ç–∞'].includes(low)) return 'MULTI';
                // –ï—Å–ª–∏ —É–∂–µ –∑–∞–∫–∞–Ω—á–∏–≤–∞–µ—Ç—Å—è –Ω–∞ USDT
                if (/usdt$/i.test(base)) return base.toUpperCase();
                // –ë–∞–∑–æ–≤—ã–µ —Ç–∏–∫–µ—Ä—ã
                const known = ['btc','eth','sol','ton','ada','bnb'];
                if (known.includes(low)) return low.toUpperCase() + 'USDT';
                // –û–±—â–∞—è —ç–≤—Ä–∏—Å—Ç–∏–∫–∞: –∫–æ—Ä–æ—Ç–∫–∏–π –±—É–∫–≤–µ–Ω–Ω—ã–π –ø—Ä–µ—Ñ–∏–∫—Å ‚Üí –¥–æ–±–∞–≤–∏—Ç—å USDT
                if (/^[a-z]{2,6}$/i.test(base)) return base.toUpperCase() + 'USDT';
                return base.toUpperCase();
            } catch (_) {
                return '';
            }
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ –∞–Ω—Å–∞–º–±–ª–µ–π –∏ –≤–µ—Ä—Å–∏–π
        async function onEnsembleSymbolChange() {
            const symSel = document.getElementById('ensembleSymbolSelect');
            const symbol = symSel ? (symSel.value || 'BTCUSDT') : 'BTCUSDT';
            try {
                const resp = await fetch('/list_ensembles?symbol=' + encodeURIComponent(symbol));
                const data = await resp.json();
                const ensSel = document.getElementById('ensembleSelect');
                const box = document.getElementById('ensembleVersions');
                if (!ensSel || !box) return;
                if (!data.success) {
                    ensSel.innerHTML = '<option value="">–ù–µ—Ç –∞–Ω—Å–∞–º–±–ª–µ–π</option>';
                    box.innerHTML = '<em>–ê–Ω—Å–∞–º–±–ª–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</em>';
                    return;
                }
                const names = Object.keys(data.ensembles || {});
                ensSel.innerHTML = names.length ? names.map(n => `<option value="${n}">${n}</option>`).join('') : '<option value="">–ù–µ—Ç –∞–Ω—Å–∞–º–±–ª–µ–π</option>';
                ensSel.value = names[0] || 'ensemble-a';
                ensSel.dataset.payload = JSON.stringify(data.ensembles || {});
                renderEnsembleVersions();
            } catch (e) {
                console.error('–û—à–∏–±–∫–∞ —Å–ø–∏—Å–∫–∞ –∞–Ω—Å–∞–º–±–ª–µ–π', e);
            }
        }

        function renderEnsembleVersions() {
            const ensSel = document.getElementById('ensembleSelect');
            const box = document.getElementById('ensembleVersions');
            if (!ensSel || !box) return;
            try {
                const ensembles = JSON.parse(ensSel.dataset.payload || '{}');
                const name = ensSel.value;
                const ens = ensembles[name] || { versions: [] };
                if (!ens.versions || ens.versions.length === 0) {
                    box.innerHTML = '<em>–í–µ—Ä—Å–∏–π –Ω–µ –Ω–∞–π–¥–µ–Ω–æ</em>';
                    return;
                }
                // –†–∏—Å—É–µ–º —á–µ–∫–±–æ–∫—Å—ã –≤–µ—Ä—Å–∏–π
                const header = `
                    <div class=\"vt-row vt-head\">
                        <div class=\"c-check\">–í—ã–±.</div>
                        <div>–í–µ—Ä—Å–∏—è</div>
                        <div>–ú–æ–¥–µ–ª—å</div>
                        <div>–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</div>
                    </div>`;
                const rows = ens.versions.map(v => {
                    const modelFile = v.files && v.files.model ? v.files.model : '';
                    const path = `${v.path}/${modelFile}`;
                    const id = `ver_${name}_${v.version}`;
                    const stats = v.stats || {};
                    const winrate = (typeof stats.winrate === 'number') ? (stats.winrate * 100).toFixed(1) + '%' : '‚Äî';
                    const plr = (typeof stats.pl_ratio === 'number') ? stats.pl_ratio.toFixed(2) : '‚Äî';
                    const trades = (typeof stats.trades_count === 'number') ? stats.trades_count : '‚Äî';
                    return `
                        <div class=\"vt-row\">
                            <div class=\"c-check\"><input type=\"checkbox\" class=\"verCheck\" value=\"${path}\" data-version=\"${v.version}\"></div>
                            <div><span style=\"font-weight:600;\">${v.version}</span></div>
                            <div><code>${modelFile || '‚Äî'}</code></div>
                            <div style=\"font-size:12px;color:#555;\">Winrate: ${winrate} ¬∑ P/L: ${plr} ¬∑ Trades: ${trades}</div>
                        </div>`;
                }).join('');
                box.innerHTML = `<div class=\"versions-table\">${header}${rows}</div>`;
            } catch (e) {
                box.innerHTML = '<em>–û—à–∏–±–∫–∞ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –≤–µ—Ä—Å–∏–π</em>';
            }
        }

        // –ó–∞–ø—É—Å–∫ —Ç–æ—Ä–≥–æ–≤–ª–∏
        async function startTrading() {
            const symbol = (document.getElementById('ensembleSymbolSelect')?.value) || 'BTCUSDT';
            const selectedSymbols = [symbol];
            // –°–æ–±–∏—Ä–∞–µ–º –≤—ã–±—Ä–∞–Ω–Ω—ã–µ –≤–µ—Ä—Å–∏–∏ –∏–∑ —á–µ–∫–±–æ–∫—Å–æ–≤
            const selectedPaths = Array.from(document.querySelectorAll('.verCheck:checked')).map(i => i.value).filter(Boolean);
            if (selectedPaths.length === 0) {
                showStatus('tradingResult', 'error', '–í—ã–±–µ—Ä–∏—Ç–µ —Ö–æ—Ç—è –±—ã –æ–¥–Ω—É –≤–µ—Ä—Å–∏—é –¥–ª—è –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏—è');
                return;
            }
            
            if (selectedSymbols.length === 0 || !selectedSymbols[0]) {
                showStatus('tradingResult', 'error', '–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ —Ö–æ—Ç—è –±—ã –æ–¥–Ω—É —Ç–æ—Ä–≥–æ–≤—É—é –ø–∞—Ä—É');
                return;
            }
            
            // –ü–æ–ª—É—á–∞–µ–º –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∫–æ–Ω—Å–µ–Ω—Å—É—Å–∞
            const consensusSettings = getConsensusSettings();
            
            try {
                const response = await fetch('/api/trading/start', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ 
                        symbols: selectedSymbols,
                        model_paths: selectedPaths,
                        consensus: consensusSettings
                    })
                });
                
                const result = await response.json();
                showStatus('tradingResult', result.success ? 'success' : 'error', 
                    result.success ? result.message : result.error);
                
                if (result.success) {
                    // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–ª—É—á–∞–µ–º —Å—Ç–∞—Ç—É—Å –ø–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞
                    setTimeout(getTradingStatus, 1000);
                }
            } catch (error) {
                showStatus('tradingResult', 'error', '–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ —Ç–æ—Ä–≥–æ–≤–ª–∏: ' + error.message);
            }
        }

        // –û—Å—Ç–∞–Ω–æ–≤–∫–∞ —Ç–æ—Ä–≥–æ–≤–ª–∏
        async function stopTrading() {
            try {
                const response = await fetch('/api/trading/stop', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    }
                });
                
                const result = await response.json();
                showStatus('tradingResult', result.success ? 'success' : 'error', 
                    result.success ? result.message : result.error);
                
                if (result.success) {
                    // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–ª—É—á–∞–µ–º —Å—Ç–∞—Ç—É—Å –ø–æ—Å–ª–µ –æ—Å—Ç–∞–Ω–æ–≤–∫–∏
                    setTimeout(getTradingStatus, 1000);
                }
            } catch (error) {
                showStatus('tradingResult', 'error', '–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Å—Ç–∞–Ω–æ–≤–∫–µ —Ç–æ—Ä–≥–æ–≤–ª–∏: ' + error.message);
            }
        }

        // –ü–æ–ª—É—á–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ —Ç–æ—Ä–≥–æ–≤–ª–∏
        async function getTradingStatus() {
            try {
                const response = await fetch('/api/trading/status');
                const result = await response.json();
                
                if (result.success) {
                    const statusDiv = document.getElementById('tradingStatus');
                    const contentDiv = document.getElementById('statusContent');
                    
                    let statusHTML = `
                        <p><strong>–°—Ç–∞—Ç—É—Å:</strong> ${result.trading_status_full || result.trading_status || (result.is_trading ? 'üü¢ –ê–∫—Ç–∏–≤–Ω–∞' : 'üî¥ –û—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞')}</p>
                        <p><strong>–ü–∞—Ä–∞:</strong> ${result.symbol_display || result.symbol || '–ù–µ —É–∫–∞–∑–∞–Ω–∞'}</p>
                        <p><strong>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ:</strong> ${result.amount_display || result.amount || '–ù–µ —É–∫–∞–∑–∞–Ω–æ'}</p>
                        <p><strong>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ USDT:</strong> ${result.amount_usdt ? '$' + result.amount_usdt.toFixed(2) : '–ù–µ —É–∫–∞–∑–∞–Ω–æ'}</p>
                        <p><strong>–ü–æ–∑–∏—Ü–∏—è:</strong> ${result.position ? '–û—Ç–∫—Ä—ã—Ç–∞' : '–ù–µ—Ç'}</p>
                        <p><strong>–°–¥–µ–ª–æ–∫:</strong> ${result.trades_count}</p>
                        <p><strong>–¢–µ–∫—É—â–∞—è —Ü–µ–Ω–∞:</strong> ${result.current_price ? '$' + result.current_price.toFixed(2) : '–ù–µ —É–∫–∞–∑–∞–Ω–∞'}</p>
                        ${result.last_model_prediction ? `<p><strong>–ü–æ—Å–ª–µ–¥–Ω–µ–µ –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–µ:</strong> ${result.last_model_prediction}</p>` : ''}
                    `;
                    
                    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å—Ç—Ä–∞—Ç–µ–≥–∏—é –¥–ª—è –æ—Å—Ç–∞–≤—à–µ–π—Å—è –ø–æ–∑–∏—Ü–∏–∏, –µ—Å–ª–∏ –µ—Å—Ç—å
                    if (result.position && result.position.partial_sell_strategy) {
                        showRemainingPositionStrategy(result.position.partial_sell_strategy);
                    } else {
                        // –°–∫—Ä—ã–≤–∞–µ–º —Å–µ–∫—Ü–∏—é —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏, –µ—Å–ª–∏ –Ω–µ—Ç
                        document.getElementById('remainingPositionStrategy').style.display = 'none';
                    }
                    
                    contentDiv.innerHTML = statusHTML;
                    statusDiv.style.display = 'block';
                } else {
                    showStatus('tradingResult', 'error', result.error);
                }
            } catch (error) {
                showStatus('tradingResult', 'error', '–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ —Å—Ç–∞—Ç—É—Å–∞: ' + error.message);
            }
        }

        // –ü–æ–ª—É—á–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞
        async function getBalance() {
            try {
                const response = await fetch('/api/trading/balance');
                const result = await response.json();
                
                if (result.success) {
                    const balanceDiv = document.getElementById('balanceStatus');
                    const contentDiv = document.getElementById('balanceContent');
                    
                    contentDiv.innerHTML = `
                        <p><strong>USDT:</strong> ${result.balance.USDT.toFixed(2)}</p>
                        <p><strong>BTC:</strong> ${result.balance.BTC.toFixed(8)}</p>
                    `;
                    
                    balanceDiv.style.display = 'block';
                } else {
                    showStatus('tradingResult', 'error', result.error);
                }
            } catch (error) {
                showStatus('tradingResult', 'error', '–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –±–∞–ª–∞–Ω—Å–∞: ' + error.message);
            }
        }

        // –ü–æ–ª—É—á–µ–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏–∏ —Ç–æ—Ä–≥–æ–≤–ª–∏
        async function getTradingHistory() {
            try {
                const response = await fetch('/api/trading/history');
                const result = await response.json();
                
                if (result.success) {
                    const historyDiv = document.getElementById('tradingHistory');
                    const contentDiv = document.getElementById('historyContent');
                    
                    // 1) –ü–æ–¥—Ç—è–Ω–µ–º —Ç–µ–∫—É—â—É—é –ø–æ–∑–∏—Ü–∏—é –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Ä—è–¥–æ–º —Å –∏—Å—Ç–æ—Ä–∏–µ–π
                    let positionHTML = '';
                    try {
                        const statusResp = await fetch('/api/trading/status');
                        const statusJson = await statusResp.json();
                        if (statusJson && (statusJson.success || statusJson.agent_status)) {
                            const agent = statusJson.agent_status || statusJson;
                            const position = agent.position;
                            const currentPrice = agent.current_price;
                            if (position && position.amount && position.amount > 0) {
                                const entryPrice = position.entry_price || 0;
                                const pnlAbs = currentPrice && entryPrice ? (currentPrice - entryPrice) * position.amount : 0;
                                const pnlPct = currentPrice && entryPrice ? ((currentPrice - entryPrice) / entryPrice) * 100 : 0;
                                const entryTime = position.entry_time ? formatMoscowDateTime(position.entry_time) : '';
                                positionHTML = `
                                    <div class="trade-item" style="border-left:4px solid #28a745;">
                                        <div class="trade-header">
                                            <span class="trade-action buy">–¢–ï–ö–£–©–ê–Ø –ü–û–ó–ò–¶–ò–Ø (${position.type?.toUpperCase() || 'LONG'})</span>
                                            ${entryTime ? `<span>–û—Ç–∫—Ä—ã—Ç–∞: ${entryTime}</span>` : ''}
                                        </div>
                                        <div class="trade-details">
                                            <div class="trade-detail">
                                                <div class="label">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ</div>
                                                <div class="value">${position.amount}</div>
                                            </div>
                                            <div class="trade-detail">
                                                <div class="label">–¶–µ–Ω–∞ –≤—Ö–æ–¥–∞</div>
                                                <div class="value">$${entryPrice ? entryPrice.toFixed(2) : 'N/A'}</div>
                                            </div>
                                            <div class="trade-detail">
                                                <div class="label">–¢–µ–∫—É—â–∞—è —Ü–µ–Ω–∞</div>
                                                <div class="value">$${currentPrice ? currentPrice.toFixed(2) : 'N/A'}</div>
                                            </div>
                                            <div class="trade-detail">
                                                <div class="label">P&L</div>
                                                <div class="value" style="color:${pnlAbs >= 0 ? 'green' : 'red'}">
                                                    ${pnlAbs >= 0 ? '+' : ''}$${pnlAbs.toFixed(4)} (${pnlPct >= 0 ? '+' : ''}${pnlPct.toFixed(2)}%)
                                                </div>
                                            </div>
                                            ${position.trade_number ? `
                                            <div class="trade-detail">
                                                <div class="label">Trade #</div>
                                                <div class="value">${position.trade_number}</div>
                                            </div>` : ''}
                                        </div>
                                    </div>
                                `;
                            } else {
                                positionHTML = `
                                    <div class="trade-item" style="border-left:4px solid #6c757d;">
                                        <div class="trade-header">
                                            <span class="trade-action hold">–¢–ï–ö–£–©–ê–Ø –ü–û–ó–ò–¶–ò–Ø</span>
                                            <span>–Ω–µ—Ç –æ—Ç–∫—Ä—ã—Ç–æ–π –ø–æ–∑–∏—Ü–∏–∏</span>
                                        </div>
                                    </div>
                                `;
                            }
                        }
                    } catch (e) {
                        // –∏–≥–Ω–æ—Ä–∏—Ä—É–µ–º –æ—à–∏–±–∫–∏ —Å—Ç–∞—Ç—É—Å–∞, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –ª–∏—à—å –∏—Å—Ç–æ—Ä–∏—é
                    }

                    // 2) –ò—Å—Ç–æ—Ä–∏—è —Å–¥–µ–ª–æ–∫
                    if (result.trades && result.trades.length > 0) {
                        let historyHTML = `<p><strong>–í—Å–µ–≥–æ —Å–¥–µ–ª–æ–∫:</strong> ${result.total_trades}</p>`;
                        
                        result.trades.forEach((trade, index) => {
                            const tradeTime = formatMoscowDateTime(trade.time);
                            const actionClass = trade.action === 'buy' ? 'buy' : 'sell';
                            
                            historyHTML += `
                                <div class="trade-item">
                                    <div class="trade-header">
                                        <span class="trade-action ${actionClass}">${trade.action.toUpperCase()}</span>
                                        <span>${tradeTime}</span>
                                    </div>
                                    <div class="trade-details">
                                        <div class="trade-detail">
                                            <div class="label">–¶–µ–Ω–∞</div>
                                            <div class="value">$${trade.price}</div>
                                        </div>
                                        <div class="trade-detail">
                                            <div class="label">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ</div>
                                            <div class="value">${trade.amount}</div>
                                        </div>
                                        ${trade.pnl ? `
                                        <div class="trade-detail">
                                            <div class="label">P&L</div>
                                            <div class="value" style="color: ${trade.pnl >= 0 ? 'green' : 'red'}">
                                                ${trade.pnl >= 0 ? '+' : ''}$${trade.pnl.toFixed(4)}
                                            </div>
                                        </div>
                                        ` : ''}
                                    </div>
                                </div>
                            `;
                        });
                        
                        contentDiv.innerHTML = positionHTML + historyHTML;
                    } else {
                        const emptyHTML = '<p>üìà –ò—Å—Ç–æ—Ä–∏—è —Å–¥–µ–ª–æ–∫ –ø–æ–∫–∞ –ø—É—Å—Ç–∞</p><p><em>–°–¥–µ–ª–∫–∏ –ø–æ—è–≤—è—Ç—Å—è –ø–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —Ç–æ—Ä–≥–æ–≤—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π</em></p>';
                        contentDiv.innerHTML = positionHTML + emptyHTML;
                    }
                    
                    historyDiv.style.display = 'block';
                } else {
                    showStatus('tradingResult', 'error', result.error);
                }
            } catch (error) {
                showStatus('tradingResult', 'error', '–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –∏—Å—Ç–æ—Ä–∏–∏: ' + error.message);
            }
        }

        // –ü–æ–ª—É—á–µ–Ω–∏–µ –ø–æ—Å–ª–µ–¥–Ω–∏—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ —Ç–æ—Ä–≥–æ–≤–ª–∏ –∏–∑ Celery
        async function getTradingResults() {
            try {
                const response = await fetch('/api/trading/latest_results');
                const result = await response.json();
                
                if (result.success) {
                    const resultsDiv = document.getElementById('tradingResults');
                    const contentDiv = document.getElementById('tradingResultsContent');
                    
                    if (result.latest_results && result.latest_results.length > 0) {
                        let resultsHTML = `<p><strong>–í—Å–µ–≥–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤:</strong> ${result.total_results}</p>`;
                        
                        result.latest_results.forEach((tradeResult, index) => {
                            const resultTime = formatMoscowDateTime(tradeResult.timestamp);
                            const successClass = tradeResult.exit_code === 0 ? 'success' : 'error';
                            
                            resultsHTML += `
                                <div class="trade-item">
                                    <div class="trade-header">
                                        <span class="trade-action ${successClass}">${tradeResult.exit_code === 0 ? '‚úÖ –£–°–ü–ï–•' : '‚ùå –û–®–ò–ë–ö–ê'}</span>
                                        <span>${resultTime}</span>
                                    </div>
                                    <div class="trade-details">
                                        <div class="trade-detail">
                                            <div class="label">–°–∏–º–≤–æ–ª—ã</div>
                                            <div class="value">${tradeResult.symbols ? tradeResult.symbols.join(', ') : 'N/A'}</div>
                                        </div>
                                        <div class="trade-detail">
                                            <div class="label">–ö–æ–¥ –≤—ã—Ö–æ–¥–∞</div>
                                            <div class="value">${tradeResult.exit_code}</div>
                                        </div>
                                        ${tradeResult.parsed_result ? `
                                        <div class="trade-detail">
                                            <div class="label">–î–µ–π—Å—Ç–≤–∏–µ</div>
                                            <div class="value">${tradeResult.parsed_result.action || 'N/A'}</div>
                                        </div>
                                        <div class="trade-detail">
                                            <div class="label">–¶–µ–Ω–∞</div>
                                            <div class="value">$${tradeResult.parsed_result.price || 'N/A'}</div>
                                        </div>
                                        ${tradeResult.parsed_result.trade_executed ? `
                                        <div class="trade-detail">
                                            <div class="label">–í—ã–ø–æ–ª–Ω–µ–Ω–æ</div>
                                            <div class="value">${tradeResult.parsed_result.trade_executed}</div>
                                        </div>
                                        ` : ''}
                                        ${tradeResult.parsed_result.position_pnl ? `
                                        <div class="trade-detail">
                                            <div class="label">P&L –ø–æ–∑–∏—Ü–∏–∏</div>
                                            <div class="value" style="color: ${tradeResult.parsed_result.position_pnl >= 0 ? 'green' : 'red'}">
                                                ${tradeResult.parsed_result.position_pnl >= 0 ? '+' : ''}${tradeResult.parsed_result.position_pnl.toFixed(2)}%
                                            </div>
                                        </div>
                                        ` : ''}
                                        ` : ''}
                                    </div>
                                    ${tradeResult.parse_error ? `
                                    <div style="margin-top: 10px; padding: 10px; background: #f8d7da; border-radius: 5px; font-size: 12px;">
                                        <strong>–û—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞:</strong> ${tradeResult.parse_error}
                                    </div>
                                    ` : ''}
                                </div>
                            `;
                        });
                        
                        contentDiv.innerHTML = resultsHTML;
                    } else {
                        contentDiv.innerHTML = '<p>üìä –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–æ—Ä–≥–æ–≤–ª–∏ –ø–æ–∫–∞ –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç</p><p><em>–î–∞–Ω–Ω—ã–µ –ø–æ—è–≤—è—Ç—Å—è –ø–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —Ç–æ—Ä–≥–æ–≤—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π —á–µ—Ä–µ–∑ Celery</em></p>';
                    }
                    
                    resultsDiv.style.display = 'block';
                } else {
                    console.error('–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤:', result.error);
                    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –±–ª–æ–∫ —Å –æ—à–∏–±–∫–æ–π
                    const resultsDiv = document.getElementById('tradingResults');
                    const contentDiv = document.getElementById('tradingResultsContent');
                    contentDiv.innerHTML = '<p>‚ùå –û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤</p><p><em>' + (result.error || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞') + '</em></p>';
                    resultsDiv.style.display = 'block';
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ —Ç–æ—Ä–≥–æ–≤–ª–∏:', error);
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –±–ª–æ–∫ —Å –æ—à–∏–±–∫–æ–π
                const resultsDiv = document.getElementById('tradingResults');
                const contentDiv = document.getElementById('tradingResultsContent');
                contentDiv.innerHTML = '<p>‚ùå –û—à–∏–±–∫–∞ —Å–µ—Ç–∏</p><p><em>' + error.message + '</em></p>';
                resultsDiv.style.display = 'block';
            }
        }

        // –ü–æ–ª—É—á–µ–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏–∏ —Å–¥–µ–ª–æ–∫ –∏–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
        async function getTradeHistory() {
            try {
                const response = await fetch('/api/trades/recent?limit=20');
                const result = await response.json();
                
                const historyDiv = document.getElementById('tradeHistory');
                const contentDiv = document.getElementById('tradeHistoryContent');
                
                if (result.success) {
                    if (result.trades && result.trades.length > 0) {
                        let historyHTML = '';
                        result.trades.forEach(trade => {
                            const statusClass = trade.is_successful ? 'success' : 'error';
                            const actionClass = trade.action === 'buy' ? 'buy' : trade.action === 'sell' ? 'sell' : 'hold';
                            
                            historyHTML += `
                                <div class="trade-item ${statusClass}">
                                    <div class="trade-header">
                                        <div class="trade-number">${trade.trade_number}</div>
                                        <div class="trade-symbol">${trade.symbol}</div>
                                        <div class="trade-action ${actionClass}">${trade.action.toUpperCase()}</div>
                                        <div class="trade-status">${trade.status}</div>
                                    </div>
                                    <div class="trade-details">
                                        <div class="trade-detail">
                                            <div class="label">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ</div>
                                            <div class="value">${trade.quantity}</div>
                                        </div>
                                        <div class="trade-detail">
                                            <div class="label">–¶–µ–Ω–∞</div>
                                            <div class="value">$${trade.price}</div>
                                        </div>
                                        <div class="trade-detail">
                                            <div class="label">–°—Ç–æ–∏–º–æ—Å—Ç—å</div>
                                            <div class="value">$${trade.total_value}</div>
                                        </div>
                                        ${trade.model_prediction ? `
                                        <div class="trade-detail">
                                            <div class="label">–ü—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–µ –º–æ–¥–µ–ª–∏</div>
                                            <div class="value">${trade.model_prediction}</div>
                                        </div>
                                        ` : ''}
                                        ${trade.position_pnl ? `
                                        <div class="trade-detail">
                                            <div class="label">P&L</div>
                                            <div class="value" style="color: ${trade.position_pnl >= 0 ? 'green' : 'red'}">
                                                ${trade.position_pnl >= 0 ? '+' : ''}${trade.position_pnl.toFixed(2)}
                                            </div>
                                        </div>
                                        ` : ''}
                                        <div class="trade-detail">
                                            <div class="label">–í—Ä–µ–º—è —Å–æ–∑–¥–∞–Ω–∏—è</div>
                                            <div class="value">${formatMoscowDateTime(trade.created_at)}</div>
                                        </div>
                                        ${trade.error_message ? `
                                        <div class="trade-detail">
                                            <div class="label">–û—à–∏–±–∫–∞</div>
                                            <div class="value error">${trade.error_message}</div>
                                        </div>
                                        ` : ''}
                                    </div>
                                </div>
                            `;
                        });
                        
                        contentDiv.innerHTML = historyHTML;
                    } else {
                        contentDiv.innerHTML = '<p>–ò—Å—Ç–æ—Ä–∏—è —Å–¥–µ–ª–æ–∫ –ø–æ–∫–∞ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç</p>';
                    }
                    
                    historyDiv.style.display = 'block';
                } else {
                    console.error('–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –∏—Å—Ç–æ—Ä–∏–∏ —Å–¥–µ–ª–æ–∫:', result.error);
                    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –±–ª–æ–∫ —Å –æ—à–∏–±–∫–æ–π
                    contentDiv.innerHTML = '<p>‚ùå –û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –∏—Å—Ç–æ—Ä–∏–∏ —Å–¥–µ–ª–æ–∫</p><p><em>' + (result.error || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞') + '</em></p>';
                    historyDiv.style.display = 'block';
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –∏—Å—Ç–æ—Ä–∏–∏ —Å–¥–µ–ª–æ–∫:', error);
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –±–ª–æ–∫ —Å –æ—à–∏–±–∫–æ–π
                const historyDiv = document.getElementById('tradeHistory');
                const contentDiv = document.getElementById('tradeHistoryContent');
                contentDiv.innerHTML = '<p>‚ùå –û—à–∏–±–∫–∞ —Å–µ—Ç–∏</p><p><em>' + error.message + '</em></p>';
                historyDiv.style.display = 'block';
            }
        }

        // –ü–æ–ª—É—á–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ —Å–¥–µ–ª–æ–∫
        async function getTradeStatistics() {
            try {
                const response = await fetch('/api/trades/statistics');
                const result = await response.json();
                
                const statsDiv = document.getElementById('tradeStatistics');
                const contentDiv = document.getElementById('tradeStatisticsContent');
                
                if (result.success) {
                    const stats = result.statistics;
                    const successRate = stats.success_rate || 0;
                    const successRateClass = successRate >= 50 ? 'success' : 'error';
                    
                    const statsHTML = `
                        <div class="statistics-grid">
                            <div class="stat-item">
                                <div class="stat-label">–í—Å–µ–≥–æ —Å–¥–µ–ª–æ–∫</div>
                                <div class="stat-value">${stats.total_trades}</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-label">–£—Å–ø–µ—à–Ω—ã—Ö —Å–¥–µ–ª–æ–∫</div>
                                <div class="stat-value success">${stats.successful_trades}</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-label">–ù–µ—É–¥–∞—á–Ω—ã—Ö —Å–¥–µ–ª–æ–∫</div>
                                <div class="stat-value error">${stats.failed_trades}</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-label">–ü—Ä–æ—Ü–µ–Ω—Ç —É—Å–ø–µ—Ö–∞</div>
                                <div class="stat-value ${successRateClass}">${successRate}%</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-label">–û–±—â–∏–π –æ–±—ä–µ–º</div>
                                <div class="stat-value">${stats.total_volume.toFixed(6)}</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-label">–û–±—â–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å</div>
                                <div class="stat-value">$${stats.total_value.toFixed(2)}</div>
                            </div>
                        </div>
                    `;
                    
                    contentDiv.innerHTML = statsHTML;
                    statsDiv.style.display = 'block';
                } else {
                    console.error('–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏:', result.error);
                    contentDiv.innerHTML = '<p>üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞</p><p><em>–û—à–∏–±–∫–∞: ' + (result.error || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞') + '</em></p>';
                    statsDiv.style.display = 'block';
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏:', error);
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –±–ª–æ–∫ —Å –æ—à–∏–±–∫–æ–π
                const statsDiv = document.getElementById('tradeStatistics');
                const contentDiv = document.getElementById('tradeStatisticsContent');
                contentDiv.innerHTML = '<p>‚ùå –û—à–∏–±–∫–∞ —Å–µ—Ç–∏</p><p><em>' + error.message + '</em></p>';
                statsDiv.style.display = 'block';
            }
        }

        // –ó–∞–ø—É—Å–∫ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
        function startMonitoring() {
            if (monitoringInterval) {
                clearInterval(monitoringInterval);
            }
            
            // –°—Ä–∞–∑—É –ø–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ
            getTradingStatus();
            getBalance();
            getTradingResults();
            getTradeHistory();
            getTradeStatistics();
            getModelPredictions();
            getPredictionStatistics();
            
            monitoringInterval = setInterval(() => {
                getTradingStatus();
                getBalance();
                getTradingResults();
                getTradeHistory();
                getTradeStatistics();
                getModelPredictions();
                getPredictionStatistics();
            }, 300000); 
            
            document.getElementById('monitoringStatus').style.display = 'block';
            showStatus('tradingResult', 'info', '–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∑–∞–ø—É—â–µ–Ω - –¥–∞–Ω–Ω—ã–µ –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è –∫–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç');
        }

        // –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
        function stopMonitoring() {
            if (monitoringInterval) {
                clearInterval(monitoringInterval);
                monitoringInterval = null;
            }
            
            document.getElementById('monitoringStatus').style.display = 'none';
            showStatus('tradingResult', 'info', '–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω');
        }

        // –ü–æ–∫–∞–∑–∞—Ç—å —Å—Ç–∞—Ç—É—Å
        function showStatus(elementId, type, message) {
            const element = document.getElementById(elementId);
            element.textContent = message;
            element.className = `status ${type}`;
            element.style.display = 'block';
            
            // –ê–≤—Ç–æ—Å–∫—Ä—ã—Ç–∏–µ —á–µ—Ä–µ–∑ 5 —Å–µ–∫—É–Ω–¥
            setTimeout(() => {
                element.style.display = 'none';
            }, 5000);
        }

        // –ú–≥–Ω–æ–≤–µ–Ω–Ω—ã–π —Ä–µ–∞–ª—å–Ω—ã–π –æ—Ä–¥–µ—Ä BUY/SELL –≤ –æ–±—Ö–æ–¥ –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–π
        async function sendInstantOrder(action) {
            try {
                const symbol = document.getElementById('symbolSelect').value || 'BTCUSDT';
                const body = {
                    action,
                    symbol
                    // quantity –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ; –µ—Å–ª–∏ –Ω–µ —É–∫–∞–∑–∞—Ç—å ‚Äî –≤–æ–∑—å–º–µ—Ç—Å—è –º–∏–Ω–∏–º–∞–ª—å–Ω–æ –¥–æ–ø—É—Å—Ç–∏–º—ã–π —Ä–∞–∑–º–µ—Ä
                };
                const response = await fetch('/api/trading/test_order', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(body)
                });
                const result = await response.json();
                if (result.success) {
                    showStatus('tradingResult', 'success', `${action.toUpperCase()} –∏—Å–ø–æ–ª–Ω–µ–Ω: ${symbol}, qty=${result.quantity}`);
                    // –ù–∏—á–µ–≥–æ –Ω–µ –ø–∏—à–µ–º –≤ –ë–î/–º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
                } else {
                    showStatus('tradingResult', 'error', `–û—à–∏–±–∫–∞: ${result.error || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'}`);
                }
            } catch (error) {
                showStatus('tradingResult', 'error', '–û—à–∏–±–∫–∞ —Å–µ—Ç–∏: ' + error.message);
            }
        }

        // –ü–æ–ª—É—á–µ–Ω–∏–µ –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–π –º–æ–¥–µ–ª–∏ –ò–ò
        async function getModelPredictions() {
            try {
                const response = await fetch('/api/predictions/recent?limit=50');
                const result = await response.json();
                
                const predictionsDiv = document.getElementById('modelPredictions');
                const contentDiv = document.getElementById('predictionsContent');
                
                if (result.success) {
                    if (result.predictions && result.predictions.length > 0) {
                        let predictionsHTML = `<p><strong>–í—Å–µ–≥–æ –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–π:</strong> ${result.total_predictions}</p>`;
                        
                        result.predictions.forEach(prediction => {
                            const predictionTime = formatMoscowDateTime(prediction.timestamp);
                            const actionClass = prediction.action === 'buy' ? 'buy' : prediction.action === 'sell' ? 'sell' : 'hold';
                            const confidenceClass = prediction.confidence > 0.5 ? 'success' : prediction.confidence > 0.2 ? 'info' : 'warning';
                            
                            predictionsHTML += `
                                <div class="trade-item">
                                    <div class="trade-header">
                                        <span class="trade-action ${actionClass}">${prediction.action.toUpperCase()}</span>
                                        <span class="trade-confidence ${confidenceClass}">–£–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å: ${(prediction.confidence * 100).toFixed(1)}%</span>
                                        <span>${predictionTime}</span>
                                    </div>
                                    <div class="trade-details">
                                        <div class="trade-detail">
                                            <div class="label">–°–∏–º–≤–æ–ª</div>
                                            <div class="value">${prediction.symbol}</div>
                                        </div>
                                        <div class="trade-detail">
                                            <div class="label">–¶–µ–Ω–∞</div>
                                            <div class="value">$${prediction.current_price?.toFixed(6) || 'N/A'}</div>
                                        </div>
                                        <div class="trade-detail">
                                            <div class="label">–ü–æ–∑–∏—Ü–∏—è</div>
                                            <div class="value">${prediction.position_status}</div>
                                        </div>
                                        <div class="trade-detail">
                                            <div class="label">Q-Values</div>
                                            <div class="value">[${prediction.q_values.map(v => v.toFixed(3)).join(', ')}]</div>
                                        </div>
                                    </div>
                                    ${prediction.market_conditions && Object.keys(prediction.market_conditions).length > 0 ? `
                                    <div style="margin-top: 10px; padding: 10px; background: #f8f9fa; border-radius: 5px; font-size: 12px;">
                                        <strong>–£—Å–ª–æ–≤–∏—è —Ä—ã–Ω–∫–∞:</strong><br>
                                        ${Object.entries(prediction.market_conditions).map(([key, value]) => 
                                            `${key}: ${value}`
                                        ).join(', ')}
                                    </div>
                                    ` : ''}
                                </div>
                            `;
                        });
                        
                        contentDiv.innerHTML = predictionsHTML;
                    } else {
                        contentDiv.innerHTML = '<p>üß† –ü—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏—è –º–æ–¥–µ–ª–∏ –ø–æ–∫–∞ –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç</p><p><em>–î–∞–Ω–Ω—ã–µ –ø–æ—è–≤—è—Ç—Å—è –ø–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —Ç–æ—Ä–≥–æ–≤—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π</em></p>';
                    }
                    
                    predictionsDiv.style.display = 'block';
                } else {
                    console.error('–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–π:', result.error);
                    contentDiv.innerHTML = '<p>‚ùå –û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–π</p><p><em>' + (result.error || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞') + '</em></p>';
                    predictionsDiv.style.display = 'block';
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–π:', error);
                const predictionsDiv = document.getElementById('modelPredictions');
                const contentDiv = document.getElementById('predictionsContent');
                contentDiv.innerHTML = '<p>‚ùå –û—à–∏–±–∫–∞ —Å–µ—Ç–∏</p><p><em>' + error.message + '</em></p>';
                predictionsDiv.style.display = 'block';
            }
        }

        // –ü–æ–ª—É—á–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–π
        async function getPredictionStatistics() {
            try {
                const response = await fetch('/api/predictions/statistics');
                const result = await response.json();
                
                const statsDiv = document.getElementById('predictionStatistics');
                const contentDiv = document.getElementById('predictionStatsContent');
                
                if (result.success) {
                    const stats = result.statistics;
                    
                    const statsHTML = `
                        <div class="statistics-grid">
                            <div class="stat-item">
                                <div class="stat-label">–í—Å–µ–≥–æ –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–π</div>
                                <div class="stat-value">${stats.total_predictions}</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-label">BUY —Å–∏–≥–Ω–∞–ª—ã</div>
                                <div class="stat-value buy">${stats.buy_predictions}</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-label">SELL —Å–∏–≥–Ω–∞–ª—ã</div>
                                <div class="stat-value sell">${stats.sell_predictions}</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-label">HOLD —Å–∏–≥–Ω–∞–ª—ã</div>
                                <div class="stat-value hold">${stats.hold_predictions}</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-label">–°—Ä–µ–¥–Ω—è—è —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å BUY</div>
                                <div class="stat-value">${stats.avg_confidence_buy}</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-label">–°—Ä–µ–¥–Ω—è—è —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å SELL</div>
                                <div class="stat-value">${stats.avg_confidence_sell}</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-label">–°—Ä–µ–¥–Ω—è—è —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å HOLD</div>
                                <div class="stat-value">${stats.avg_confidence_hold}</div>
                            </div>
                        </div>
                    `;
                    
                    contentDiv.innerHTML = statsHTML;
                    statsDiv.style.display = 'block';
                } else {
                    console.error('–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–π:', result.error);
                    contentDiv.innerHTML = '<p>üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–π –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞</p><p><em>–û—à–∏–±–∫–∞: ' + (result.error || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞') + '</em></p>';
                    statsDiv.style.display = 'block';
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–π:', error);
                const statsDiv = document.getElementById('predictionStatistics');
                const contentDiv = document.getElementById('predictionStatsContent');
                contentDiv.innerHTML = '<p>‚ùå –û—à–∏–±–∫–∞ —Å–µ—Ç–∏</p><p><em>' + error.message + '</em></p>';
                statsDiv.style.display = 'block';
            }
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ –æ—Å—Ç–∞–≤—à–µ–π—Å—è –ø–æ–∑–∏—Ü–∏–∏
        function showRemainingPositionStrategy(strategy) {
            const contentDiv = document.getElementById('remainingStrategyContent');
            const strategyDiv = document.getElementById('remainingPositionStrategy');
            
            if (strategy && strategy.type === 'remaining_position') {
                const createdTime = formatMoscowDateTime(strategy.created_at);
                const timeThreshold = formatMoscowDateTime(strategy.time_threshold);
                
                let strategyHTML = `
                    <div class="strategy-info">
                        <h4>üéØ –°—Ç—Ä–∞—Ç–µ–≥–∏—è –¥–ª—è –æ—Å—Ç–∞–≤—à–µ–π—Å—è –ø–æ–∑–∏—Ü–∏–∏</h4>
                        <div class="strategy-details">
                            <p><strong>–¢–∏–ø:</strong> ${strategy.type}</p>
                            <p><strong>–°–æ–∑–¥–∞–Ω–∞:</strong> ${createdTime}</p>
                            <p><strong>–í—Ä–µ–º—è –∏—Å—Ç–µ—á–µ–Ω–∏—è:</strong> ${timeThreshold}</p>
                            <p><strong>–ü–æ—Ä–æ–≥ —É–±—ã—Ç–∫–∞:</strong> <span class="negative">${strategy.sell_threshold}%</span></p>
                            <p><strong>–ü–æ—Ä–æ–≥ –ø—Ä–∏–±—ã–ª–∏:</strong> <span class="positive">${strategy.profit_threshold}%</span></p>
                            <p><strong>–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è –æ–∂–∏–¥–∞–Ω–∏—è:</strong> 24 —á–∞—Å–∞</p>
                        </div>
                        <div class="strategy-rules">
                            <h5>üìã –ü—Ä–∞–≤–∏–ª–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –ø—Ä–æ–¥–∞–∂–∏:</h5>
                            <ul>
                                <li>üö® <strong>–£–±—ã—Ç–æ–∫ > ${strategy.sell_threshold}%</strong> ‚Üí –ü—Ä–æ–¥–∞–µ–º –≤–µ—Å—å –æ—Å—Ç–∞—Ç–æ–∫</li>
                                <li>üí∞ <strong>–ü—Ä–∏–±—ã–ª—å > ${strategy.profit_threshold}%</strong> ‚Üí –ü—Ä–æ–¥–∞–µ–º –≤–µ—Å—å –æ—Å—Ç–∞—Ç–æ–∫</li>
                                <li>‚è∞ <strong>–í—Ä–µ–º—è > 24 —á–∞—Å–∞</strong> ‚Üí –ü—Ä–æ–¥–∞–µ–º –≤–µ—Å—å –æ—Å—Ç–∞—Ç–æ–∫</li>
                            </ul>
                        </div>
                    </div>
                `;
                
                contentDiv.innerHTML = strategyHTML;
                strategyDiv.style.display = 'block';
            } else {
                strategyDiv.style.display = 'none';
            }
        }
        
        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è —Å–ª–∞–π–¥–µ—Ä–æ–≤ –∫–æ–Ω—Å–µ–Ω—Å—É—Å–∞
        function updateConsensusDisplay() {
            const flatValue = document.getElementById('flatConsensus').value;
            const trendValue = document.getElementById('trendConsensus').value;
            
            document.getElementById('flatConsensusValue').textContent = flatValue + '%';
            document.getElementById('trendConsensusValue').textContent = trendValue + '%';
            document.getElementById('flatConsensusDisplay').textContent = flatValue + '%';
            document.getElementById('trendConsensusDisplay').textContent = trendValue + '%';
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å–ª–∞–π–¥–µ—Ä–æ–≤ –∫–æ–Ω—Å–µ–Ω—Å—É—Å–∞
        function initConsensusSliders() {
            const flatSlider = document.getElementById('flatConsensus');
            const trendSlider = document.getElementById('trendConsensus');
            
            if (flatSlider) {
                flatSlider.addEventListener('input', updateConsensusDisplay);
            }
            if (trendSlider) {
                trendSlider.addEventListener('input', updateConsensusDisplay);
            }
            
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∑–Ω–∞—á–µ–Ω–∏–π
            updateConsensusDisplay();
        }

        // –ü–æ–ª—É—á–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫ –∫–æ–Ω—Å–µ–Ω—Å—É—Å–∞
        function getConsensusSettings() {
            return {
                flat: parseInt(document.getElementById('flatConsensus').value),
                trend: parseInt(document.getElementById('trendConsensus').value)
            };
        }

        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–ª—É—á–∞–µ–º —Å—Ç–∞—Ç—É—Å –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        window.addEventListener('load', () => {
            onEnsembleSymbolChange();
            getTradingStatus();
            getBalance();
            initConsensusSliders();
        });
    </script>
</body>
</html>
