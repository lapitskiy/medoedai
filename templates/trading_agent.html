<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MedoedAI - –¢–æ—Ä–≥–æ–≤—ã–π –∞–≥–µ–Ω—Ç</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            overflow: hidden;
        }
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }
        .header h1 {
            margin: 0;
            font-size: 2.5em;
            font-weight: 300;
        }
        .content {
            padding: 30px;
        }
        .section {
            margin-bottom: 40px;
            padding: 25px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            background: #fafafa;
        }
        .section h2 {
            color: #333;
            margin-top: 0;
            border-bottom: 2px solid #667eea;
            padding-bottom: 10px;
        }
        .button-group {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            margin: 20px 0;
        }
        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-block;
            text-align: center;
        }
        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }
        .btn-success {
            background: linear-gradient(135deg, #56ab2f 0%, #a8e6cf 100%);
            color: white;
        }
        .btn-success:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(86, 171, 47, 0.4);
        }
        .btn-danger {
            background: linear-gradient(135deg, #ff416c 0%, #ff4b2b 100%);
            color: white;
        }
        .btn-danger:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(255, 65, 108, 0.4);
        }
        .btn-info {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
        }
        .btn-info:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(79, 172, 254, 0.4);
        }
        .btn-warning {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
        }
        .btn-warning:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(240, 147, 251, 0.4);
        }
        .status {
            margin-top: 15px;
            padding: 15px;
            border-radius: 8px;
            font-weight: 600;
        }
        .status.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .status.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .status.info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
        .form-group {
            margin-bottom: 20px;
        }
        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: #333;
        }
        .form-group input, .form-group select {
            width: 100%;
            padding: 10px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s ease;
        }
        .form-group input:focus, .form-group select:focus {
            outline: none;
            border-color: #667eea;
        }
        .back-btn {
            background: linear-gradient(135deg, #6c757d 0%, #495057 100%);
            color: white;
            margin-bottom: 20px;
        }
        .back-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(108, 117, 125, 0.4);
        }
        .trading-status {
            background: #e8f5e8;
            border: 2px solid #28a745;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
        }
        .trading-status h3 {
            color: #28a745;
            margin-top: 0;
        }
        .trading-status p {
            margin: 10px 0;
            font-weight: 600;
        }
        .trading-history {
            background: #f8f9fa;
            border: 2px solid #dee2e6;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            max-height: 400px;
            overflow-y: auto;
        }
        .trading-history h3 {
            color: #495057;
            margin-top: 0;
        }
        .trade-item {
            background: white;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 15px;
            margin: 10px 0;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .trade-item .trade-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .trade-item.success {
            border-left: 4px solid #28a745;
        }
        
        .trade-item.error {
            border-left: 4px solid #dc3545;
        }
        
        .trade-action.buy {
            color: #28a745;
            font-weight: bold;
        }
        
        .trade-action.sell {
            color: #dc3545;
            font-weight: bold;
        }
        
        .trade-action.hold {
            color: #6c757d;
            font-weight: bold;
        }
        
        .statistics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }
        
        .stat-item {
            background: white;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 15px;
            text-align: center;
        }
        
        .stat-label {
            font-size: 14px;
            color: #6c757d;
            margin-bottom: 5px;
        }
        
        .stat-value {
            font-size: 24px;
            font-weight: bold;
            color: #333;
        }
        
        .stat-value.success {
            color: #28a745;
        }
        
        .stat-value.error {
            color: #dc3545;
        }
        
        .stat-value.buy {
            color: #28a745;
        }
        
        .stat-value.sell {
            color: #dc3545;
        }
        
        .stat-value.hold {
            color: #6c757d;
        }
        
        .trade-action {
            font-weight: bold;
            padding: 5px 10px;
            border-radius: 5px;
            font-size: 14px;
        }
        .trade-action.buy {
            background: #d4edda;
            color: #155724;
        }
        .trade-action.sell {
            background: #f8d7da;
            color: #721c24;
        }
        .trade-action.success {
            background: #d4edda;
            color: #155724;
        }
        .trade-action.error {
            background: #f8d7da;
            color: #721c24;
        }
        
        .trade-confidence {
            font-weight: bold;
            padding: 5px 10px;
            border-radius: 5px;
            font-size: 14px;
        }
        
        .trade-confidence.success {
            background: #d4edda;
            color: #155724;
        }
        
        .trade-confidence.info {
            background: #d1ecf1;
            color: #0c5460;
        }
        
        .trade-confidence.warning {
            background: #fff3cd;
            color: #856404;
        }
        
        .trade-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 10px;
            font-size: 14px;
        }
        .trade-detail {
            background: #f8f9fa;
            padding: 8px;
            border-radius: 5px;
            text-align: center;
        }
        .trade-detail .label {
            font-weight: 600;
            color: #495057;
            font-size: 12px;
            text-transform: uppercase;
        }
        .trade-detail .value {
            color: #333;
            margin-top: 5px;
        }
        .model-info {
            background: #e8f5e8;
            border: 2px solid #28a745;
            border-radius: 10px;
            padding: 15px;
            margin: 15px 0;
        }
        .model-info h4 {
            color: #28a745;
            margin-top: 0;
            margin-bottom: 10px;
        }
        .model-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
        }
        .model-detail-item {
            background: white;
            padding: 10px;
            border-radius: 5px;
            border: 1px solid #c3e6cb;
        }
        .model-detail-label {
            font-weight: 600;
            color: #495057;
            font-size: 12px;
            text-transform: uppercase;
            margin-bottom: 5px;
        }
        .model-detail-value {
            color: #333;
            font-size: 14px;
        }
        
        /* –°—Ç–∏–ª–∏ –¥–ª—è —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ –æ—Å—Ç–∞–≤—à–µ–π—Å—è –ø–æ–∑–∏—Ü–∏–∏ */
        .strategy-info {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 20px;
            margin: 15px 0;
        }
        
        .strategy-details {
            background: white;
            border: 1px solid #e9ecef;
            border-radius: 6px;
            padding: 15px;
            margin: 15px 0;
        }
        
        .strategy-details p {
            margin: 8px 0;
            font-size: 14px;
        }
        
        .strategy-rules {
            background: #e7f3ff;
            border: 1px solid #b3d9ff;
            border-radius: 6px;
            padding: 15px;
            margin: 15px 0;
        }
        
        .strategy-rules h5 {
            margin: 0 0 15px 0;
            color: #0056b3;
        }
        
        .strategy-rules ul {
            margin: 0;
            padding-left: 20px;
        }
        
        .strategy-rules li {
            margin: 8px 0;
            font-size: 14px;
            line-height: 1.4;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üí∞ –¢–æ—Ä–≥–æ–≤—ã–π –∞–≥–µ–Ω—Ç</h1>
            <p>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–æ—Ä–≥–æ–≤–ª–µ–π –Ω–∞ —Ä–µ–∞–ª—å–Ω–æ–º —Ä—ã–Ω–∫–µ —á–µ—Ä–µ–∑ –æ–±—É—á–µ–Ω–Ω—É—é –º–æ–¥–µ–ª—å DQN</p>
        </div>

        <div class="content">
            <!-- –ö–Ω–æ–ø–∫–∞ –≤–æ–∑–≤—Ä–∞—Ç–∞ -->
            <a href="/" class="btn back-btn">‚Üê –í–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞ –≥–ª–∞–≤–Ω—É—é</a>

            <!-- –°–µ–∫—Ü–∏—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ç–æ—Ä–≥–æ–≤–ª–µ–π -->
            <div class="section">
                <h2>üéØ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–æ—Ä–≥–æ–≤–ª–µ–π</h2>
                <p>–ó–∞–ø—É—Å–∫ –∏ –æ—Å—Ç–∞–Ω–æ–≤–∫–∞ —Ç–æ—Ä–≥–æ–≤–æ–≥–æ –±–æ—Ç–∞</p>
                
                <div class="form-group">
                    <label>–ú–æ–¥–µ–ª—å –¥–ª—è —Ç–æ—Ä–≥–æ–≤–ª–∏:</label>
                    <select id="modelSelect" class="form-control" onchange="showModelInfo()">
                        <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –º–æ–¥–µ–ª—å...</option>
                    </select>
                </div>
                
                <div id="modelInfo" class="model-info" style="display: none;">
                    <h4>üìä –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –º–æ–¥–µ–ª–∏</h4>
                    <div id="modelInfoContent"></div>
                </div>
                
                <div class="form-group">
                    <label>–¢–æ—Ä–≥–æ–≤–∞—è –ø–∞—Ä–∞ (–î–µ—Ä–∏–≤–∞—Ç–∏–≤—ã):</label>
                    <div>
                        <label><input type="checkbox" value="BTCUSDT" class="trading-symbol" checked> BTCUSDT (–§—å—é—á–µ—Ä—Å—ã)</label><br>
                        <label><input type="checkbox" value="ETHUSDT" class="trading-symbol"> ETHUSDT (–§—å—é—á–µ—Ä—Å—ã)</label><br>
                        <label><input type="checkbox" value="SOLUSDT" class="trading-symbol"> SOLUSDT (–§—å—é—á–µ—Ä—Å—ã)</label><br>
                        <label><input type="checkbox" value="TONUSDT" class="trading-symbol"> TONUSDT (–§—å—é—á–µ—Ä—Å—ã)</label><br>
                        <label><input type="checkbox" value="ADAUSDT" class="trading-symbol"> ADAUSDT (–§—å—é—á–µ—Ä—Å—ã)</label><br>
                        <label><input type="checkbox" value="BNBUSDT" class="trading-symbol"> BNBUSDT (–§—å—é—á–µ—Ä—Å—ã)</label>
                    </div>
                    <small style="color: #666; font-style: italic;">
                        ‚ö†Ô∏è –í–Ω–∏–º–∞–Ω–∏–µ: –¢–æ—Ä–≥–æ–≤–ª—è –≤–µ–¥–µ—Ç—Å—è –Ω–∞ –¥–µ—Ä–∏–≤–∞—Ç–∏–≤–∞—Ö Bybit (—Ñ—å—é—á–µ—Ä—Å—ã), –∞ –Ω–µ –Ω–∞ —Å–ø–æ—Ç–µ
                    </small>
                </div>
                
                <div class="button-group">
                    <button class="btn btn-success" onclick="startTrading()">
                        üöÄ –ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç–æ—Ä–≥–æ–≤–ª—é
                    </button>
                    <button class="btn btn-danger" onclick="stopTrading()">
                        üõë –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Ç–æ—Ä–≥–æ–≤–ª—é
                    </button>
                </div>
                
                <div id="tradingResult" class="status" style="display: none;"></div>
            </div>

            <!-- –°–µ–∫—Ü–∏—è —Å—Ç–∞—Ç—É—Å–∞ —Ç–æ—Ä–≥–æ–≤–ª–∏ -->
            <div class="section">
                <h2>üìä –°—Ç–∞—Ç—É—Å —Ç–æ—Ä–≥–æ–≤–ª–∏</h2>
                <p>–¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Ç–æ—Ä–≥–æ–≤–æ–≥–æ –±–æ—Ç–∞</p>
                
                <div class="button-group">
                    <button class="btn btn-info" onclick="getTradingStatus()">
                        üîç –ü–æ–ª—É—á–∏—Ç—å —Å—Ç–∞—Ç—É—Å
                    </button>
                    <button class="btn btn-info" onclick="getBalance()">
                        üí∞ –ë–∞–ª–∞–Ω—Å –Ω–∞ –±–∏—Ä–∂–µ
                    </button>
                </div>
                
                <div id="tradingStatus" class="trading-status" style="display: none;">
                    <h3>üìä –°—Ç–∞—Ç—É—Å —Ç–æ—Ä–≥–æ–≤–ª–∏</h3>
                    <div id="statusContent"></div>
                </div>
                
                <div id="balanceStatus" class="trading-status" style="display: none;">
                    <h3>üí∞ –ë–∞–ª–∞–Ω—Å –Ω–∞ –±–∏—Ä–∂–µ</h3>
                    <div id="balanceContent"></div>
                </div>
            </div>

            <!-- –°–µ–∫—Ü–∏—è –∏—Å—Ç–æ—Ä–∏–∏ —Ç–æ—Ä–≥–æ–≤–ª–∏ -->
            <div class="section">
                <h2>üìà –ò—Å—Ç–æ—Ä–∏—è —Ç–æ—Ä–≥–æ–≤–ª–∏</h2>
                <p>–î–µ—Ç–∞–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –≤—Å–µ—Ö —Å–¥–µ–ª–∫–∞—Ö</p>
                
                <div class="button-group">
                    <button class="btn btn-primary" onclick="getTradingHistory()">
                        üìä –ò—Å—Ç–æ—Ä–∏—è —Å–¥–µ–ª–æ–∫
                    </button>
                </div>
                
                <div id="tradingHistory" class="trading-history" style="display: none;">
                    <h3>üìà –ò—Å—Ç–æ—Ä–∏—è —Å–¥–µ–ª–æ–∫</h3>
                    <div id="historyContent"></div>
                </div>
            </div>

            <!-- –°–µ–∫—Ü–∏—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ -->
            <div class="section">
                <h2>üîç –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥</h2>
                <p>–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ –∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ —Ç–æ—Ä–≥–æ–≤–ª–∏ –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥</p>
                
                <div class="button-group">
                    <button class="btn btn-info" onclick="startMonitoring()">
                        üîÑ –ó–∞–ø—É—Å—Ç–∏—Ç—å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
                    </button>
                    <button class="btn btn-warning" onclick="stopMonitoring()">
                        ‚è∏Ô∏è –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
                    </button>
                    <button class="btn btn-primary" onclick="getModelPredictions()">
                        üß† –ü—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏—è –ò–ò
                    </button>
                    <button class="btn btn-primary" onclick="getPredictionStatistics()">
                        üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–π
                    </button>
                </div>
                
                <div id="monitoringStatus" class="status info" style="display: none;">
                    –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∞–∫—Ç–∏–≤–µ–Ω - —Å—Ç–∞—Ç—É—Å –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥
                </div>
                
                <!-- –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–æ—Ä–≥–æ–≤–ª–∏ –∏–∑ Celery -->
                <div id="tradingResults" class="trading-history" style="display: none;">
                    <h3>üìä –ü–æ—Å–ª–µ–¥–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–æ—Ä–≥–æ–≤–ª–∏ (Celery)</h3>
                    <div id="tradingResultsContent"></div>
                </div>
                
                <!-- –ò—Å—Ç–æ—Ä–∏—è —Å–¥–µ–ª–æ–∫ –∏–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö -->
                <div id="tradeHistory" class="trading-history" style="display: none;">
                    <h3>üìà –ò—Å—Ç–æ—Ä–∏—è —Å–¥–µ–ª–æ–∫ (–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö)</h3>
                    <div id="tradeHistoryContent"></div>
                </div>
                
                <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Å–¥–µ–ª–æ–∫ -->
                <div id="tradeStatistics" class="trading-history" style="display: none;">
                    <h3>üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Å–¥–µ–ª–æ–∫</h3>
                    <div id="tradeStatisticsContent"></div>
                </div>
                
                <!-- –°—Ç—Ä–∞—Ç–µ–≥–∏—è –¥–ª—è –æ—Å—Ç–∞–≤—à–µ–π—Å—è –ø–æ–∑–∏—Ü–∏–∏ -->
                <div id="remainingPositionStrategy" class="trading-history" style="display: none;">
                    <h3>üéØ –°—Ç—Ä–∞—Ç–µ–≥–∏—è –¥–ª—è –æ—Å—Ç–∞–≤—à–µ–π—Å—è –ø–æ–∑–∏—Ü–∏–∏</h3>
                    <div id="remainingStrategyContent"></div>
                </div>
                
                <!-- –ü—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏—è –º–æ–¥–µ–ª–∏ -->
                <div id="modelPredictions" class="trading-history" style="display: none;">
                    <h3>üß† –ü—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏—è –º–æ–¥–µ–ª–∏ –ò–ò</h3>
                    <div id="predictionsContent"></div>
                </div>
                
                <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–π -->
                <div id="predictionStatistics" class="trading-history" style="display: none;">
                    <h3>üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–π</h3>
                    <div id="predictionStatsContent"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let monitoringInterval = null;

        let modelsData = [];

        // –ó–∞–≥—Ä—É–∑–∫–∞ —Å–ø–∏—Å–∫–∞ –º–æ–¥–µ–ª–µ–π –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        async function loadModels() {
            try {
                const response = await fetch('/get_models_list');
                const result = await response.json();
                
                if (result.success) {
                    modelsData = result.models;
                    const modelSelect = document.getElementById('modelSelect');
                    modelSelect.innerHTML = '<option value="">–í—ã–±–µ—Ä–∏—Ç–µ –º–æ–¥–µ–ª—å...</option>';
                    
                    result.models.forEach(model => {
                        const option = document.createElement('option');
                        // –ü–æ–ª–Ω—ã–π –ø—É—Ç—å –¥–ª—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ trading_agent
                        option.value = `/workspace/good_models/${model.files.model}`;
                        option.textContent = `${model.id} (${model.date})`;
                        option.dataset.modelId = model.id;
                        modelSelect.appendChild(option);
                    });
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –º–æ–¥–µ–ª–µ–π:', error);
            }
        }

        // –ü–æ–∫–∞–∑–∞—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –≤—ã–±—Ä–∞–Ω–Ω–æ–π –º–æ–¥–µ–ª–∏
        function showModelInfo() {
            const modelSelect = document.getElementById('modelSelect');
            const modelInfo = document.getElementById('modelInfo');
            const modelInfoContent = document.getElementById('modelInfoContent');
            
            if (modelSelect.value) {
                const selectedOption = modelSelect.selectedOptions[0];
                const modelId = selectedOption.dataset.modelId;
                const model = modelsData.find(m => m.id === modelId);
                
                if (model) {
                    const stats = model.stats || {};
                    modelInfoContent.innerHTML = `
                        <div class="model-details">
                            <div class="model-detail-item">
                                <div class="model-detail-label">ID –º–æ–¥–µ–ª–∏</div>
                                <div class="model-detail-value">${model.id}</div>
                            </div>
                            <div class="model-detail-item">
                                <div class="model-detail-label">–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è</div>
                                <div class="model-detail-value">${model.date}</div>
                            </div>
                            <div class="model-detail-item">
                                <div class="model-detail-label">–†–∞–∑–º–µ—Ä –º–æ–¥–µ–ª–∏</div>
                                <div class="model-detail-value">${model.files.model_size}</div>
                            </div>
                            ${stats.winrate ? `
                            <div class="model-detail-item">
                                <div class="model-detail-label">Winrate</div>
                                <div class="model-detail-value">${(stats.winrate * 100).toFixed(1)}%</div>
                            </div>
                            <div class="model-detail-item">
                                <div class="model-detail-label">P/L Ratio</div>
                                <div class="model-detail-value">${stats.pl_ratio?.toFixed(2) || 'N/A'}</div>
                            </div>
                            <div class="model-detail-item">
                                <div class="model-detail-label">–°–¥–µ–ª–æ–∫</div>
                                <div class="model-detail-value">${stats.trades_count || 'N/A'}</div>
                            </div>
                            ` : '<div class="model-detail-item"><div class="model-detail-value">–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞</div></div>'}
                        </div>
                    `;
                    modelInfo.style.display = 'block';
                } else {
                    modelInfo.style.display = 'none';
                }
            } else {
                modelInfo.style.display = 'none';
            }
        }

        // –ó–∞–ø—É—Å–∫ —Ç–æ—Ä–≥–æ–≤–ª–∏
        async function startTrading() {
            const selectedSymbols = Array.from(document.querySelectorAll('.trading-symbol:checked')).map(checkbox => checkbox.value);
            const selectedModel = document.getElementById('modelSelect').value;
            
            if (!selectedModel) {
                showStatus('tradingResult', 'error', '–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ –º–æ–¥–µ–ª—å –¥–ª—è —Ç–æ—Ä–≥–æ–≤–ª–∏');
                return;
            }
            
            if (selectedSymbols.length === 0) {
                showStatus('tradingResult', 'error', '–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ —Ö–æ—Ç—è –±—ã –æ–¥–Ω—É —Ç–æ—Ä–≥–æ–≤—É—é –ø–∞—Ä—É');
                return;
            }
            
            try {
                const response = await fetch('/api/trading/start', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ 
                        symbols: selectedSymbols,
                        model_path: selectedModel
                    })
                });
                
                const result = await response.json();
                showStatus('tradingResult', result.success ? 'success' : 'error', 
                    result.success ? result.message : result.error);
                
                if (result.success) {
                    // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–ª—É—á–∞–µ–º —Å—Ç–∞—Ç—É—Å –ø–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞
                    setTimeout(getTradingStatus, 1000);
                }
            } catch (error) {
                showStatus('tradingResult', 'error', '–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ —Ç–æ—Ä–≥–æ–≤–ª–∏: ' + error.message);
            }
        }

        // –û—Å—Ç–∞–Ω–æ–≤–∫–∞ —Ç–æ—Ä–≥–æ–≤–ª–∏
        async function stopTrading() {
            try {
                const response = await fetch('/api/trading/stop', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    }
                });
                
                const result = await response.json();
                showStatus('tradingResult', result.success ? 'success' : 'error', 
                    result.success ? result.message : result.error);
                
                if (result.success) {
                    // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–ª—É—á–∞–µ–º —Å—Ç–∞—Ç—É—Å –ø–æ—Å–ª–µ –æ—Å—Ç–∞–Ω–æ–≤–∫–∏
                    setTimeout(getTradingStatus, 1000);
                }
            } catch (error) {
                showStatus('tradingResult', 'error', '–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Å—Ç–∞–Ω–æ–≤–∫–µ —Ç–æ—Ä–≥–æ–≤–ª–∏: ' + error.message);
            }
        }

        // –ü–æ–ª—É—á–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ —Ç–æ—Ä–≥–æ–≤–ª–∏
        async function getTradingStatus() {
            try {
                const response = await fetch('/api/trading/status');
                const result = await response.json();
                
                if (result.success) {
                    const statusDiv = document.getElementById('tradingStatus');
                    const contentDiv = document.getElementById('statusContent');
                    
                    let statusHTML = `
                        <p><strong>–°—Ç–∞—Ç—É—Å:</strong> ${result.trading_status || (result.is_trading ? 'üü¢ –ê–∫—Ç–∏–≤–Ω–∞ ' : 'üî¥ –û—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞')}</p>
                        <p><strong>–ü–∞—Ä–∞:</strong> ${result.symbol_display || result.symbol || '–ù–µ —É–∫–∞–∑–∞–Ω–∞'}</p>
                        <p><strong>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ:</strong> ${result.amount_display || result.amount || '–ù–µ —É–∫–∞–∑–∞–Ω–æ'}</p>
                        <p><strong>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ USDT:</strong> ${result.amount_usdt ? '$' + result.amount_usdt.toFixed(2) : '–ù–µ —É–∫–∞–∑–∞–Ω–æ'}</p>
                        <p><strong>–ü–æ–∑–∏—Ü–∏—è:</strong> ${result.position ? '–û—Ç–∫—Ä—ã—Ç–∞' : '–ù–µ—Ç'}</p>
                        <p><strong>–°–¥–µ–ª–æ–∫:</strong> ${result.trades_count}</p>
                        <p><strong>–¢–µ–∫—É—â–∞—è —Ü–µ–Ω–∞:</strong> ${result.current_price ? '$' + result.current_price.toFixed(2) : '–ù–µ —É–∫–∞–∑–∞–Ω–∞'}</p>
                        ${result.last_model_prediction ? `<p><strong>–ü–æ—Å–ª–µ–¥–Ω–µ–µ –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–µ:</strong> ${result.last_model_prediction}</p>` : ''}
                    `;
                    
                    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å—Ç—Ä–∞—Ç–µ–≥–∏—é –¥–ª—è –æ—Å—Ç–∞–≤—à–µ–π—Å—è –ø–æ–∑–∏—Ü–∏–∏, –µ—Å–ª–∏ –µ—Å—Ç—å
                    if (result.position && result.position.partial_sell_strategy) {
                        showRemainingPositionStrategy(result.position.partial_sell_strategy);
                    } else {
                        // –°–∫—Ä—ã–≤–∞–µ–º —Å–µ–∫—Ü–∏—é —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏, –µ—Å–ª–∏ –Ω–µ—Ç
                        document.getElementById('remainingPositionStrategy').style.display = 'none';
                    }
                    
                    contentDiv.innerHTML = statusHTML;
                    statusDiv.style.display = 'block';
                } else {
                    showStatus('tradingResult', 'error', result.error);
                }
            } catch (error) {
                showStatus('tradingResult', 'error', '–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ —Å—Ç–∞—Ç—É—Å–∞: ' + error.message);
            }
        }

        // –ü–æ–ª—É—á–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞
        async function getBalance() {
            try {
                const response = await fetch('/api/trading/balance');
                const result = await response.json();
                
                if (result.success) {
                    const balanceDiv = document.getElementById('balanceStatus');
                    const contentDiv = document.getElementById('balanceContent');
                    
                    contentDiv.innerHTML = `
                        <p><strong>USDT:</strong> ${result.balance.USDT.toFixed(2)}</p>
                        <p><strong>BTC:</strong> ${result.balance.BTC.toFixed(8)}</p>
                    `;
                    
                    balanceDiv.style.display = 'block';
                } else {
                    showStatus('tradingResult', 'error', result.error);
                }
            } catch (error) {
                showStatus('tradingResult', 'error', '–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –±–∞–ª–∞–Ω—Å–∞: ' + error.message);
            }
        }

        // –ü–æ–ª—É—á–µ–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏–∏ —Ç–æ—Ä–≥–æ–≤–ª–∏
        async function getTradingHistory() {
            try {
                const response = await fetch('/api/trading/history');
                const result = await response.json();
                
                if (result.success) {
                    const historyDiv = document.getElementById('tradingHistory');
                    const contentDiv = document.getElementById('historyContent');
                    
                    if (result.trades && result.trades.length > 0) {
                        let historyHTML = `<p><strong>–í—Å–µ–≥–æ —Å–¥–µ–ª–æ–∫:</strong> ${result.total_trades}</p>`;
                        
                        result.trades.forEach((trade, index) => {
                            const tradeTime = new Date(trade.time).toLocaleString('ru-RU');
                            const actionClass = trade.action === 'buy' ? 'buy' : 'sell';
                            
                            historyHTML += `
                                <div class="trade-item">
                                    <div class="trade-header">
                                        <span class="trade-action ${actionClass}">${trade.action.toUpperCase()}</span>
                                        <span>${tradeTime}</span>
                                    </div>
                                    <div class="trade-details">
                                        <div class="trade-detail">
                                            <div class="label">–¶–µ–Ω–∞</div>
                                            <div class="value">$${trade.price}</div>
                                        </div>
                                        <div class="trade-detail">
                                            <div class="label">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ</div>
                                            <div class="value">${trade.amount}</div>
                                        </div>
                                        ${trade.pnl ? `
                                        <div class="trade-detail">
                                            <div class="label">P&L</div>
                                            <div class="value" style="color: ${trade.pnl >= 0 ? 'green' : 'red'}">
                                                ${trade.pnl >= 0 ? '+' : ''}$${trade.pnl.toFixed(4)}
                                            </div>
                                        </div>
                                        ` : ''}
                                    </div>
                                </div>
                            `;
                        });
                        
                        contentDiv.innerHTML = historyHTML;
                    } else {
                        contentDiv.innerHTML = '<p>üìà –ò—Å—Ç–æ—Ä–∏—è —Å–¥–µ–ª–æ–∫ –ø–æ–∫–∞ –ø—É—Å—Ç–∞</p><p><em>–°–¥–µ–ª–∫–∏ –ø–æ—è–≤—è—Ç—Å—è –ø–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —Ç–æ—Ä–≥–æ–≤—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π</em></p>';
                    }
                    
                    historyDiv.style.display = 'block';
                } else {
                    showStatus('tradingResult', 'error', result.error);
                }
            } catch (error) {
                showStatus('tradingResult', 'error', '–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –∏—Å—Ç–æ—Ä–∏–∏: ' + error.message);
            }
        }

        // –ü–æ–ª—É—á–µ–Ω–∏–µ –ø–æ—Å–ª–µ–¥–Ω–∏—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ —Ç–æ—Ä–≥–æ–≤–ª–∏ –∏–∑ Celery
        async function getTradingResults() {
            try {
                const response = await fetch('/api/trading/latest_results');
                const result = await response.json();
                
                if (result.success) {
                    const resultsDiv = document.getElementById('tradingResults');
                    const contentDiv = document.getElementById('tradingResultsContent');
                    
                    if (result.latest_results && result.latest_results.length > 0) {
                        let resultsHTML = `<p><strong>–í—Å–µ–≥–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤:</strong> ${result.total_results}</p>`;
                        
                        result.latest_results.forEach((tradeResult, index) => {
                            const resultTime = new Date(tradeResult.timestamp).toLocaleString('ru-RU');
                            const successClass = tradeResult.exit_code === 0 ? 'success' : 'error';
                            
                            resultsHTML += `
                                <div class="trade-item">
                                    <div class="trade-header">
                                        <span class="trade-action ${successClass}">${tradeResult.exit_code === 0 ? '‚úÖ –£–°–ü–ï–•' : '‚ùå –û–®–ò–ë–ö–ê'}</span>
                                        <span>${resultTime}</span>
                                    </div>
                                    <div class="trade-details">
                                        <div class="trade-detail">
                                            <div class="label">–°–∏–º–≤–æ–ª—ã</div>
                                            <div class="value">${tradeResult.symbols ? tradeResult.symbols.join(', ') : 'N/A'}</div>
                                        </div>
                                        <div class="trade-detail">
                                            <div class="label">–ö–æ–¥ –≤—ã—Ö–æ–¥–∞</div>
                                            <div class="value">${tradeResult.exit_code}</div>
                                        </div>
                                        ${tradeResult.parsed_result ? `
                                        <div class="trade-detail">
                                            <div class="label">–î–µ–π—Å—Ç–≤–∏–µ</div>
                                            <div class="value">${tradeResult.parsed_result.action || 'N/A'}</div>
                                        </div>
                                        <div class="trade-detail">
                                            <div class="label">–¶–µ–Ω–∞</div>
                                            <div class="value">$${tradeResult.parsed_result.price || 'N/A'}</div>
                                        </div>
                                        ${tradeResult.parsed_result.trade_executed ? `
                                        <div class="trade-detail">
                                            <div class="label">–í—ã–ø–æ–ª–Ω–µ–Ω–æ</div>
                                            <div class="value">${tradeResult.parsed_result.trade_executed}</div>
                                        </div>
                                        ` : ''}
                                        ${tradeResult.parsed_result.position_pnl ? `
                                        <div class="trade-detail">
                                            <div class="label">P&L –ø–æ–∑–∏—Ü–∏–∏</div>
                                            <div class="value" style="color: ${tradeResult.parsed_result.position_pnl >= 0 ? 'green' : 'red'}">
                                                ${tradeResult.parsed_result.position_pnl >= 0 ? '+' : ''}${tradeResult.parsed_result.position_pnl.toFixed(2)}%
                                            </div>
                                        </div>
                                        ` : ''}
                                        ` : ''}
                                    </div>
                                    ${tradeResult.parse_error ? `
                                    <div style="margin-top: 10px; padding: 10px; background: #f8d7da; border-radius: 5px; font-size: 12px;">
                                        <strong>–û—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞:</strong> ${tradeResult.parse_error}
                                    </div>
                                    ` : ''}
                                </div>
                            `;
                        });
                        
                        contentDiv.innerHTML = resultsHTML;
                    } else {
                        contentDiv.innerHTML = '<p>üìä –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–æ—Ä–≥–æ–≤–ª–∏ –ø–æ–∫–∞ –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç</p><p><em>–î–∞–Ω–Ω—ã–µ –ø–æ—è–≤—è—Ç—Å—è –ø–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —Ç–æ—Ä–≥–æ–≤—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π —á–µ—Ä–µ–∑ Celery</em></p>';
                    }
                    
                    resultsDiv.style.display = 'block';
                } else {
                    console.error('–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤:', result.error);
                    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –±–ª–æ–∫ —Å –æ—à–∏–±–∫–æ–π
                    const resultsDiv = document.getElementById('tradingResults');
                    const contentDiv = document.getElementById('tradingResultsContent');
                    contentDiv.innerHTML = '<p>‚ùå –û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤</p><p><em>' + (result.error || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞') + '</em></p>';
                    resultsDiv.style.display = 'block';
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ —Ç–æ—Ä–≥–æ–≤–ª–∏:', error);
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –±–ª–æ–∫ —Å –æ—à–∏–±–∫–æ–π
                const resultsDiv = document.getElementById('tradingResults');
                const contentDiv = document.getElementById('tradingResultsContent');
                contentDiv.innerHTML = '<p>‚ùå –û—à–∏–±–∫–∞ —Å–µ—Ç–∏</p><p><em>' + error.message + '</em></p>';
                resultsDiv.style.display = 'block';
            }
        }

        // –ü–æ–ª—É—á–µ–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏–∏ —Å–¥–µ–ª–æ–∫ –∏–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
        async function getTradeHistory() {
            try {
                const response = await fetch('/api/trades/recent?limit=20');
                const result = await response.json();
                
                const historyDiv = document.getElementById('tradeHistory');
                const contentDiv = document.getElementById('tradeHistoryContent');
                
                if (result.success) {
                    if (result.trades && result.trades.length > 0) {
                        let historyHTML = '';
                        result.trades.forEach(trade => {
                            const statusClass = trade.is_successful ? 'success' : 'error';
                            const actionClass = trade.action === 'buy' ? 'buy' : trade.action === 'sell' ? 'sell' : 'hold';
                            
                            historyHTML += `
                                <div class="trade-item ${statusClass}">
                                    <div class="trade-header">
                                        <div class="trade-number">${trade.trade_number}</div>
                                        <div class="trade-symbol">${trade.symbol}</div>
                                        <div class="trade-action ${actionClass}">${trade.action.toUpperCase()}</div>
                                        <div class="trade-status">${trade.status}</div>
                                    </div>
                                    <div class="trade-details">
                                        <div class="trade-detail">
                                            <div class="label">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ</div>
                                            <div class="value">${trade.quantity}</div>
                                        </div>
                                        <div class="trade-detail">
                                            <div class="label">–¶–µ–Ω–∞</div>
                                            <div class="value">$${trade.price}</div>
                                        </div>
                                        <div class="trade-detail">
                                            <div class="label">–°—Ç–æ–∏–º–æ—Å—Ç—å</div>
                                            <div class="value">$${trade.total_value}</div>
                                        </div>
                                        ${trade.model_prediction ? `
                                        <div class="trade-detail">
                                            <div class="label">–ü—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–µ –º–æ–¥–µ–ª–∏</div>
                                            <div class="value">${trade.model_prediction}</div>
                                        </div>
                                        ` : ''}
                                        ${trade.position_pnl ? `
                                        <div class="trade-detail">
                                            <div class="label">P&L</div>
                                            <div class="value" style="color: ${trade.position_pnl >= 0 ? 'green' : 'red'}">
                                                ${trade.position_pnl >= 0 ? '+' : ''}${trade.position_pnl.toFixed(2)}
                                            </div>
                                        </div>
                                        ` : ''}
                                        <div class="trade-detail">
                                            <div class="label">–í—Ä–µ–º—è —Å–æ–∑–¥–∞–Ω–∏—è</div>
                                            <div class="value">${new Date(trade.created_at).toLocaleString()}</div>
                                        </div>
                                        ${trade.error_message ? `
                                        <div class="trade-detail">
                                            <div class="label">–û—à–∏–±–∫–∞</div>
                                            <div class="value error">${trade.error_message}</div>
                                        </div>
                                        ` : ''}
                                    </div>
                                </div>
                            `;
                        });
                        
                        contentDiv.innerHTML = historyHTML;
                    } else {
                        contentDiv.innerHTML = '<p>–ò—Å—Ç–æ—Ä–∏—è —Å–¥–µ–ª–æ–∫ –ø–æ–∫–∞ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç</p>';
                    }
                    
                    historyDiv.style.display = 'block';
                } else {
                    console.error('–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –∏—Å—Ç–æ—Ä–∏–∏ —Å–¥–µ–ª–æ–∫:', result.error);
                    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –±–ª–æ–∫ —Å –æ—à–∏–±–∫–æ–π
                    contentDiv.innerHTML = '<p>‚ùå –û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –∏—Å—Ç–æ—Ä–∏–∏ —Å–¥–µ–ª–æ–∫</p><p><em>' + (result.error || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞') + '</em></p>';
                    historyDiv.style.display = 'block';
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –∏—Å—Ç–æ—Ä–∏–∏ —Å–¥–µ–ª–æ–∫:', error);
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –±–ª–æ–∫ —Å –æ—à–∏–±–∫–æ–π
                const historyDiv = document.getElementById('tradeHistory');
                const contentDiv = document.getElementById('tradeHistoryContent');
                contentDiv.innerHTML = '<p>‚ùå –û—à–∏–±–∫–∞ —Å–µ—Ç–∏</p><p><em>' + error.message + '</em></p>';
                historyDiv.style.display = 'block';
            }
        }

        // –ü–æ–ª—É—á–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ —Å–¥–µ–ª–æ–∫
        async function getTradeStatistics() {
            try {
                const response = await fetch('/api/trades/statistics');
                const result = await response.json();
                
                const statsDiv = document.getElementById('tradeStatistics');
                const contentDiv = document.getElementById('tradeStatisticsContent');
                
                if (result.success) {
                    const stats = result.statistics;
                    const successRate = stats.success_rate || 0;
                    const successRateClass = successRate >= 50 ? 'success' : 'error';
                    
                    const statsHTML = `
                        <div class="statistics-grid">
                            <div class="stat-item">
                                <div class="stat-label">–í—Å–µ–≥–æ —Å–¥–µ–ª–æ–∫</div>
                                <div class="stat-value">${stats.total_trades}</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-label">–£—Å–ø–µ—à–Ω—ã—Ö —Å–¥–µ–ª–æ–∫</div>
                                <div class="stat-value success">${stats.successful_trades}</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-label">–ù–µ—É–¥–∞—á–Ω—ã—Ö —Å–¥–µ–ª–æ–∫</div>
                                <div class="stat-value error">${stats.failed_trades}</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-label">–ü—Ä–æ—Ü–µ–Ω—Ç —É—Å–ø–µ—Ö–∞</div>
                                <div class="stat-value ${successRateClass}">${successRate}%</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-label">–û–±—â–∏–π –æ–±—ä–µ–º</div>
                                <div class="stat-value">${stats.total_volume.toFixed(6)}</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-label">–û–±—â–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å</div>
                                <div class="stat-value">$${stats.total_value.toFixed(2)}</div>
                            </div>
                        </div>
                    `;
                    
                    contentDiv.innerHTML = statsHTML;
                    statsDiv.style.display = 'block';
                } else {
                    console.error('–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏:', result.error);
                    contentDiv.innerHTML = '<p>üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞</p><p><em>–û—à–∏–±–∫–∞: ' + (result.error || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞') + '</em></p>';
                    statsDiv.style.display = 'block';
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏:', error);
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –±–ª–æ–∫ —Å –æ—à–∏–±–∫–æ–π
                const statsDiv = document.getElementById('tradeStatistics');
                const contentDiv = document.getElementById('tradeStatisticsContent');
                contentDiv.innerHTML = '<p>‚ùå –û—à–∏–±–∫–∞ —Å–µ—Ç–∏</p><p><em>' + error.message + '</em></p>';
                statsDiv.style.display = 'block';
            }
        }

        // –ó–∞–ø—É—Å–∫ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
        function startMonitoring() {
            if (monitoringInterval) {
                clearInterval(monitoringInterval);
            }
            
            // –°—Ä–∞–∑—É –ø–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ
            getTradingStatus();
            getBalance();
            getTradingResults();
            getTradeHistory();
            getTradeStatistics();
            getModelPredictions();
            getPredictionStatistics();
            
            monitoringInterval = setInterval(() => {
                getTradingStatus();
                getBalance();
                getTradingResults();
                getTradeHistory();
                getTradeStatistics();
                getModelPredictions();
                getPredictionStatistics();
            }, 300000); 
            
            document.getElementById('monitoringStatus').style.display = 'block';
            showStatus('tradingResult', 'info', '–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∑–∞–ø—É—â–µ–Ω - –¥–∞–Ω–Ω—ã–µ –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥');
        }

        // –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
        function stopMonitoring() {
            if (monitoringInterval) {
                clearInterval(monitoringInterval);
                monitoringInterval = null;
            }
            
            document.getElementById('monitoringStatus').style.display = 'none';
            showStatus('tradingResult', 'info', '–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω');
        }

        // –ü–æ–∫–∞–∑–∞—Ç—å —Å—Ç–∞—Ç—É—Å
        function showStatus(elementId, type, message) {
            const element = document.getElementById(elementId);
            element.textContent = message;
            element.className = `status ${type}`;
            element.style.display = 'block';
            
            // –ê–≤—Ç–æ—Å–∫—Ä—ã—Ç–∏–µ —á–µ—Ä–µ–∑ 5 —Å–µ–∫—É–Ω–¥
            setTimeout(() => {
                element.style.display = 'none';
            }, 5000);
        }

        // –ü–æ–ª—É—á–µ–Ω–∏–µ –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–π –º–æ–¥–µ–ª–∏ –ò–ò
        async function getModelPredictions() {
            try {
                const response = await fetch('/api/predictions/recent?limit=50');
                const result = await response.json();
                
                const predictionsDiv = document.getElementById('modelPredictions');
                const contentDiv = document.getElementById('predictionsContent');
                
                if (result.success) {
                    if (result.predictions && result.predictions.length > 0) {
                        let predictionsHTML = `<p><strong>–í—Å–µ–≥–æ –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–π:</strong> ${result.total_predictions}</p>`;
                        
                        result.predictions.forEach(prediction => {
                            const predictionTime = new Date(prediction.timestamp).toLocaleString('ru-RU');
                            const actionClass = prediction.action === 'buy' ? 'buy' : prediction.action === 'sell' ? 'sell' : 'hold';
                            const confidenceClass = prediction.confidence > 0.5 ? 'success' : prediction.confidence > 0.2 ? 'info' : 'warning';
                            
                            predictionsHTML += `
                                <div class="trade-item">
                                    <div class="trade-header">
                                        <span class="trade-action ${actionClass}">${prediction.action.toUpperCase()}</span>
                                        <span class="trade-confidence ${confidenceClass}">–£–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å: ${(prediction.confidence * 100).toFixed(1)}%</span>
                                        <span>${predictionTime}</span>
                                    </div>
                                    <div class="trade-details">
                                        <div class="trade-detail">
                                            <div class="label">–°–∏–º–≤–æ–ª</div>
                                            <div class="value">${prediction.symbol}</div>
                                        </div>
                                        <div class="trade-detail">
                                            <div class="label">–¶–µ–Ω–∞</div>
                                            <div class="value">$${prediction.current_price?.toFixed(6) || 'N/A'}</div>
                                        </div>
                                        <div class="trade-detail">
                                            <div class="label">–ü–æ–∑–∏—Ü–∏—è</div>
                                            <div class="value">${prediction.position_status}</div>
                                        </div>
                                        <div class="trade-detail">
                                            <div class="label">Q-Values</div>
                                            <div class="value">[${prediction.q_values.map(v => v.toFixed(3)).join(', ')}]</div>
                                        </div>
                                    </div>
                                    ${prediction.market_conditions && Object.keys(prediction.market_conditions).length > 0 ? `
                                    <div style="margin-top: 10px; padding: 10px; background: #f8f9fa; border-radius: 5px; font-size: 12px;">
                                        <strong>–£—Å–ª–æ–≤–∏—è —Ä—ã–Ω–∫–∞:</strong><br>
                                        ${Object.entries(prediction.market_conditions).map(([key, value]) => 
                                            `${key}: ${value}`
                                        ).join(', ')}
                                    </div>
                                    ` : ''}
                                </div>
                            `;
                        });
                        
                        contentDiv.innerHTML = predictionsHTML;
                    } else {
                        contentDiv.innerHTML = '<p>üß† –ü—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏—è –º–æ–¥–µ–ª–∏ –ø–æ–∫–∞ –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç</p><p><em>–î–∞–Ω–Ω—ã–µ –ø–æ—è–≤—è—Ç—Å—è –ø–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —Ç–æ—Ä–≥–æ–≤—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π</em></p>';
                    }
                    
                    predictionsDiv.style.display = 'block';
                } else {
                    console.error('–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–π:', result.error);
                    contentDiv.innerHTML = '<p>‚ùå –û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–π</p><p><em>' + (result.error || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞') + '</em></p>';
                    predictionsDiv.style.display = 'block';
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–π:', error);
                const predictionsDiv = document.getElementById('modelPredictions');
                const contentDiv = document.getElementById('predictionsContent');
                contentDiv.innerHTML = '<p>‚ùå –û—à–∏–±–∫–∞ —Å–µ—Ç–∏</p><p><em>' + error.message + '</em></p>';
                predictionsDiv.style.display = 'block';
            }
        }

        // –ü–æ–ª—É—á–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–π
        async function getPredictionStatistics() {
            try {
                const response = await fetch('/api/predictions/statistics');
                const result = await response.json();
                
                const statsDiv = document.getElementById('predictionStatistics');
                const contentDiv = document.getElementById('predictionStatsContent');
                
                if (result.success) {
                    const stats = result.statistics;
                    
                    const statsHTML = `
                        <div class="statistics-grid">
                            <div class="stat-item">
                                <div class="stat-label">–í—Å–µ–≥–æ –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–π</div>
                                <div class="stat-value">${stats.total_predictions}</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-label">BUY —Å–∏–≥–Ω–∞–ª—ã</div>
                                <div class="stat-value buy">${stats.buy_predictions}</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-label">SELL —Å–∏–≥–Ω–∞–ª—ã</div>
                                <div class="stat-value sell">${stats.sell_predictions}</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-label">HOLD —Å–∏–≥–Ω–∞–ª—ã</div>
                                <div class="stat-value hold">${stats.hold_predictions}</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-label">–°—Ä–µ–¥–Ω—è—è —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å BUY</div>
                                <div class="stat-value">${stats.avg_confidence_buy}</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-label">–°—Ä–µ–¥–Ω—è—è —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å SELL</div>
                                <div class="stat-value">${stats.avg_confidence_sell}</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-label">–°—Ä–µ–¥–Ω—è—è —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å HOLD</div>
                                <div class="stat-value">${stats.avg_confidence_hold}</div>
                            </div>
                        </div>
                    `;
                    
                    contentDiv.innerHTML = statsHTML;
                    statsDiv.style.display = 'block';
                } else {
                    console.error('–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–π:', result.error);
                    contentDiv.innerHTML = '<p>üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–π –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞</p><p><em>–û—à–∏–±–∫–∞: ' + (result.error || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞') + '</em></p>';
                    statsDiv.style.display = 'block';
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–π:', error);
                const statsDiv = document.getElementById('predictionStatistics');
                const contentDiv = document.getElementById('predictionStatsContent');
                contentDiv.innerHTML = '<p>‚ùå –û—à–∏–±–∫–∞ —Å–µ—Ç–∏</p><p><em>' + error.message + '</em></p>';
                statsDiv.style.display = 'block';
            }
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ –æ—Å—Ç–∞–≤—à–µ–π—Å—è –ø–æ–∑–∏—Ü–∏–∏
        function showRemainingPositionStrategy(strategy) {
            const contentDiv = document.getElementById('remainingStrategyContent');
            const strategyDiv = document.getElementById('remainingPositionStrategy');
            
            if (strategy && strategy.type === 'remaining_position') {
                const createdTime = new Date(strategy.created_at).toLocaleString('ru-RU');
                const timeThreshold = new Date(strategy.time_threshold).toLocaleString('ru-RU');
                
                let strategyHTML = `
                    <div class="strategy-info">
                        <h4>üéØ –°—Ç—Ä–∞—Ç–µ–≥–∏—è –¥–ª—è –æ—Å—Ç–∞–≤—à–µ–π—Å—è –ø–æ–∑–∏—Ü–∏–∏</h4>
                        <div class="strategy-details">
                            <p><strong>–¢–∏–ø:</strong> ${strategy.type}</p>
                            <p><strong>–°–æ–∑–¥–∞–Ω–∞:</strong> ${createdTime}</p>
                            <p><strong>–í—Ä–µ–º—è –∏—Å—Ç–µ—á–µ–Ω–∏—è:</strong> ${timeThreshold}</p>
                            <p><strong>–ü–æ—Ä–æ–≥ —É–±—ã—Ç–∫–∞:</strong> <span class="negative">${strategy.sell_threshold}%</span></p>
                            <p><strong>–ü–æ—Ä–æ–≥ –ø—Ä–∏–±—ã–ª–∏:</strong> <span class="positive">${strategy.profit_threshold}%</span></p>
                            <p><strong>–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è –æ–∂–∏–¥–∞–Ω–∏—è:</strong> 24 —á–∞—Å–∞</p>
                        </div>
                        <div class="strategy-rules">
                            <h5>üìã –ü—Ä–∞–≤–∏–ª–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –ø—Ä–æ–¥–∞–∂–∏:</h5>
                            <ul>
                                <li>üö® <strong>–£–±—ã—Ç–æ–∫ > ${strategy.sell_threshold}%</strong> ‚Üí –ü—Ä–æ–¥–∞–µ–º –≤–µ—Å—å –æ—Å—Ç–∞—Ç–æ–∫</li>
                                <li>üí∞ <strong>–ü—Ä–∏–±—ã–ª—å > ${strategy.profit_threshold}%</strong> ‚Üí –ü—Ä–æ–¥–∞–µ–º –≤–µ—Å—å –æ—Å—Ç–∞—Ç–æ–∫</li>
                                <li>‚è∞ <strong>–í—Ä–µ–º—è > 24 —á–∞—Å–∞</strong> ‚Üí –ü—Ä–æ–¥–∞–µ–º –≤–µ—Å—å –æ—Å—Ç–∞—Ç–æ–∫</li>
                            </ul>
                        </div>
                    </div>
                `;
                
                contentDiv.innerHTML = strategyHTML;
                strategyDiv.style.display = 'block';
            } else {
                strategyDiv.style.display = 'none';
            }
        }
        
        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–ª—É—á–∞–µ–º —Å—Ç–∞—Ç—É—Å –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        window.addEventListener('load', () => {
            loadModels();
            getTradingStatus();
            getBalance();
        });
    </script>
</body>
</html>
