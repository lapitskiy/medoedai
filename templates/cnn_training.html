<!DOCTYPE html>
<html lang="ru">
<head>
    <link rel="stylesheet" href="/static/css/styles.css">
    <link rel="stylesheet" href="/static/css/sidebar.css">
    <link rel="stylesheet" href="/static/css/tabs.css">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MedoedAI - CNN Training</title>
    <style>
        /* –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Å—Ç–∏–ª–∏ –¥–ª—è CNN —Å—Ç—Ä–∞–Ω–∏—Ü—ã */
        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 15px;
        }
        
        .models-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 12px;
            margin-top: 15px;
        }
        
        .model-card {
            border: 1px solid #e5e7eb;
            border-radius: 6px;
            padding: 8px;
            background: #fafbfc;
            font-size: 12px;
        }
        
        .model-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 6px;
            padding-bottom: 6px;
            border-bottom: 1px solid #e5e7eb;
        }
        
        .model-header h5 {
            margin: 0;
            color: #1f2937;
            font-size: 14px;
        }
        
        .model-type {
            background: #3b82f6;
            color: white;
            padding: 1px 6px;
            border-radius: 10px;
            font-size: 10px;
            font-weight: 500;
        }
        
        .model-stats {
            margin-bottom: 8px;
        }
        
        .model-stats .stat {
            margin: 0;
            font-size: 11px;
            line-height: 1.3;
        }
        
        .model-actions {
            display: flex;
            gap: 4px;
        }
        
        .model-actions .btn {
            font-size: 10px;
            padding: 2px 6px;
        }
        
        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        
        .metric {
            text-align: center;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
            border: 1px solid #e5e7eb;
        }
        
        .metric-value {
            font-size: 24px;
            font-weight: bold;
            color: #1f2937;
            margin-bottom: 5px;
        }
        
        .metric-label {
            font-size: 12px;
            color: #6b7280;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .chart-placeholder {
            padding: 40px;
            text-align: center;
            background: #f8f9fa;
            border: 2px dashed #d1d5db;
            border-radius: 8px;
            color: #6b7280;
        }
        
        .logs-container {
            max-height: 300px;
            overflow-y: auto;
            background: #1f2937;
            color: #f9fafb;
            padding: 15px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
        }
        
        .log-entry {
            margin-bottom: 5px;
            padding: 2px 0;
        }
        
        .extraction-results {
            margin-top: 15px;
        }
        
        .result-item {
            margin-bottom: 10px;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 5px;
            border-left: 4px solid #3b82f6;
        }
        
        .form-text {
            font-size: 12px;
            color: #6b7280;
            margin-top: 5px;
        }
        
        .text-muted {
            color: #6b7280;
        }
        
        /* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤ */
        @media (max-width: 768px) {
            .form-row {
                grid-template-columns: 1fr;
            }
            
            .models-grid {
                grid-template-columns: 1fr;
            }
            
            .metrics-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }
    </style>
</head>
<body>
    <!-- Sidebar –Ω–∞–≤–∏–≥–∞—Ü–∏—è -->
    <nav class="sidebar">
        <h3>üìã –ù–∞–≤–∏–≥–∞—Ü–∏—è</h3>
        <ul class="sidebar-nav">
            <li><a href="/" class="back-link">‚Üê –ù–∞ –≥–ª–∞–≤–Ω—É—é</a></li>
            <li><a href="#training" onclick="scrollToSection('training')">üöÄ –û–±—É—á–µ–Ω–∏–µ CNN</a></li>
            <li><a href="#models" onclick="scrollToSection('models')">üìä –ú–æ–¥–µ–ª–∏ CNN</a></li>
            <li><a href="#extraction" onclick="scrollToSection('extraction')">üîß –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –ø—Ä–∏–∑–Ω–∞–∫–æ–≤</a></li>
            <li><a href="#monitoring" onclick="scrollToSection('monitoring')">üìà –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥</a></li>
        </ul>
    </nav>

    <!-- –ö–Ω–æ–ø–∫–∞ –º–æ–±–∏–ª—å–Ω–æ–≥–æ –º–µ–Ω—é -->
    <button class="mobile-menu-btn" onclick="toggleSidebar()">‚ò∞</button>

    <div class="container">
        <div class="main-content">
            <div class="header">
                <h1>üß† CNN Training - –ê–Ω–∞–ª–∏–∑ —Ç–æ—Ä–≥–æ–≤—ã—Ö –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤</h1>
                <p>–û–±—É—á–µ–Ω–∏–µ CNN –º–æ–¥–µ–ª–µ–π –¥–ª—è –∏–∑–≤–ª–µ—á–µ–Ω–∏—è –ø—Ä–∏–∑–Ω–∞–∫–æ–≤ –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤ –∫—Ä–∏–ø—Ç–æ–≤–∞–ª—é—Ç</p>
            </div>
            
            <div class="content">
            <div class="tabs" data-tabs="main">
                <div class="tabs-nav">
                    <button class="tab-btn active" data-tab-btn data-target="#training">üöÄ –û–±—É—á–µ–Ω–∏–µ CNN</button>
                    <button class="tab-btn" data-tab-btn data-target="#models">üìä –ú–æ–¥–µ–ª–∏ CNN</button>
                    <button class="tab-btn" data-tab-btn data-target="#extraction">üîß –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –ø—Ä–∏–∑–Ω–∞–∫–æ–≤</button>
                    <button class="tab-btn" data-tab-btn data-target="#monitoring">üìà –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥</button>
                </div>
                <div class="tabs-content">

                    <!-- –ü–∞–Ω–µ–ª—å –æ–±—É—á–µ–Ω–∏—è CNN -->
                    <div class="tab-panel" data-tab-panel id="training">
                        <div class="section">
                            <h2>üöÄ –û–±—É—á–µ–Ω–∏–µ CNN –º–æ–¥–µ–ª–µ–π</h2>
                            <p>–û–±—É—á–µ–Ω–∏–µ CNN –Ω–∞ –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏—Ö –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ —Ç–æ—Ä–≥–æ–≤—ã—Ö –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤ –∫—Ä–∏–ø—Ç–æ–≤–∞–ª—é—Ç</p>
                            
                            <!-- –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –æ–±—É—á–µ–Ω–∏—è -->
                            <div class="form-group">
                                <label>–°–∏–º–≤–æ–ª—ã –¥–ª—è –æ–±—É—á–µ–Ω–∏—è</label>
                                <div class="card" style="background: #f8f9fa; border: 1px solid #e9ecef;">
                                    <div class="card-body" style="padding: 15px;">
                                        <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px;">
                                            <div style="text-align: center; padding: 8px; background: #e3f2fd; border-radius: 6px; font-weight: bold;">BTCUSDT</div>
                                            <div style="text-align: center; padding: 8px; background: #f3e5f5; border-radius: 6px; font-weight: bold;">ETHUSDT</div>
                                            <div style="text-align: center; padding: 8px; background: #e8f5e8; border-radius: 6px; font-weight: bold;">BNBUSDT</div>
                                            <div style="text-align: center; padding: 8px; background: #fff3cd; border-radius: 6px; font-weight: bold;">ADAUSDT</div>
                                        </div>
                                        <div style="text-align: center; margin-top: 10px; font-size: 12px; color: #666;">
                                            –û–±—É—á–µ–Ω–∏–µ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –Ω–∞ –≤—Å–µ—Ö 4 —Å–∏–º–≤–æ–ª–∞—Ö –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ –¥–ª—è –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–≥–æ –æ–±—ä–µ–º–∞ –¥–∞–Ω–Ω—ã—Ö
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="form-group">
                                <label>–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è CNN</label>
                                <div class="card" style="background: #f8f9fa; border: 1px solid #e9ecef;">
                                    <div class="card-body" style="padding: 15px;">
                                        <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 15px; margin-bottom: 15px;">
                                            <div style="text-align: center; padding: 10px; background: #e3f2fd; border-radius: 8px;">
                                                <div style="font-weight: bold; color: #1976d2;">5 –º–∏–Ω—É—Ç</div>
                                                <div style="font-size: 14px; color: #424242; margin: 5px 0;">50 —Å–≤–µ—á–µ–π (~4.2—á)</div>
                                                <div style="font-size: 12px; color: #666;">–ë—ã—Å—Ç—Ä—ã–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã:<br>Engulfing, Hammer, Flags</div>
                                            </div>
                                            <div style="text-align: center; padding: 10px; background: #f3e5f5; border-radius: 8px;">
                                                <div style="font-weight: bold; color: #7b1fa2;">15 –º–∏–Ω—É—Ç</div>
                                                <div style="font-size: 14px; color: #424242; margin: 5px 0;">40 —Å–≤–µ—á–µ–π (~10—á)</div>
                                                <div style="font-size: 12px; color: #666;">–í–Ω—É—Ç—Ä–∏–¥–Ω–µ–≤–Ω—ã–µ:<br>–¢—Ä–µ—É–≥–æ–ª—å–Ω–∏–∫–∏, –ö–∞–Ω–∞–ª—ã</div>
                                            </div>
                                            <div style="text-align: center; padding: 10px; background: #e8f5e8; border-radius: 8px;">
                                                <div style="font-weight: bold; color: #388e3c;">1 —á–∞—Å</div>
                                                <div style="font-size: 14px; color: #424242; margin: 5px 0;">30 —Å–≤–µ—á–µ–π (~1.25–¥)</div>
                                                <div style="font-size: 12px; color: #666;">–°—Ä–µ–¥–Ω–µ—Å—Ä–æ—á–Ω—ã–µ:<br>Head & Shoulders, –£—Ä–æ–≤–Ω–∏</div>
                                            </div>
                                        </div>
                                        <div style="text-align: center; padding: 10px; background: #fff3cd; border-radius: 8px; margin-bottom: 10px;">
                                            <strong>üîß –ú—É–ª—å—Ç–∏—Ñ—Ä–µ–π–º–æ–≤–∞—è CNN</strong><br>
                                            <small>–í—Å–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –æ–±—É—á–µ–Ω–∏—è –±–µ—Ä—É—Ç—Å—è –∏–∑ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ (config.py)</small>
                                        </div>
                                        <small class="form-text text-muted">–ú—É–ª—å—Ç–∏—Ñ—Ä–µ–π–º–æ–≤–∞—è CNN –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç –ø–∞—Ç—Ç–µ—Ä–Ω—ã —Ä–∞–∑–Ω—ã—Ö –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –º–∞—Å—à—Ç–∞–±–æ–≤ –¥–ª—è –∫–æ–º–ø–ª–µ–∫—Å–Ω–æ–≥–æ –ø–æ–Ω–∏–º–∞–Ω–∏—è —Ä—ã–Ω–∫–∞</small>
                                    </div>
                                </div>
                            </div>

                            <div class="button-group">
                                <button class="btn btn-primary" onclick="startCNNTraining()">
                                    üöÄ –ù–∞—á–∞—Ç—å –æ–±—É—á–µ–Ω–∏–µ CNN
                                </button>
                                <button class="btn btn-info" onclick="loadCNNExamples()">
                                    üìö –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
                                </button>
                            </div>

                            <!-- –°—Ç–∞—Ç—É—Å –æ–±—É—á–µ–Ω–∏—è -->
                            <div id="cnnTrainingStatus" class="status" style="display: none;"></div>
                            <div id="cnnTrainingResults" class="results" style="display: none;"></div>
                        </div>
                    </div>

                    <!-- –ü–∞–Ω–µ–ª—å –º–æ–¥–µ–ª–µ–π CNN -->
                    <div class="tab-panel" data-tab-panel id="models">
                        <div class="section">
                            <h2>üìä –û–±—É—á–µ–Ω–Ω—ã–µ CNN –º–æ–¥–µ–ª–∏</h2>
                            <p>–°–ø–∏—Å–æ–∫ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö CNN –º–æ–¥–µ–ª–µ–π –∏ –∏—Ö —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</p>
                            
                            <div class="button-group">
                                <button class="btn btn-info" onclick="refreshCNNModels()">
                                    üîÑ –û–±–Ω–æ–≤–∏—Ç—å —Å–ø–∏—Å–æ–∫ –º–æ–¥–µ–ª–µ–π
                                </button>
                                <button class="btn btn-warning" onclick="testCNNModel()">
                                    üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –º–æ–¥–µ–ª—å
                                </button>
                            </div>

                            <div id="cnnModelsList" class="results">
                                <div class="loading">
                                    <div class="spinner"></div>
                                    –ó–∞–≥—Ä—É–∑–∫–∞ —Å–ø–∏—Å–∫–∞ –º–æ–¥–µ–ª–µ–π...
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- –ü–∞–Ω–µ–ª—å –∏–∑–≤–ª–µ—á–µ–Ω–∏—è –ø—Ä–∏–∑–Ω–∞–∫–æ–≤ -->
                    <div class="tab-panel" data-tab-panel id="extraction">
                        <div class="section">
                            <h2>üîß –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –ø—Ä–∏–∑–Ω–∞–∫–æ–≤ –¥–ª—è DQN</h2>
                            <p>–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏–∑–≤–ª–µ—á–µ–Ω–∏—è CNN –ø—Ä–∏–∑–Ω–∞–∫–æ–≤ –¥–ª—è DQN –∞–≥–µ–Ω—Ç–∞</p>
                            
                            <div class="form-group">
                                <label>–í—ã–±–µ—Ä–∏—Ç–µ CNN –º–æ–¥–µ–ª—å</label>
                                <select id="extractionModelSelect" class="form-control">
                                    <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –º–æ–¥–µ–ª—å...</option>
                                </select>
                            </div>

                            <div class="form-group">
                                <label>–¢–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ</label>
                                <select id="extractionTestData" class="form-control">
                                    <option value="BTCUSDT">BTCUSDT</option>
                                    <option value="ETHUSDT">ETHUSDT</option>
                                    <option value="TONUSDT">TONUSDT</option>
                                </select>
                            </div>

                            <div class="button-group">
                                <button class="btn btn-primary" onclick="testFeatureExtraction()">
                                    üîß –¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ –ø—Ä–∏–∑–Ω–∞–∫–æ–≤
                                </button>
                                <button class="btn btn-success" onclick="integrateWithDQN()">
                                    ü§ñ –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å —Å DQN
                                </button>
                            </div>

                            <div id="extractionResults" class="results" style="display: none;"></div>
                        </div>
                    </div>

                    <!-- –ü–∞–Ω–µ–ª—å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ -->
                    <div class="tab-panel" data-tab-panel id="monitoring">
                        <div class="section">
                            <h2>üìà –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –æ–±—É—á–µ–Ω–∏—è</h2>
                            <p>–û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ –æ–±—É—á–µ–Ω–∏—è CNN –º–æ–¥–µ–ª–µ–π</p>
                            
                            <div class="button-group">
                                <button class="btn btn-info" onclick="startMonitoring()">
                                    üì° –ó–∞–ø—É—Å—Ç–∏—Ç—å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
                                </button>
                                <button class="btn btn-warning" onclick="stopMonitoring()">
                                    ‚èπÔ∏è –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
                                </button>
                            </div>

                            <!-- –ì—Ä–∞—Ñ–∏–∫–∏ –∏ –º–µ—Ç—Ä–∏–∫–∏ -->
                            <div id="monitoringCharts" class="results">
                                <div class="chart-container">
                                    <h4>üìä –ú–µ—Ç—Ä–∏–∫–∏ –æ–±—É—á–µ–Ω–∏—è</h4>
                                    <div id="trainingMetrics" class="chart-placeholder">
                                        –ì—Ä–∞—Ñ–∏–∫ –º–µ—Ç—Ä–∏–∫ –ø–æ—è–≤–∏—Ç—Å—è –ø–æ—Å–ª–µ –Ω–∞—á–∞–ª–∞ –æ–±—É—á–µ–Ω–∏—è
                                    </div>
                                </div>
                            </div>

                            <!-- –õ–æ–≥–∏ –æ–±—É—á–µ–Ω–∏—è -->
                            <div id="trainingLogs" class="results" style="display: none;">
                                <h4>üìù –õ–æ–≥–∏ –æ–±—É—á–µ–Ω–∏—è</h4>
                                <div id="logsContent" class="logs-container"></div>
                            </div>
                        </div>
                    </div>
                </div><!-- /tabs-content -->
            </div><!-- /tabs -->
            </div>
        </div>
    </div>

    <script>
        // –°–≤—è–∑—ã–≤–∞–µ–º –ø–µ—Ä–µ—Ö–æ–¥ –∏–∑ —Å–∞–π–¥–±–∞—Ä–∞ —Å –∞–∫—Ç–∏–≤–∞—Ü–∏–µ–π —Ç–∞–±–æ–≤
        document.addEventListener('DOMContentLoaded', function(){
            try{
                document.querySelectorAll('.sidebar-nav a[href^="#"]').forEach(a => {
                    a.addEventListener('click', function(){
                        const href = a.getAttribute('href');
                        if(href){
                            try{ window.__tabs && window.__tabs.activateTabByAnchor('[data-tabs="main"]', href); }catch(_){ }
                        }
                    });
                });
            }catch(_){ }
            
            // –ó–∞–≥—Ä—É–∂–∞–µ–º —Å–ø–∏—Å–æ–∫ –º–æ–¥–µ–ª–µ–π –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
            refreshCNNModels();
            loadExtractionModels();
        });

        // === –û–±—É—á–µ–Ω–∏–µ CNN ===
        async function startCNNTraining() {
            console.log('üîç 1. –§—É–Ω–∫—Ü–∏—è startCNNTraining –∑–∞–ø—É—â–µ–Ω–∞');
            
            const statusDiv = document.getElementById('cnnTrainingStatus');
            const resultsDiv = document.getElementById('cnnTrainingResults');
            const button = document.querySelector('button[onclick="startCNNTraining()"]');
            
            console.log('üîç 2. –≠–ª–µ–º–µ–Ω—Ç—ã –Ω–∞–π–¥–µ–Ω—ã:', {statusDiv, resultsDiv, button});
            
            // –°–æ–±–∏—Ä–∞–µ–º –ø–∞—Ä–∞–º–µ—Ç—Ä—ã - –∏—Å–ø–æ–ª—å–∑—É–µ–º –í–°–ï —Å–∏–º–≤–æ–ª—ã –∏–∑ –∫–æ–Ω—Ñ–∏–≥–∞ –¥–ª—è –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–≥–æ –æ–±—ä–µ–º–∞ –¥–∞–Ω–Ω—ã—Ö
            const symbols = ["BTCUSDT", "ETHUSDT", "BNBUSDT", "ADAUSDT"]; // –í—Å–µ —Å–∏–º–≤–æ–ª—ã –∏–∑ –∫–æ–Ω—Ñ–∏–≥–∞
            const timeframes = ["5m", "15m", "1h"]; // –§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ñ—Ä–µ–π–º—ã –¥–ª—è –º—É–ª—å—Ç–∏—Ñ—Ä–µ–π–º–æ–≤–æ–π –º–æ–¥–µ–ª–∏
            const modelType = "multiframe"; // –í—Å–µ–≥–¥–∞ –º—É–ª—å—Ç–∏—Ñ—Ä–µ–π–º–æ–≤–∞—è –º–æ–¥–µ–ª—å

            console.log('üîç 3. –ü–∞—Ä–∞–º–µ—Ç—Ä—ã —Å–æ–±—Ä–∞–Ω—ã:', {
                symbols, timeframes, modelType
            });

            console.log('üîç 4. –°–∏–º–≤–æ–ª—ã —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω—ã, –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–µ –Ω—É–∂–Ω–∞');

            // –û—Ç–∫–ª—é—á–∞–µ–º –∫–Ω–æ–ø–∫—É –∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Å—Ç–∞—Ç—É—Å
            if (button) {
                button.disabled = true;
                button.textContent = '‚è≥ –ó–∞–ø—É—Å–∫ –æ–±—É—á–µ–Ω–∏—è...';
            }
            if (statusDiv) {
                statusDiv.className = 'status running';
                statusDiv.textContent = 'üöÄ –ó–∞–ø—É—Å–∫ –æ–±—É—á–µ–Ω–∏—è CNN –º–æ–¥–µ–ª–µ–π...';
                statusDiv.style.display = 'block';
            }

            console.log('üîç 6. UI –æ–±–Ω–æ–≤–ª–µ–Ω, –Ω–∞—á–∏–Ω–∞–µ–º fetch –∑–∞–ø—Ä–æ—Å');

            try {
                console.log('üîç 7. –û—Ç–ø—Ä–∞–≤–ª—è–µ–º fetch –∑–∞–ø—Ä–æ—Å –∫ /cnn/start_training');
                
                const response = await fetch('/cnn/start_training', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        symbols: symbols,
                        timeframes: timeframes,
                        model_type: modelType
                        // –û—Å—Ç–∞–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –±–µ—Ä—É—Ç—Å—è –∏–∑ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
                    })
                });

                console.log('üîç 8. –û—Ç–≤–µ—Ç –ø–æ–ª—É—á–µ–Ω:', response.status, response.statusText);

                const result = await response.json();
                console.log('üîç 9. –†–µ–∑—É–ª—å—Ç–∞—Ç –ø–∞—Ä—Å–∏–Ω–≥–∞ JSON:', result);

                if (result.success) {
                    statusDiv.className = 'status success';
                    statusDiv.textContent = '‚úÖ –û–±—É—á–µ–Ω–∏–µ CNN –∑–∞–ø—É—â–µ–Ω–æ —É—Å–ø–µ—à–Ω–æ!';
                    
                    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –¥–µ—Ç–∞–ª–∏
                    resultsDiv.style.display = 'block';
                    resultsDiv.innerHTML = `
                        <h4>üìä –î–µ—Ç–∞–ª–∏ –æ–±—É—á–µ–Ω–∏—è:</h4>
                        <ul>
                            <li><strong>–°–∏–º–≤–æ–ª—ã:</strong> ${symbols.join(', ')} (${symbols.length} —Å–∏–º–≤–æ–ª–æ–≤)</li>
                            <li><strong>–í—Ä–µ–º–µ–Ω–Ω—ã–µ —Ñ—Ä–µ–π–º—ã:</strong> 5 –º–∏–Ω—É—Ç (50 —Å–≤–µ—á–µ–π), 15 –º–∏–Ω—É—Ç (40 —Å–≤–µ—á–µ–π), 1 —á–∞—Å (30 —Å–≤–µ—á–µ–π)</li>
                            <li><strong>–¢–∏–ø –º–æ–¥–µ–ª–∏:</strong> ${modelType}</li>
                            <li><strong>–û–∂–∏–¥–∞–µ–º—ã–π –æ–±—ä–µ–º –¥–∞–Ω–Ω—ã—Ö:</strong> ~${symbols.length * 5000} –æ–±—Ä–∞–∑—Ü–æ–≤</li>
                            <li><strong>–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è:</strong> –í—Å–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –±–µ—Ä—É—Ç—Å—è –∏–∑ config.py</li>
                        </ul>
                        <p><strong>Task ID:</strong> ${result.task_id || 'N/A'}</p>
                        <p>üí° –û–±—É—á–µ–Ω–∏–µ –Ω–∞ ${symbols.length} —Å–∏–º–≤–æ–ª–∞—Ö –∑–∞–π–º–µ—Ç –±–æ–ª—å—à–µ –≤—Ä–µ–º–µ–Ω–∏, –Ω–æ –¥–∞—Å—Ç –ª—É—á—à–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã!</p>
                    `;
                } else {
                    statusDiv.className = 'status error';
                    statusDiv.textContent = '‚ùå –û—à–∏–±–∫–∞ –∑–∞–ø—É—Å–∫–∞ –æ–±—É—á–µ–Ω–∏—è: ' + (result.error || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞');
                }

            } catch (error) {
                console.error('‚ùå 10. –û—à–∏–±–∫–∞ –≤ fetch –∑–∞–ø—Ä–æ—Å–µ:', error);
                if (statusDiv) {
                    statusDiv.className = 'status error';
                    statusDiv.textContent = '‚ùå –û—à–∏–±–∫–∞ —Å–µ—Ç–∏: ' + error.message;
                }
            } finally {
                console.log('üîç 11. –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∫–Ω–æ–ø–∫—É');
                if (button) {
                    button.disabled = false;
                    button.textContent = 'üöÄ –ù–∞—á–∞—Ç—å –æ–±—É—á–µ–Ω–∏–µ CNN';
                }
            }
        }

        // === –ó–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–∏–º–µ—Ä–æ–≤ ===
        async function loadCNNExamples() {
            const statusDiv = document.getElementById('cnnTrainingStatus');
            const resultsDiv = document.getElementById('cnnTrainingResults');
            
            statusDiv.className = 'status running';
            statusDiv.textContent = 'üìö –ó–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–∏–º–µ—Ä–æ–≤ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è...';
            statusDiv.style.display = 'block';

            try {
                const response = await fetch('/cnn/examples');
                const result = await response.json();

                if (result.success) {
                    statusDiv.className = 'status success';
                    statusDiv.textContent = '‚úÖ –ü—Ä–∏–º–µ—Ä—ã –∑–∞–≥—Ä—É–∂–µ–Ω—ã';
                    
                    resultsDiv.style.display = 'block';
                    resultsDiv.innerHTML = `
                        <h4>üìö –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è CNN –º–æ–¥—É–ª—è:</h4>
                        <pre style="background: #f8f9fa; padding: 15px; border-radius: 5px; overflow-x: auto;">${result.examples || '–ü—Ä–∏–º–µ—Ä—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã'}</pre>
                    `;
                } else {
                    statusDiv.className = 'status error';
                    statusDiv.textContent = '‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø—Ä–∏–º–µ—Ä–æ–≤';
                }
            } catch (error) {
                statusDiv.className = 'status error';
                statusDiv.textContent = '‚ùå –û—à–∏–±–∫–∞ —Å–µ—Ç–∏: ' + error.message;
            }
        }

        // === –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –º–æ–¥–µ–ª–µ–π ===
        async function refreshCNNModels() {
            const modelsDiv = document.getElementById('cnnModelsList');
            modelsDiv.innerHTML = '<div class="loading"><div class="spinner"></div>–ó–∞–≥—Ä—É–∑–∫–∞ –º–æ–¥–µ–ª–µ–π...</div>';

            try {
                const response = await fetch('/cnn/models');
                const result = await response.json();

                if (result.success && result.models) {
                    if (result.models.length === 0) {
                        modelsDiv.innerHTML = `
                            <div class="status info">
                                üì≠ –û–±—É—á–µ–Ω–Ω—ã–µ CNN –º–æ–¥–µ–ª–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã<br>
                                <small>–ó–∞–ø—É—Å—Ç–∏—Ç–µ –æ–±—É—á–µ–Ω–∏–µ –Ω–∞ –≤–∫–ª–∞–¥–∫–µ "–û–±—É—á–µ–Ω–∏–µ CNN"</small>
                            </div>
                        `;
                    } else {
                        let modelsHTML = '<h4>üìä –î–æ—Å—Ç—É–ø–Ω—ã–µ CNN –º–æ–¥–µ–ª–∏:</h4><div class="models-grid">';
                        
                        result.models.forEach(model => {
                            const accuracy = model.accuracy ? model.accuracy.toFixed(1) + '%' : 'N/A';
                            const size = model.size ? (model.size / 1024 / 1024).toFixed(1) + ' MB' : 'N/A';
                            const created = model.created ? new Date(model.created).toLocaleString('ru-RU') : 'N/A';
                            const timeframes = model.timeframes ? model.timeframes.join(', ') : 'N/A';
                            const symbols_trained = model.symbols_trained ? model.symbols_trained.join(', ') : model.symbol;
                            const epochs = model.epochs_trained || 'N/A';
                            const trainLoss = model.train_loss ? model.train_loss.toFixed(4) : 'N/A';
                            const valLoss = model.val_loss ? model.val_loss.toFixed(4) : 'N/A';
                            
                            modelsHTML += `
                                <div class="model-card">
                                    <div class="model-header">
                                        <h5>${model.symbol || 'Unknown'} - ${model.model_type || 'unknown'}</h5>
                                        <span class="model-type">${model.model_type || 'unknown'}</span>
                                    </div>
                                    <div class="model-stats">
                                        <div class="stat"><strong>–°–∏–º–≤–æ–ª—ã:</strong> ${symbols_trained}<br>
                                        <strong>–§—Ä–µ–π–º—ã:</strong> ${timeframes}<br>
                                        <strong>–¢–æ—á–Ω–æ—Å—Ç—å:</strong> ${accuracy}<br>
                                        <strong>–≠–ø–æ—Ö–∏:</strong> ${epochs}<br>
                                        <strong>Train Loss:</strong> ${trainLoss}<br>
                                        <strong>Val Loss:</strong> ${valLoss}<br>
                                        <strong>–†–∞–∑–º–µ—Ä:</strong> ${size}<br>
                                        <strong>–°–æ–∑–¥–∞–Ω–∞:</strong> ${created}<br>
                                        <strong>Run ID:</strong> ${model.run_id || 'N/A'}<br>
                                        <strong>–§–∞–π–ª:</strong> <code>${model.model_file || 'N/A'}</code></div>
                                    </div>
                                    <div class="model-actions">
                                        <button class="btn btn-sm btn-info" onclick="testCNNModel('${model.path}')">üß™ –¢–µ—Å—Ç</button>
                                        <button class="btn btn-sm btn-warning" onclick="downloadCNNModel('${model.path}')">üíæ –°–∫–∞—á–∞—Ç—å</button>
                                        <button class="btn btn-sm btn-success" onclick="viewModelDetails('${model.run_id}', '${model.symbol}')">üìä –î–µ—Ç–∞–ª–∏</button>
                                    </div>
                                </div>
                            `;
                        });
                        
                        modelsHTML += '</div>';
                        modelsDiv.innerHTML = modelsHTML;
                    }
                } else {
                    modelsDiv.innerHTML = '<div class="status error">‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –º–æ–¥–µ–ª–µ–π</div>';
                }
            } catch (error) {
                modelsDiv.innerHTML = `<div class="status error">‚ùå –û—à–∏–±–∫–∞ —Å–µ—Ç–∏: ${error.message}</div>`;
            }
        }

        // === –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –º–æ–¥–µ–ª–∏ –Ω–∞ –Ω–æ–≤—ã—Ö —Å–∏–º–≤–æ–ª–∞—Ö ===
        async function testCNNModel(modelPath = null) {
            const statusDiv = document.getElementById('cnnTrainingStatus');
            
            statusDiv.className = 'status running';
            statusDiv.textContent = 'üß™ –í–∞–ª–∏–¥–∞—Ü–∏—è CNN –º–æ–¥–µ–ª–∏ –Ω–∞ –Ω–æ–≤—ã—Ö —Å–∏–º–≤–æ–ª–∞—Ö...';
            statusDiv.style.display = 'block';

            try {
                // –¢–µ—Å—Ç–∏—Ä—É–µ–º –Ω–∞ —Å–∏–º–≤–æ–ª–∞—Ö, –∫–æ—Ç–æ—Ä—ã–µ –ù–ï —É—á–∞—Å—Ç–≤–æ–≤–∞–ª–∏ –≤ –æ–±—É—á–µ–Ω–∏–∏
                const testSymbols = ['SOLUSDT', 'XRPUSDT', 'TONUSDT'];
                const testPeriod = 'last_year'; // –ü–æ—Å–ª–µ–¥–Ω–∏–π –≥–æ–¥ –¥–∞–Ω–Ω—ã—Ö
                
                const response = await fetch('/cnn/validate_model', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        model_path: modelPath,
                        test_symbols: testSymbols,
                        test_period: testPeriod,
                        validation_type: 'cross_symbol' // –¢–∏–ø –≤–∞–ª–∏–¥–∞—Ü–∏–∏
                    })
                });

                const result = await response.json();

                if (result.success) {
                    statusDiv.className = 'status success';
                    statusDiv.textContent = '‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è –Ω–∞ –Ω–æ–≤—ã—Ö —Å–∏–º–≤–æ–ª–∞—Ö –∑–∞–≤–µ—Ä—à–µ–Ω–∞';
                    
                    const resultsDiv = document.getElementById('cnnTrainingResults');
                    resultsDiv.style.display = 'block';
                    
                    // –ö—Ä–∞—Å–∏–≤–æ –æ—Ç–æ–±—Ä–∞–∂–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ –∫–∞–∂–¥–æ–º—É —Å–∏–º–≤–æ–ª—É
                    let resultsHTML = `
                        <h4>üß™ –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –Ω–∞ –Ω–æ–≤—ã—Ö —Å–∏–º–≤–æ–ª–∞—Ö:</h4>
                        <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin-bottom: 15px;">
                            <strong>üìä –û–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞:</strong><br>
                            <strong>–°–∏–º–≤–æ–ª—ã –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:</strong> ${testSymbols.join(', ')}<br>
                            <strong>–ü–µ—Ä–∏–æ–¥ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:</strong> –ü–æ—Å–ª–µ–¥–Ω–∏–π –≥–æ–¥ (2024)<br>
                            <strong>–û–±—Ä–∞–∑—Ü–æ–≤ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–æ:</strong> ${result.total_samples || 'N/A'}<br>
                            <strong>–°—Ä–µ–¥–Ω—è—è —Ç–æ—á–Ω–æ—Å—Ç—å:</strong> ${result.overall_accuracy ? (result.overall_accuracy * 100).toFixed(1) + '%' : 'N/A'}
                        </div>
                    `;
                    
                    // –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ –∫–∞–∂–¥–æ–º—É —Å–∏–º–≤–æ–ª—É
                    if (result.symbol_results) {
                        resultsHTML += '<div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 15px;">';
                        
                        result.symbol_results.forEach(symbolResult => {
                            const accuracy = symbolResult.accuracy ? (symbolResult.accuracy * 100).toFixed(1) + '%' : 'N/A';
                            const samples = symbolResult.samples_tested || 'N/A';
                            const confidence = symbolResult.avg_confidence ? (symbolResult.avg_confidence * 100).toFixed(1) + '%' : 'N/A';
                            
                            // –¶–≤–µ—Ç–æ–≤–∞—è –∏–Ω–¥–∏–∫–∞—Ü–∏—è –∫–∞—á–µ—Å—Ç–≤–∞
                            let accuracyColor = '#dc3545'; // –ö—Ä–∞—Å–Ω—ã–π
                            if (symbolResult.accuracy > 0.7) accuracyColor = '#28a745'; // –ó–µ–ª–µ–Ω—ã–π
                            else if (symbolResult.accuracy > 0.6) accuracyColor = '#ffc107'; // –ñ–µ–ª—Ç—ã–π
                            
                            resultsHTML += `
                                <div style="border: 1px solid #e5e7eb; border-radius: 8px; padding: 15px; background: white;">
                                    <h5 style="margin: 0 0 10px 0; color: #1f2937;">${symbolResult.symbol}</h5>
                                    <div style="font-size: 14px; line-height: 1.4;">
                                        <div style="margin-bottom: 8px;">
                                            <strong>–¢–æ—á–Ω–æ—Å—Ç—å:</strong> 
                                            <span style="color: ${accuracyColor}; font-weight: bold;">${accuracy}</span>
                                        </div>
                                        <div style="margin-bottom: 8px;">
                                            <strong>–û–±—Ä–∞–∑—Ü–æ–≤:</strong> ${samples}
                                        </div>
                                        <div style="margin-bottom: 8px;">
                                            <strong>–£–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å:</strong> ${confidence}
                                        </div>
                                        <div style="margin-bottom: 8px;">
                                            <strong>–ü–µ—Ä–∏–æ–¥:</strong> ${symbolResult.test_period || '–ü–æ—Å–ª–µ–¥–Ω–∏–π –≥–æ–¥'}
                                        </div>
                                        ${symbolResult.patterns_detected ? `
                                            <div style="margin-top: 10px; padding-top: 8px; border-top: 1px solid #e5e7eb;">
                                                <strong>–û–±–Ω–∞—Ä—É–∂–µ–Ω–æ –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤:</strong><br>
                                                <small style="color: #6b7280;">${symbolResult.patterns_detected.join(', ')}</small>
                                            </div>
                                        ` : ''}
                                    </div>
                                </div>
                            `;
                        });
                        
                        resultsHTML += '</div>';
                    }
                    
                    // –î–µ—Ç–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑ (–µ—Å–ª–∏ –¥–æ—Å—Ç—É–ø–µ–Ω)
                    if (result.detailed_analysis) {
                        const analysis = result.detailed_analysis;
                        
                        // –ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫ –ø—Ä–æ–¥–∞–∫—à–µ–Ω—É
                        if (analysis.production_readiness) {
                            const readiness = analysis.production_readiness;
                            let readinessColor = '#dc3545';
                            if (readiness.readiness_level === 'production_ready') readinessColor = '#28a745';
                            else if (readiness.readiness_level === 'near_ready') readinessColor = '#ffc107';
                            
                            resultsHTML += `
                                <div style="margin-top: 20px; padding: 15px; background: #f8f9fa; border-radius: 8px; border-left: 4px solid ${readinessColor};">
                                    <h5 style="margin: 0 0 10px 0; color: ${readinessColor};">üöÄ –ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫ –ø—Ä–æ–¥–∞–∫—à–µ–Ω—É</h5>
                                    <div style="font-size: 14px;">
                                        <strong>–û—Ü–µ–Ω–∫–∞:</strong> ${readiness.readiness_message}<br>
                                        <strong>–ë–∞–ª–ª –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏:</strong> ${(readiness.readiness_score * 100).toFixed(0)}%<br>
                                        <strong>–û–±—â–∞—è —Ç–æ—á–Ω–æ—Å—Ç—å:</strong> ${(readiness.overall_accuracy * 100).toFixed(1)}%<br>
                                        <strong>–£—Å–ø–µ—à–Ω–æ—Å—Ç—å —Ç–µ—Å—Ç–æ–≤:</strong> ${(readiness.success_rate * 100).toFixed(1)}%
                                    </div>
                                </div>
                            `;
                        }
                        
                        // –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏
                        if (analysis.recommendations && analysis.recommendations.length > 0) {
                            resultsHTML += `
                                <div style="margin-top: 15px; padding: 15px; background: #e3f2fd; border-radius: 8px; border-left: 4px solid #2196f3;">
                                    <h5 style="margin: 0 0 10px 0; color: #1976d2;">üí° –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:</h5>
                                    <ul style="margin: 0; padding-left: 20px; font-size: 14px;">
                                        ${analysis.recommendations.map(rec => `<li>${rec}</li>`).join('')}
                                    </ul>
                                </div>
                            `;
                        }
                        
                        // –ê–Ω–∞–ª–∏–∑ –ø–æ —Å–∏–º–≤–æ–ª–∞–º
                        if (analysis.symbol_analysis && analysis.symbol_analysis.best_performing) {
                            const best = analysis.symbol_analysis.best_performing;
                            const worst = analysis.symbol_analysis.worst_performing;
                            
                            resultsHTML += `
                                <div style="margin-top: 15px; padding: 15px; background: #f0f8ff; border-radius: 8px; border-left: 4px solid #0066cc;">
                                    <h5 style="margin: 0 0 10px 0; color: #0066cc;">üìä –ê–Ω–∞–ª–∏–∑ –ø–æ —Å–∏–º–≤–æ–ª–∞–º:</h5>
                                    <div style="font-size: 14px;">
                                        <strong>–õ—É—á—à–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:</strong> ${best.symbol} (${(best.accuracy * 100).toFixed(1)}%)<br>
                                        <strong>–•—É–¥—à–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:</strong> ${worst.symbol} (${(worst.accuracy * 100).toFixed(1)}%)<br>
                                        <strong>–°—Ç–∞–±–∏–ª—å–Ω—ã–µ —Å–∏–º–≤–æ–ª—ã:</strong> ${analysis.symbol_analysis.consistent_performers.join(', ') || '–ù–µ—Ç'}<br>
                                        <strong>–ù–µ—Å—Ç–∞–±–∏–ª—å–Ω—ã–µ —Å–∏–º–≤–æ–ª—ã:</strong> ${analysis.symbol_analysis.inconsistent_performers.join(', ') || '–ù–µ—Ç'}
                                    </div>
                                </div>
                            `;
                        }
                    } else {
                        // –ë–∞–∑–æ–≤—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ (–µ—Å–ª–∏ –¥–µ—Ç–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω)
                        resultsHTML += `
                            <div style="margin-top: 20px; padding: 15px; background: #e3f2fd; border-radius: 8px; border-left: 4px solid #2196f3;">
                                <h5 style="margin: 0 0 10px 0; color: #1976d2;">üí° –ê–Ω–∞–ª–∏–∑ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤:</h5>
                                <ul style="margin: 0; padding-left: 20px;">
                                    <li><strong>–•–æ—Ä–æ—à–∞—è –æ–±–æ–±—â–∞—é—â–∞—è —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å:</strong> –¢–æ—á–Ω–æ—Å—Ç—å > 70% –Ω–∞ –Ω–æ–≤—ã—Ö —Å–∏–º–≤–æ–ª–∞—Ö</li>
                                    <li><strong>–¢—Ä–µ–±—É–µ—Ç –¥–æ–æ–±—É—á–µ–Ω–∏—è:</strong> –¢–æ—á–Ω–æ—Å—Ç—å < 60% –Ω–∞ –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö —Å–∏–º–≤–æ–ª–∞—Ö</li>
                                    <li><strong>–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:</strong> ${result.recommendation || '–ú–æ–¥–µ–ª—å –≥–æ—Ç–æ–≤–∞ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é –≤ —Ç–æ—Ä–≥–æ–≤–ª–µ'}</li>
                                </ul>
                            </div>
                        `;
                    }
                    
                    resultsDiv.innerHTML = resultsHTML;
                } else {
                    statusDiv.className = 'status error';
                    statusDiv.textContent = '‚ùå –û—à–∏–±–∫–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏: ' + (result.error || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞');
                }
            } catch (error) {
                statusDiv.className = 'status error';
                statusDiv.textContent = '‚ùå –û—à–∏–±–∫–∞ —Å–µ—Ç–∏: ' + error.message;
            }
        }

        // === –ó–∞–≥—Ä—É–∑–∫–∞ –º–æ–¥–µ–ª–µ–π –¥–ª—è –∏–∑–≤–ª–µ—á–µ–Ω–∏—è –ø—Ä–∏–∑–Ω–∞–∫–æ–≤ ===
        async function loadExtractionModels() {
            const select = document.getElementById('extractionModelSelect');
            
            try {
                const response = await fetch('/cnn/models');
                const result = await response.json();

                if (result.success && result.models) {
                    select.innerHTML = '<option value="">–í—ã–±–µ—Ä–∏—Ç–µ –º–æ–¥–µ–ª—å...</option>' +
                        result.models.map(model => 
                            `<option value="${model.path}">${model.symbol} - ${model.run_id}</option>`
                        ).join('');
                } else {
                    select.innerHTML = '<option value="">–ú–æ–¥–µ–ª–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</option>';
                }
            } catch (error) {
                select.innerHTML = '<option value="">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏</option>';
            }
        }

        // === –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏–∑–≤–ª–µ—á–µ–Ω–∏—è –ø—Ä–∏–∑–Ω–∞–∫–æ–≤ ===
        async function testFeatureExtraction() {
            const modelPath = document.getElementById('extractionModelSelect').value;
            const testData = document.getElementById('extractionTestData').value;
            const resultsDiv = document.getElementById('extractionResults');

            if (!modelPath) {
                resultsDiv.innerHTML = '<div class="status error">‚ùå –í—ã–±–µ—Ä–∏—Ç–µ CNN –º–æ–¥–µ–ª—å</div>';
                resultsDiv.style.display = 'block';
                return;
            }

            resultsDiv.innerHTML = '<div class="loading"><div class="spinner"></div>–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏–∑–≤–ª–µ—á–µ–Ω–∏—è –ø—Ä–∏–∑–Ω–∞–∫–æ–≤...</div>';
            resultsDiv.style.display = 'block';

            try {
                const response = await fetch('/cnn/test_extraction', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        model_path: modelPath,
                        test_symbol: testData
                    })
                });

                const result = await response.json();

                if (result.success) {
                    resultsDiv.innerHTML = `
                        <h4>üîß –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –∏–∑–≤–ª–µ—á–µ–Ω–∏—è –ø—Ä–∏–∑–Ω–∞–∫–æ–≤:</h4>
                        <div style="font-size: 12px; line-height: 1.4; background: #f8f9fa; padding: 10px; border-radius: 5px; border: 1px solid #e5e7eb;">
                            <strong>–†–∞–∑–º–µ—Ä –ø—Ä–∏–∑–Ω–∞–∫–æ–≤:</strong> ${result.feature_size || 'N/A'}<br>
                            <strong>–í—Ä–µ–º—è –∏–∑–≤–ª–µ—á–µ–Ω–∏—è:</strong> ${result.extraction_time || 'N/A'} –º—Å<br>
                            <strong>–û–±—Ä–∞–∑—Ü–æ–≤ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–æ:</strong> ${result.samples_tested || 'N/A'}<br>
                            <strong>–°—Ä–µ–¥–Ω–µ–µ:</strong> ${result.feature_mean || 'N/A'}<br>
                            <strong>–°—Ç–¥. –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ:</strong> ${result.feature_std || 'N/A'}<br>
                            <strong>–ú–∏–Ω:</strong> ${result.feature_min || 'N/A'}<br>
                            <strong>–ú–∞–∫—Å:</strong> ${result.feature_max || 'N/A'}<br>
                            <strong>–¢–µ—Å—Ç–æ–≤—ã–π —Å–∏–º–≤–æ–ª:</strong> ${result.test_symbol || 'N/A'}<br>
                            <strong>–ü—Ä–∏–º–µ—Ä –ø—Ä–∏–∑–Ω–∞–∫–æ–≤:</strong> [${result.feature_sample ? result.feature_sample.slice(0, 5).join(', ') + '...' : 'N/A'}]
                        </div>
                    `;
                } else {
                    resultsDiv.innerHTML = `<div class="status error">‚ùå –û—à–∏–±–∫–∞: ${result.error || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'}</div>`;
                }
            } catch (error) {
                resultsDiv.innerHTML = `<div class="status error">‚ùå –û—à–∏–±–∫–∞ —Å–µ—Ç–∏: ${error.message}</div>`;
            }
        }

        // === –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å DQN ===
        async function integrateWithDQN() {
            const modelPath = document.getElementById('extractionModelSelect').value;
            const resultsDiv = document.getElementById('extractionResults');

            if (!modelPath) {
                resultsDiv.innerHTML = '<div class="status error">‚ùå –í—ã–±–µ—Ä–∏—Ç–µ CNN –º–æ–¥–µ–ª—å –¥–ª—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏</div>';
                resultsDiv.style.display = 'block';
                return;
            }

            resultsDiv.innerHTML = '<div class="loading"><div class="spinner"></div>–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å DQN...</div>';
            resultsDiv.style.display = 'block';

            try {
                const response = await fetch('/cnn/integrate_dqn', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        model_path: modelPath
                    })
                });

                const result = await response.json();

                if (result.success) {
                    resultsDiv.innerHTML = `
                        <div class="status success">
                            ‚úÖ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å DQN –≤—ã–ø–æ–ª–Ω–µ–Ω–∞ —É—Å–ø–µ—à–Ω–æ!
                        </div>
                        <h4>ü§ñ –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏:</h4>
                        <ul>
                            <li><strong>CNN –º–æ–¥–µ–ª—å:</strong> ${result.model_path || 'N/A'}</li>
                            <li><strong>–†–∞–∑–º–µ—Ä CNN –ø—Ä–∏–∑–Ω–∞–∫–æ–≤:</strong> ${result.cnn_features_size || 'N/A'}</li>
                            <li><strong>–û–±—â–∏–π —Ä–∞–∑–º–µ—Ä —Å–æ—Å—Ç–æ—è–Ω–∏—è DQN:</strong> ${result.total_state_size || 'N/A'}</li>
                            <li><strong>–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∞:</strong> ${result.config_updated ? '–î–∞' : '–ù–µ—Ç'}</li>
                        </ul>
                        <p>üí° CNN –ø—Ä–∏–∑–Ω–∞–∫–∏ —Ç–µ–ø–µ—Ä—å –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω—ã –≤ DQN —Å—Ä–µ–¥—É. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ DQN –∞–≥–µ–Ω—Ç–∞ –¥–ª—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π.</p>
                    `;
                } else {
                    resultsDiv.innerHTML = `<div class="status error">‚ùå –û—à–∏–±–∫–∞ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏: ${result.error || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'}</div>`;
                }
            } catch (error) {
                resultsDiv.innerHTML = `<div class="status error">‚ùå –û—à–∏–±–∫–∞ —Å–µ—Ç–∏: ${error.message}</div>`;
            }
        }

        // === –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ ===
        let monitoringInterval = null;

        function startMonitoring() {
            if (monitoringInterval) return;
            
            monitoringInterval = setInterval(updateMonitoring, 5000); // –∫–∞–∂–¥—ã–µ 5 —Å–µ–∫—É–Ω–¥
            updateMonitoring();
            
            document.getElementById('trainingLogs').style.display = 'block';
            document.getElementById('logsContent').innerHTML = '<div class="status info">üì° –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∞–∫—Ç–∏–≤–µ–Ω</div>';
        }

        function stopMonitoring() {
            if (monitoringInterval) {
                clearInterval(monitoringInterval);
                monitoringInterval = null;
            }
            document.getElementById('trainingLogs').style.display = 'none';
        }

        async function updateMonitoring() {
            try {
                const response = await fetch('/cnn/monitoring');
                const result = await response.json();

                if (result.success) {
                    // –û–±–Ω–æ–≤–ª—è–µ–º –º–µ—Ç—Ä–∏–∫–∏
                    const metricsDiv = document.getElementById('trainingMetrics');
                    if (result.metrics) {
                        metricsDiv.innerHTML = `
                            <div class="metrics-grid">
                                <div class="metric">
                                    <div class="metric-value">${result.metrics.current_epoch || 0}</div>
                                    <div class="metric-label">–¢–µ–∫—É—â–∞—è —ç–ø–æ—Ö–∞</div>
                                </div>
                                <div class="metric">
                                    <div class="metric-value">${result.metrics.train_loss ? result.metrics.train_loss.toFixed(4) : 'N/A'}</div>
                                    <div class="metric-label">Train Loss</div>
                                </div>
                                <div class="metric">
                                    <div class="metric-value">${result.metrics.val_loss ? result.metrics.val_loss.toFixed(4) : 'N/A'}</div>
                                    <div class="metric-label">Val Loss</div>
                                </div>
                                <div class="metric">
                                    <div class="metric-value">${result.metrics.val_accuracy ? (result.metrics.val_accuracy * 100).toFixed(1) + '%' : 'N/A'}</div>
                                    <div class="metric-label">Val Accuracy</div>
                                </div>
                            </div>
                        `;
                    }

                    // –û–±–Ω–æ–≤–ª—è–µ–º –ª–æ–≥–∏
                    const logsDiv = document.getElementById('logsContent');
                    if (result.logs) {
                        logsDiv.innerHTML = result.logs.map(log => 
                            `<div class="log-entry">${log}</div>`
                        ).join('');
                    }
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞:', error);
            }
        }

        // === –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ ===
        async function downloadCNNModel(modelPath) {
            try {
                const response = await fetch(`/cnn/download_model?path=${encodeURIComponent(modelPath)}`);
                if (response.ok) {
                    const blob = await response.blob();
                    const url = window.URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = modelPath.split('/').pop();
                    document.body.appendChild(a);
                    a.click();
                    window.URL.revokeObjectURL(url);
                    document.body.removeChild(a);
                } else {
                    alert('‚ùå –û—à–∏–±–∫–∞ —Å–∫–∞—á–∏–≤–∞–Ω–∏—è –º–æ–¥–µ–ª–∏');
                }
            } catch (error) {
                alert('‚ùå –û—à–∏–±–∫–∞ —Å–µ—Ç–∏: ' + error.message);
            }
        }

        // === –ü—Ä–æ—Å–º–æ—Ç—Ä –¥–µ—Ç–∞–ª–µ–π –º–æ–¥–µ–ª–∏ ===
        async function viewModelDetails(runId, symbol) {
            const resultsDiv = document.getElementById('cnnTrainingResults');
            
            resultsDiv.innerHTML = '<div class="loading"><div class="spinner"></div>–ó–∞–≥—Ä—É–∑–∫–∞ –¥–µ—Ç–∞–ª–µ–π –º–æ–¥–µ–ª–∏...</div>';
            resultsDiv.style.display = 'block';

            try {
                // –ü–æ–ª—É—á–∞–µ–º —Å–ø–∏—Å–æ–∫ –º–æ–¥–µ–ª–µ–π –∏ –∏—â–µ–º –Ω—É–∂–Ω—É—é
                const response = await fetch('/cnn/models');
                const result = await response.json();

                if (result.success && result.models) {
                    const model = result.models.find(m => m.run_id === runId && m.symbol === symbol);
                    
                    if (model) {
                        const manifest = model.manifest || {};
                        const config = manifest.config || {};
                        
                        resultsDiv.innerHTML = `
                            <h4>üìä –î–µ—Ç–∞–ª–∏ –º–æ–¥–µ–ª–∏ ${model.symbol} - ${model.model_type}</h4>
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                                <div>
                                    <h5>üìà –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –æ–±—É—á–µ–Ω–∏—è</h5>
                                    <ul>
                                        <li><strong>–¢–æ—á–Ω–æ—Å—Ç—å:</strong> ${model.accuracy ? model.accuracy.toFixed(1) + '%' : 'N/A'}</li>
                                        <li><strong>–≠–ø–æ—Ö–∏ –æ–±—É—á–µ–Ω–æ:</strong> ${model.epochs_trained || 'N/A'}</li>
                                        <li><strong>Train Loss:</strong> ${model.train_loss ? model.train_loss.toFixed(4) : 'N/A'}</li>
                                        <li><strong>Val Loss:</strong> ${model.val_loss ? model.val_loss.toFixed(4) : 'N/A'}</li>
                                        <li><strong>–†–∞–∑–º–µ—Ä –º–æ–¥–µ–ª–∏:</strong> ${(model.size / 1024 / 1024).toFixed(1)} MB</li>
                                    </ul>
                                    
                                    <h5>‚öôÔ∏è –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è</h5>
                                    <ul>
                                        <li><strong>–¢–∏–ø –º–æ–¥–µ–ª–∏:</strong> ${model.model_type}</li>
                                        <li><strong>–§—Ä–µ–π–º—ã:</strong> ${model.timeframes.join(', ')}</li>
                                        <li><strong>–°–∏–º–≤–æ–ª—ã:</strong> ${model.symbols_trained.join(', ')}</li>
                                        <li><strong>–†–∞–∑–º–µ—Ä –±–∞—Ç—á–∞:</strong> ${config.batch_size || 'N/A'}</li>
                                        <li><strong>Learning Rate:</strong> ${config.learning_rate || 'N/A'}</li>
                                        <li><strong>Output Features:</strong> ${config.output_features || 'N/A'}</li>
                                    </ul>
                                </div>
                                <div>
                                    <h5>üìÅ –§–∞–π–ª—ã</h5>
                                    <ul>
                                        <li><strong>Run ID:</strong> ${model.run_id}</li>
                                        <li><strong>–°–æ–∑–¥–∞–Ω–∞:</strong> ${new Date(model.created).toLocaleString('ru-RU')}</li>
                                        <li><strong>–ú–æ–¥–µ–ª—å:</strong> <code>${model.model_file}</code></li>
                                        <li><strong>Manifest:</strong> <code>manifest.json</code></li>
                                        <li><strong>Results:</strong> <code>result_${model.model_type}.json</code></li>
                                        <li><strong>–ü—É—Ç—å:</strong> <code>${model.path}</code></li>
                                    </ul>
                                    
                                    <h5>üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞</h5>
                                    <ul>
                                        <li><strong>–¢–∏–ø:</strong> ${manifest.architecture || 'N/A'}</li>
                                        <li><strong>–í–µ—Ä—Å–∏—è:</strong> ${manifest.version || 'N/A'}</li>
                                        <li><strong>Input Channels:</strong> ${config.input_channels || 'N/A'}</li>
                                        <li><strong>Hidden Channels:</strong> ${config.hidden_channels ? config.hidden_channels.join(', ') : 'N/A'}</li>
                                        <li><strong>Dropout:</strong> ${config.dropout_rate || 'N/A'}</li>
                                        <li><strong>Batch Norm:</strong> ${config.use_batch_norm ? '–î–∞' : '–ù–µ—Ç'}</li>
                                    </ul>
                                </div>
                            </div>
                        `;
                    } else {
                        resultsDiv.innerHTML = '<div class="status error">‚ùå –ú–æ–¥–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω–∞</div>';
                    }
                } else {
                    resultsDiv.innerHTML = '<div class="status error">‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö</div>';
                }
            } catch (error) {
                resultsDiv.innerHTML = `<div class="status error">‚ùå –û—à–∏–±–∫–∞: ${error.message}</div>`;
            }
        }
    </script>
    <script src="/static/js/sidebar.js"></script>
    <script src="/static/js/tabs.js"></script>
</body>
</html>
