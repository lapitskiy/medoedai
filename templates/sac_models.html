<!DOCTYPE html>
<html lang="ru">
<head>
    <link rel="stylesheet" href="/static/css/styles.css">
    <link rel="stylesheet" href="/static/css/sidebar.css">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>!–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –º–æ–¥–µ–ª—è–º–∏ SAC</title>
</head>
<body>
    <!-- Sidebar –Ω–∞–≤–∏–≥–∞—Ü–∏—è -->
    <nav class="sidebar">
        <h3>üìã –ù–∞–≤–∏–≥–∞—Ü–∏—è</h3>
        <ul class="sidebar-nav">
            <li><a href="/" class="back-link">‚Üê –ù–∞ –≥–ª–∞–≤–Ω—É—é</a></li>
            <li><a href="javascript:history.back()">‚Üê –ù–∞–∑–∞–¥</a></li>
            <li><a href="#create-model" onclick="scrollToSection('create-model')">üì¶ –°–æ–∑–¥–∞—Ç—å –≤–µ—Ä—Å–∏—é</a></li>
            <li><a href="#training" onclick="scrollToSection('training')">üéØ –û–±—É—á–µ–Ω–∏–µ SAC</a></li>
            <li><a href="#continue-training" onclick="scrollToSection('continue-training')">üîÅ –î–æ–æ–±—É—á–∏—Ç—å –º–æ–¥–µ–ª—å SAC</a></li>
            <li><a href="/oos">üìà OOS —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã</a></li>
        </ul>
    </nav>

    <!-- –ö–Ω–æ–ø–∫–∞ –º–æ–±–∏–ª—å–Ω–æ–≥–æ –º–µ–Ω—é -->
    <button class="mobile-menu-btn" onclick="toggleSidebar()">‚ò∞</button>

    <div class="container">
        <div class="main-content">
            <div class="header">
                <h1>ü§ñ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –º–æ–¥–µ–ª—è–º–∏ SAC</h1>
                <p>–í–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ–±—É—á–µ–Ω–Ω—ã–º–∏ –º–æ–¥–µ–ª—è–º–∏ SAC</p>
            </div>
            
            <div class="content">
            <a href="/" class="back-link">‚Üê –í–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞ –≥–ª–∞–≤–Ω—É—é</a>
            
            <!-- –°–µ–∫—Ü–∏—è —Å–æ–∑–¥–∞–Ω–∏—è –Ω–æ–≤–æ–π –º–æ–¥–µ–ª–∏ -->
            <div class="section" id="create-model">
                <h2>üì¶ –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é –≤–µ—Ä—Å–∏—é –º–æ–¥–µ–ª–∏ SAC</h2>
                <p>–°–∫–æ–ø–∏—Ä—É–µ—Ç –≤–µ—Å–∞/–±—É—Ñ–µ—Ä/—Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –∏–∑ <code>result/sac/</code> –≤ <code>models/sac/&lt;symbol&gt;/ensemble-a/vN</code> (—Å <code>manifest.yaml</code> –∏ —Å—Å—ã–ª–∫–æ–π <code>current</code>)</p>
                <div class="form-group">
                    <label>–°–∏–º–≤–æ–ª</label>
                    <select id="resultSymbolSelect" class="form-control" onchange="loadSacResultFilesForCreate()">
                        <option value="">–ó–∞–≥—Ä—É–∑–∫–∞ —Å–∏–º–≤–æ–ª–æ–≤...</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>–í—ã–±–µ—Ä–∏—Ç–µ –º–æ–¥–µ–ª—å –∏–∑ –ø–∞–ø–∫–∏ result/sac</label>
                    <select id="resultFileSelect" class="form-control">
                        <option value="">–°–Ω–∞—á–∞–ª–∞ –≤—ã–±–µ—Ä–∏—Ç–µ —Å–∏–º–≤–æ–ª...</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>–ê–Ω—Å–∞–º–±–ª—å –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è</label>
                    <select id="resultEnsembleSelect" class="form-control">
                        <option value="ensemble-a" selected>ensemble-a</option>
                        <option value="ensemble-b">ensemble-b</option>
                        <option value="ensemble-c">ensemble-c</option>
                    </select>
                </div>
                <div class="button-group">
                    <button class="btn btn-success" onclick="createSacModelVersion()">üöÄ –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é –≤–µ—Ä—Å–∏—é</button>
                </div>
            </div>

            <!-- –°–µ–∫—Ü–∏—è –∑–∞–ø—É—Å–∫–∞ –æ–±—É—á–µ–Ω–∏—è SAC -->
            <div class="section" id="training">
                <h2>üéØ –û–±—É—á–µ–Ω–∏–µ SAC –º–æ–¥–µ–ª–∏</h2>
                <p>–ó–∞–ø—É—Å—Ç–∏—Ç–µ –æ–±—É—á–µ–Ω–∏–µ Soft Actor-Critic –º–æ–¥–µ–ª–∏ –¥–ª—è —Ç–æ—Ä–≥–æ–≤–ª–∏ –∫—Ä–∏–ø—Ç–æ–≤–∞–ª—é—Ç–∞–º–∏</p>
                <div class="form-group">
                    <label>–≠–ø–∏–∑–æ–¥—ã –æ–±—É—á–µ–Ω–∏—è</label>
                    <input id="episodesInput" class="form-control" type="number" min="1" step="1" value="1000">
                </div>
                <div class="form-group">
                    <label>–î–ª–∏–Ω–∞ —ç–ø–∏–∑–æ–¥–∞ (–∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–≤–µ—á–µ–π)</label>
                    <input id="episodeLengthInput" class="form-control" type="number" min="1" step="1" value="2000">
                </div>
                <div class="form-group">
                    <label>Seed (–µ—Å–ª–∏ –ø—É—Å—Ç–æ ‚Äî —Å–≥–µ–Ω–µ—Ä–∏—Ä—É–µ–º —Å–ª—É—á–∞–π–Ω—ã–π)</label>
                    <input id="trainSeedInput" class="form-control" type="number" min="1" step="1" placeholder="–Ω–∞–ø—Ä–∏–º–µ—Ä, 42">
                </div>
                <div class="button-group">
                    <button class="btn btn-primary" onclick="startSacTrainingForSymbol('BTCUSDT', event)">üöÄ –û–±—É—á–∏—Ç—å BTC</button>
                    <button class="btn btn-primary" onclick="startSacTrainingForSymbol('TONUSDT', event)">üöÄ –û–±—É—á–∏—Ç—å TON</button>
                    <button class="btn btn-primary" onclick="startSacTrainingForSymbol('ETHUSDT', event)">üöÄ –û–±—É—á–∏—Ç—å ETH</button>
                    <button class="btn btn-primary" onclick="startSacTrainingForSymbol('SOLUSDT', event)">üöÄ –û–±—É—á–∏—Ç—å SOL</button>
                    <button class="btn btn-primary" onclick="startSacTrainingForSymbol('ADAUSDT', event)">üöÄ –û–±—É—á–∏—Ç—å ADA</button>
                    <button class="btn btn-primary" onclick="startSacTrainingForSymbol('BNBUSDT', event)">üöÄ –û–±—É—á–∏—Ç—å BNB</button>
                    <button class="btn btn-primary" onclick="startSacTrainingForSymbol('XMRUSDT', event)">üöÄ –û–±—É—á–∏—Ç—å XMR</button>
                    <button class="btn btn-primary" onclick="startSacTrainingForSymbol('XRPUSDT', event)">üöÄ –û–±—É—á–∏—Ç—å XRP</button>
                    <button class="btn btn-success" onclick="startSacTrainingMulti()">üåü –û–±—É—á–∏—Ç—å –º—É–ª—å—Ç–∏–≤–∞–ª—é—Ç–Ω—É—é</button>
                </div>
                <div id="trainStatus"></div>
                <div id="trainingLogs" class="status info" style="display:none; white-space: pre-wrap; max-height:300px; overflow-y:auto; margin-top:8px;"></div>
            </div>

            <!-- –°–µ–∫—Ü–∏—è –¥–æ–æ–±—É—á–µ–Ω–∏—è —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π –º–æ–¥–µ–ª–∏ SAC -->
            <div class="section" id="continue-training">
                <h2>üîÅ –î–æ–æ–±—É—á–∏—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é –º–æ–¥–µ–ª—å SAC</h2>
                <p>–í—ã–±–µ—Ä–∏—Ç–µ —Ñ–∞–π–ª –≤–µ—Å–æ–≤ –∏–∑ <code>result/sac/</code> (—Ñ–æ—Ä–º–∞—Ç <code>model.pth</code>). –ï—Å–ª–∏ –Ω–∞–π–¥–µ—Ç—Å—è —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–π <code>replay.pkl</code>, –æ–Ω —Ç–∞–∫–∂–µ –±—É–¥–µ—Ç –∑–∞–≥—Ä—É–∂–µ–Ω. –î–æ–æ–±—É—á–µ–Ω–∏–µ —Å–æ—Ö—Ä–∞–Ω–∏—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç –∫–∞–∫ –Ω–æ–≤—É—é –≤–µ—Ä—Å–∏—é.</p>

                <div class="form-group">
                    <label>–°–∏–º–≤–æ–ª</label>
                    <select id="runsSymbolSelect" class="form-control" onchange="loadSacRunsForSymbol()">
                        <option value="">–ó–∞–≥—Ä—É–∑–∫–∞ —Å–∏–º–≤–æ–ª–æ–≤...</option>
                    </select>
                </div>

                <div class="form-group">
                    <label>–í—ã–±–µ—Ä–∏—Ç–µ –≤–µ—Å–∞ –º–æ–¥–µ–ª–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, model.pth)</label>
                    <select id="continueModelSelect" class="form-control" onchange="showSelectedContinueSacModelInfo()">
                        <option value="">–ó–∞–≥—Ä—É–∑–∫–∞ —Å–ø–∏—Å–∫–∞...</option>
                    </select>
                </div>

                <div id="continueModelInfo" class="status info" style="display:none; white-space: pre-line;"></div>

                <div class="form-group">
                    <label>–≠–ø–∏–∑–æ–¥—ã –¥–æ–æ–±—É—á–µ–Ω–∏—è</label>
                    <input id="continueEpisodesInput" class="form-control" type="number" min="1" step="1" value="1000" oninput="updateEstimatedSacTime()">
                    <div id="episodesEstimate" class="status info" style="display:none; margin-top:6px;"></div>
                </div>
                <div class="form-group">
                    <label>Seed –¥–ª—è –¥–æ–æ–±—É—á–µ–Ω–∏—è (–µ—Å–ª–∏ –ø—É—Å—Ç–æ ‚Äî —Å–ª—É—á–∞–π–Ω—ã–π)</label>
                    <input id="continueSeedInput" class="form-control" type="number" min="1" step="1" placeholder="–Ω–∞–ø—Ä–∏–º–µ—Ä, 2024">
                </div>

                <div class="button-group">
                    <button class="btn btn-success" onclick="continueSacTraining()">üîÅ –ó–∞–ø—É—Å—Ç–∏—Ç—å –¥–æ–æ–±—É—á–µ–Ω–∏–µ</button>
                </div>

                <div id="continueStatus"></div>
            </div>
                <div id="createStatus"></div>
            </div>

            
            </div>
        </div>
    </div>

    <script>
        // –ó–∞–≥—Ä—É–∑–∏—Ç—å —Å–ø–∏—Å–æ–∫ –º–æ–¥–µ–ª–µ–π –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        document.addEventListener('DOMContentLoaded', function() {
            // –û—á–∏—â–∞–µ–º —Ñ–ª–∞–≥–∏ –∞–∫—Ç–∏–≤–Ω–æ–≥–æ –æ–±—É—á–µ–Ω–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
            // (–Ω–∞ —Å–ª—É—á–∞–π –µ—Å–ª–∏ —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –±—ã–ª–∞ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∂–µ–Ω–∞ –≤–æ –≤—Ä–µ–º—è –æ–±—É—á–µ–Ω–∏—è)
            cleanupActiveTrainingFlags();

            try{ loadSacResultSymbolsForCreate(); }catch(_){ }
            loadContinueSacModels();
            loadSacRunsSymbols();
        });

        // –§—É–Ω–∫—Ü–∏—è –æ—á–∏—Å—Ç–∫–∏ —Ñ–ª–∞–≥–æ–≤ –∞–∫—Ç–∏–≤–Ω–æ–≥–æ –æ–±—É—á–µ–Ω–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        function cleanupActiveTrainingFlags() {
            const symbols = ['BTCUSDT', 'TONUSDT', 'ETHUSDT', 'SOLUSDT', 'ADAUSDT', 'BNBUSDT', 'XMRUSDT', 'XRPUSDT'];
            symbols.forEach(symbol => {
                const key = `sac_training_active_${symbol}`;
                const taskId = sessionStorage.getItem(key);
                if (taskId) {
                    console.log(`[cleanupActiveTrainingFlags] Found active training flag for ${symbol}: ${taskId}`);
                    // –ó–¥–µ—Å—å –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É —Å—Ç–∞—Ç—É—Å–∞ –∑–∞–¥–∞—á–∏ —á–µ—Ä–µ–∑ API
                    // –∏ –æ—á–∏—Å—Ç–∏—Ç—å —Ñ–ª–∞–≥ —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –∑–∞–¥–∞—á–∞ –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∞
                    sessionStorage.removeItem(key);
                }
            });
        }

        // –û—á–∏—â–∞–µ–º —Ñ–ª–∞–≥–∏ –∞–∫—Ç–∏–≤–Ω–æ–≥–æ –æ–±—É—á–µ–Ω–∏—è –ø—Ä–∏ –∑–∞–∫—Ä—ã—Ç–∏–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        window.addEventListener('beforeunload', function() {
            const symbols = ['BTCUSDT', 'TONUSDT', 'ETHUSDT', 'SOLUSDT', 'ADAUSDT', 'BNBUSDT', 'XMRUSDT', 'XRPUSDT'];
            symbols.forEach(symbol => {
                sessionStorage.removeItem(`sac_training_active_${symbol}`);
            });
        });

        // –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é –≤–µ—Ä—Å–∏—é –º–æ–¥–µ–ª–∏ SAC
        async function createSacModelVersion() {
            const statusDiv = document.getElementById('createStatus');
            const button = event.target;
            const fileSelect = document.getElementById('resultFileSelect');
            const symbolSelect = document.getElementById('resultSymbolSelect');
            const selectedFile = fileSelect ? fileSelect.value : '';
            const selectedSymbol = symbolSelect ? symbolSelect.value : '';
            const ensSelect = document.getElementById('resultEnsembleSelect');
            const selectedEns = ensSelect ? ensSelect.value : 'ensemble-a';
            
            if (!selectedFile) {
                statusDiv.innerHTML = '<div class="status error">‚ùå –°–Ω–∞—á–∞–ª–∞ –≤—ã–±–µ—Ä–∏—Ç–µ –º–æ–¥–µ–ª—å –∏–∑ result/sac</div>';
                return;
            }
            
            button.disabled = true;
            button.textContent = '‚è≥ –°–æ–∑–¥–∞–Ω–∏–µ...';
            statusDiv.innerHTML = '<div class="status info">–°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–π –≤–µ—Ä—Å–∏–∏ –º–æ–¥–µ–ª–∏ SAC...</div>';
            
            try {
                const response = await fetch('/create_sac_model_version', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ file: selectedFile, symbol: selectedSymbol, ensemble: selectedEns })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    statusDiv.innerHTML = `<div class="status success">
                        ‚úÖ –ù–æ–≤–∞—è –≤–µ—Ä—Å–∏—è SAC —Å–æ–∑–¥–∞–Ω–∞!<br>
                        ID: ${result.model_id}<br>
                        –§–∞–π–ª—ã: ${result.files.join(', ')}
                    </div>`;
                    // –°–µ–∫—Ü–∏—è –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –º–æ–¥–µ–ª–µ–π —É–¥–∞–ª–µ–Ω–∞
                } else {
                    statusDiv.innerHTML = `<div class="status error">
                        ‚ùå –û—à–∏–±–∫–∞: ${result.error}
                    </div>`;
                }
            } catch (error) {
                statusDiv.innerHTML = `<div class="status error">
                    ‚ùå –û—à–∏–±–∫–∞ —Å–µ—Ç–∏: ${error.message}
                </div>`;
            } finally {
                button.disabled = false;
                button.textContent = 'üöÄ –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é –≤–µ—Ä—Å–∏—é';
            }
        }

        // === Runs UI for SAC ===
        async function loadSacRunsSymbols(){
            const sel = document.getElementById('runsSymbolSelect');
            if(!sel) return;
            try{
                const resp = await fetch('/api/sac_runs/symbols');
                const data = await resp.json();
                if(!data.success){ sel.innerHTML = '<option value="">–û—à–∏–±–∫–∞</option>'; return; }
                const list = Array.isArray(data.symbols)? data.symbols: [];
                if(list.length===0){ sel.innerHTML = '<option value="">–ù–µ—Ç —Å–∏–º–≤–æ–ª–æ–≤</option>'; return; }
                sel.innerHTML = list.map(s=>`<option value="${s}">${s}</option>`).join('');
                try{ loadSacRunsForSymbol(); }catch(_){ }
            }catch(e){ if(sel) sel.innerHTML = '<option value="">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏</option>'; }
        }

        async function loadSacRunsForSymbol(){
            const sym = (document.getElementById('runsSymbolSelect')?.value||'').trim();
            if(!sym) return;
            try{
                const resp = await fetch('/api/sac_runs/list?symbol='+encodeURIComponent(sym));
                const data = await resp.json();
                if(!data.success) return;
                // –ó–∞–ø–æ–ª–Ω—è–µ–º continueModelSelect —Ñ–∞–π–ª–∞–º–∏ model.pth –∏–∑ –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ —Å–∏–º–≤–æ–ª–∞
                const select = document.getElementById('continueModelSelect');
                if(!select) return;
                const runs = Array.isArray(data.runs)? data.runs: [];
                if(runs.length===0){ select.innerHTML = '<option value="">–ù–µ—Ç –∑–∞–ø—É—Å–∫–æ–≤</option>'; return; }
                // –æ—Ç–æ–±—Ä–∞–∑–∏–º –¥—Ä–µ–≤–æ–≤–∏–¥–Ω–æ: parent ‚Üí child (—É–ø—Ä–æ—Å—Ç–∏–º: –ø—Ä–µ—Ñ–∏–∫—Å ‚ñ∏)
                const idToChildren = {};
                const idToNode = {};
                runs.forEach(r=>{ idToChildren[r.run_id]=[]; idToNode[r.run_id]=r; });
                runs.forEach(r=>{ if(r.parent_run_id && idToChildren[r.parent_run_id]) idToChildren[r.parent_run_id].push(r.run_id); });
                function renderRun(runId, depth){
                    const r = idToNode[runId]; if(!r) return '';
                    const label = `${'‚ñ∏'.repeat(depth)} ${r.run_id}`;
                    const file = r.model_path || '';
                    const opt = `<option value="${file}">${label}</option>`;
                    const children = (idToChildren[runId]||[]).map(cid=>renderRun(cid, depth+1)).join('');
                    return opt+children;
                }
                // –∫–æ—Ä–Ω–∏: –±–µ–∑ parent
                const roots = runs.filter(r=>!r.parent_run_id).map(r=>r.run_id);
                const html = roots.map(rt=>renderRun(rt,0)).join('');
                select.innerHTML = html;
                try{ showSelectedContinueSacModelInfo(); }catch(_){ }
            }catch(e){ /* noop */ }
        }

        // –ì–ª–æ–±–∞–ª—å–Ω–æ —Ö—Ä–∞–Ω–∏–º —Å—Ä–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è –∑–∞ —ç–ø–∏–∑–æ–¥ (—Å–µ–∫) –¥–ª—è SAC
        let avgSacTimePerEpisodeSec = null;

        // –ó–∞–≥—Ä—É–∑–∫–∞ —Å–∏–º–≤–æ–ª–æ–≤ –¥–ª—è —Å–µ–∫—Ü–∏–∏ —Å–æ–∑–¥–∞–Ω–∏—è –≤–µ—Ä—Å–∏–∏ SAC
        async function loadSacResultSymbolsForCreate(){
            const sel = document.getElementById('resultSymbolSelect');
            if(!sel) return;
            try{
                const resp = await fetch('/api/sac_runs/symbols');
                const data = await resp.json();
                if(!data.success){ sel.innerHTML = '<option value="">–û—à–∏–±–∫–∞</option>'; return; }
                const list = Array.isArray(data.symbols)? data.symbols: [];
                if(list.length===0){ sel.innerHTML = '<option value="">–ù–µ—Ç —Å–∏–º–≤–æ–ª–æ–≤</option>'; return; }
                sel.innerHTML = list.map(s=>`<option value="${s}">${s}</option>`).join('');
                try{ loadSacResultFilesForCreate(); }catch(_){ }
            }catch(e){ sel.innerHTML = '<option value="">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏</option>'; }
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ –º–æ–¥–µ–ª–µ–π (–≤–µ—Å–æ–≤) –¥–ª—è –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ —Å–∏–º–≤–æ–ª–∞ –∏–∑ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã runs SAC
        async function loadSacResultFilesForCreate(){
            const sym = (document.getElementById('resultSymbolSelect')?.value||'').trim();
            const select = document.getElementById('resultFileSelect');
            if(!select) return;
            if(!sym){ select.innerHTML = '<option value="">–°–Ω–∞—á–∞–ª–∞ –≤—ã–±–µ—Ä–∏—Ç–µ —Å–∏–º–≤–æ–ª...</option>'; return; }
            try{
                const resp = await fetch('/api/sac_runs/list?symbol='+encodeURIComponent(sym));
                const data = await resp.json();
                if(!data.success){ select.innerHTML = '<option value="">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏</option>'; return; }
                const runs = Array.isArray(data.runs)? data.runs: [];
                const options = [];
                for(const r of runs){
                    const path = r.model_path || '';
                    if(path && path.toLowerCase().endsWith('.pth')){
                        const fname = path.split('/').pop().split('\\').pop();
                        const label = `${r.run_id || 'run'} ‚Äî ${fname}`;
                        options.push(`<option value="${path}">${label}</option>`);
                    }
                }
                select.innerHTML = options.length? options.join('') : '<option value="">–ù–µ—Ç –æ–±—É—á–µ–Ω–Ω—ã—Ö –º–æ–¥–µ–ª–µ–π</option>';
            }catch(e){ select.innerHTML = '<option value="">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏</option>'; }
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ —Å–ø–∏—Å–∫–∞ –≤–µ—Å–æ–≤ –¥–ª—è –¥–æ–æ–±—É—á–µ–Ω–∏—è SAC (–≤—Å–µ model.pth)
        async function loadContinueSacModels() {
            const select = document.getElementById('continueModelSelect');
            if (!select) return;
            try {
                const resp = await fetch('/list_sac_result_models');
                const data = await resp.json();
                if (!data.success || !data.files || data.files.length === 0) {
                    select.innerHTML = '<option value="">–ù–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤</option>';
                    return;
                }
                // –í—Å–µ model.pth (–±–µ–∑ —Ñ–∏–ª—å—Ç—Ä–∞ –ø–æ —Å–∏–º–≤–æ–ª—É)
                const opts = data.files.map(f => {
                    const filename = (f.filename || '').split('/').pop().split('\\').pop();
                    return `<option value="${f.filename}">${filename}</option>`;
                }).join('');
                select.innerHTML = opts;
                // –ê–≤—Ç–æ-–ø–æ–∫–∞–∑ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –¥–ª—è –ø–µ—Ä–≤–æ–≥–æ –∑–Ω–∞—á–µ–Ω–∏—è
                try { showSelectedContinueSacModelInfo(); } catch(e){}
            } catch (e) {
                select.innerHTML = '<option value="">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–ø–∏—Å–∫–∞</option>';
            }
        }

        // –ü–æ–∫–∞–∑–∞—Ç—å –∫—Ä–∞—Ç–∫—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö –≤–µ—Å–∞—Ö –¥–ª—è –¥–æ–æ–±—É—á–µ–Ω–∏—è SAC
        async function showSelectedContinueSacModelInfo() {
            const select = document.getElementById('continueModelSelect');
            const infoDiv = document.getElementById('continueModelInfo');
            if (!select || !infoDiv) return;
            const filename = select.value;
            if (!filename) { infoDiv.style.display = 'none'; return; }
            try {
                const resp = await fetch('/get_sac_result_model_info', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ filename })
                });
                const result = await resp.json();
                if (!result.success) {
                    infoDiv.className = 'status error';
                    infoDiv.textContent = '‚ùå ' + (result.error || '–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏');
                    infoDiv.style.display = 'block';
                    return;
                }
                const stats = result.stats || {};
                const winrate = typeof stats.winrate === 'number' ? (stats.winrate * 100).toFixed(1) + '%' : 'N/A';
                const roi = typeof stats.avg_roi === 'number' ? (stats.avg_roi * 100).toFixed(2) + '%' : 'N/A';
                const max_dd = typeof stats.max_drawdown === 'number' ? (stats.max_drawdown * 100).toFixed(2) + '%' : 'N/A';
                const trades = (stats.trades_count != null) ? stats.trades_count : 'N/A';
                const episodes = (result.episodes != null) ? result.episodes : 'N/A';
                const seed = (result.seed != null) ? result.seed : null;
                const gpu = (result.cuda_available===true) ? (result.gpu_name || 'GPU') : 'CPU';
                const totalTime = (typeof result.total_training_time === 'number') ? result.total_training_time : null;
                const avgReward = (typeof stats.avg_reward === 'number') ? stats.avg_reward.toFixed(2) : 'N/A';
                const avgTime = (totalTime && episodes ? (totalTime/episodes) : null);
                const fmtSec = (s)=>{
                    if(!s && s!==0) return 'N/A';
                    try{ const m=Math.floor(s/60), r=Math.round(s%60); return (m>0?`${m}–º `:'')+`${r}—Å`; }catch(_){ return s.toFixed? s.toFixed(1)+'—Å' : String(s); }
                };
                // –°–æ—Ö—Ä–∞–Ω—è–µ–º –¥–ª—è –æ–Ω–ª–∞–π–Ω-–æ—Ü–µ–Ω–∫–∏ –≤—Ä–µ–º–µ–Ω–∏ –ø—Ä–∏ –≤–≤–æ–¥–µ
                try { avgSacTimePerEpisodeSec = (typeof avgTime === 'number' && avgTime > 0) ? avgTime : null; } catch(_) { avgSacTimePerEpisodeSec = null; }
                
                const agentType = result.agent_type || 'N/A';
                const agentVersion = result.version || 'N/A';
                const symbolOut = (result.symbol || '').toUpperCase();

                infoDiv.className = 'status info';
                infoDiv.innerHTML = `
–í—ã–±—Ä–∞–Ω–æ: ${filename.split('/').pop().split('\\').pop()}
–¢–∏–ø –∞–≥–µ–Ω—Ç–∞: ${agentType} (v${agentVersion})
–°–∏–º–≤–æ–ª: ${symbolOut || 'N/A'}
Seed: ${seed !== null ? seed : '‚Äî'}
–£—Å—Ç—Ä–æ–π—Å—Ç–≤–æ: ${gpu}
Winrate: ${winrate}
–°—Ä–µ–¥–Ω–∏–π ROI: ${roi}
–ú–∞–∫—Å. –ø—Ä–æ—Å–∞–¥–∫–∞: ${max_dd}
–°—Ä–µ–¥–Ω—è—è –Ω–∞–≥—Ä–∞–¥–∞: ${avgReward}
–°–¥–µ–ª–æ–∫: ${trades}
–≠–ø–∏–∑–æ–¥–æ–≤: ${episodes}
–î–ª–∏–Ω–∞ —ç–ø–∏–∑–æ–¥–∞: ${result.episode_length != null ? result.episode_length : 'N/A'}
–ë—É—Ñ–µ—Ä: ${result.replay_exists ? '‚úÖ –µ—Å—Ç—å' : '‚ùå –Ω–µ—Ç'}
–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –æ–±—É—á–µ–Ω–∏—è: ${result.train_result_exists ? '‚úÖ –µ—Å—Ç—å' : '‚ùå –Ω–µ—Ç'}
–°—Ä–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è –∑–∞ —ç–ø–∏–∑–æ–¥: ${fmtSec(avgTime)}
–û–±—â–µ–µ –≤—Ä–µ–º—è –æ–±—É—á–µ–Ω–∏—è: ${totalTime ? fmtSec(totalTime) : 'N/A'}
`;
                infoDiv.style.display = 'block';
                // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –¥–ª–∏–Ω—É —ç–ø–∏–∑–æ–¥–∞
                const continueEpisodeLengthInput = document.getElementById('continueEpisodeLengthInput');
                if (continueEpisodeLengthInput && result.episode_length != null) {
                    continueEpisodeLengthInput.value = result.episode_length;
                }
                // –û–±–Ω–æ–≤–∏–º –ø–æ–¥—Å–∫–∞–∑–∫—É –≤—Ä–µ–º–µ–Ω–∏ –ø–æ—Å–ª–µ –≤—ã–±–æ—Ä–∞ –º–æ–¥–µ–ª–∏
                try { updateEstimatedSacTime(); } catch(_) {}
            } catch (e) {
                infoDiv.className = 'status error';
                infoDiv.textContent = '‚ùå –û—à–∏–±–∫–∞ —Å–µ—Ç–∏: ' + e.message;
                infoDiv.style.display = 'block';
            }
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ—Ü–µ–Ω–∫–∏ –æ–±—â–µ–≥–æ –≤—Ä–µ–º–µ–Ω–∏ –ø—Ä–∏ –≤–≤–æ–¥–µ —ç–ø–∏–∑–æ–¥–æ–≤ SAC
        function updateEstimatedSacTime(){
            const estDiv = document.getElementById('episodesEstimate');
            const inp = document.getElementById('continueEpisodesInput');
            if(!estDiv || !inp){ return; }
            const n = Math.max(1, parseInt(inp.value || '0', 10) || 0);
            if (avgSacTimePerEpisodeSec && n > 0){
                const totalSec = n * avgSacTimePerEpisodeSec;
                const hours = Math.floor(totalSec/3600);
                const minutes = Math.round((totalSec%3600)/60);
                const human = (hours>0? `${hours} —á `: '') + `${minutes} –º–∏–Ω`;
                // –û—Ü–µ–Ω–∫–∞ –≤—Ä–µ–º–µ–Ω–∏ –æ–∫–æ–Ω—á–∞–Ω–∏—è
                try {
                    const finish = new Date(Date.now() + totalSec*1000);
                    const hh = String(finish.getHours()).padStart(2,'0');
                    const mm = String(finish.getMinutes()).padStart(2,'0');
                    const day = String(finish.getDate()).padStart(2, '0');
                    const month = String(finish.getMonth() + 1).padStart(2, '0'); // –ú–µ—Å—è—Ü—ã —Å 0
                    estDiv.textContent = `‚âà ${human} (–æ–∫–æ–Ω—á–∞–Ω–∏–µ –≤ ${hh}:${mm} ${day}.${month})`;
                } catch(_) {
                    estDiv.textContent = `‚âà ${human}`;
                }
                estDiv.style.display = 'block';
            } else {
                estDiv.textContent = '–í—Ä–µ–º—è –±—É–¥–µ—Ç —Ä–∞—Å—Å—á–∏—Ç–∞–Ω–æ –ø–æ—Å–ª–µ –≤—ã–±–æ—Ä–∞ –º–æ–¥–µ–ª–∏ —Å–æ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–æ–π';
                estDiv.style.display = 'block';
            }
        }

        // –ó–∞–ø—É—Å–∫ –¥–æ–æ–±—É—á–µ–Ω–∏—è SAC
        async function continueSacTraining() {
            const statusDiv = document.getElementById('continueStatus');
            const fileSelect = document.getElementById('continueModelSelect');
            const episodes = document.getElementById('continueEpisodesInput').value;
            const seedVal = (document.getElementById('continueSeedInput')?.value || '').trim();
            const selectedFile = fileSelect ? fileSelect.value : '';

            if (!selectedFile) {
                statusDiv.innerHTML = '<div class="status error">‚ùå –°–Ω–∞—á–∞–ª–∞ –≤—ã–±–µ—Ä–∏—Ç–µ –≤–µ—Å–∞ –º–æ–¥–µ–ª–∏ SAC</div>';
                return;
            }
            const episodeLength = document.getElementById('continueEpisodeLengthInput').value;

            statusDiv.innerHTML = '<div class="status info">‚è≥ –ó–∞–ø—É—Å–∫ –¥–æ–æ–±—É—á–µ–Ω–∏—è SAC...</div>';
            try {
                const resp = await fetch('/training/continue_sac_training', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ model: selectedFile, episodes, episode_length: episodeLength, seed: seedVal })
                });
                const result = await resp.json();
                if (result.success) {
                    statusDiv.innerHTML = `<div class="status success">‚úÖ –î–æ–æ–±—É—á–µ–Ω–∏–µ SAC –∑–∞–ø—É—â–µ–Ω–æ (task: ${result.task_id}). –†–µ–∑—É–ª—å—Ç–∞—Ç –ø–æ—è–≤–∏—Ç—Å—è –≤ —Ä–∞–∑–¥–µ–ª–µ –º–æ–¥–µ–ª–µ–π.</div>`;
                } else {
                    statusDiv.innerHTML = `<div class="status error">‚ùå –û—à–∏–±–∫–∞: ${result.error}</div>`;
                }
            } catch (e) {
                statusDiv.innerHTML = `<div class="status error">‚ùå –û—à–∏–±–∫–∞ —Å–µ—Ç–∏: ${e.message}</div>`;
            }
        }

        // –ó–∞–ø—É—Å–∫ –æ–±—É—á–µ–Ω–∏—è —Å –≤—ã–±—Ä–∞–Ω–Ω—ã–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º —ç–ø–∏–∑–æ–¥–æ–≤ SAC
        async function startSacTrainingForSymbol(symbol, evt) {
            console.log(`[startSacTrainingForSymbol] Called for symbol: ${symbol}`); // –î–æ–±–∞–≤–ª–µ–Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ –∑–∞–ø—É—â–µ–Ω–æ –ª–∏ —É–∂–µ –æ–±—É—á–µ–Ω–∏–µ –¥–ª—è —ç—Ç–æ–≥–æ —Å–∏–º–≤–æ–ª–∞
            const activeTrainingKey = `sac_training_active_${symbol}`;
            if (sessionStorage.getItem(activeTrainingKey)) {
                console.log(`[startSacTrainingForSymbol] Training already active for ${symbol}, skipping`);
                return;
            }

            const episodes = document.getElementById('episodesInput').value || 1000;
            const episodeLength = document.getElementById('episodeLengthInput').value || 2000;
            const seedVal = (document.getElementById('trainSeedInput')?.value || '').trim();
            const statusDiv = document.getElementById('trainStatus');
            const logsDiv = document.getElementById('trainingLogs');
            const button = evt?.currentTarget || evt?.target;
            const originalButtonText = button ? button.textContent : 'üöÄ –û–±—É—á–∏—Ç—å';
            let trainingStarted = false;

            if (button) {
                button.disabled = true;
                button.textContent = '‚è≥ –û–±—É—á–µ–Ω–∏–µ...';
            }

            logsDiv.style.display = 'block';
            logsDiv.textContent = '';
            statusDiv.innerHTML = '<div class="status info">‚è≥ –ó–∞–ø—É—Å–∫ –æ–±—É—á–µ–Ω–∏—è SAC ' + symbol + '...</div>';
            
            try {
                const payload = { symbol, episodes, episode_length: episodeLength, seed: seedVal };
                console.log('[startSacTrainingForSymbol] Sending payload:', payload); // –î–æ–±–∞–≤–ª–µ–Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
                const resp = await fetch('/api/sac_runs/train', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json', 'Accept': 'application/json' },
                    body: JSON.stringify(payload)
                });
                const data = await resp.json().catch(() => null);
                console.log('[startSacTrainingForSymbol] API response:', data); // –î–æ–±–∞–≤–ª–µ–Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

                if (data && data.success) {
                    statusDiv.innerHTML = '<div class="status success">‚úÖ –û–±—É—á–µ–Ω–∏–µ SAC –∑–∞–ø—É—â–µ–Ω–æ (task: ' + data.task_id + ')</div>';
                    trainingStarted = true;
                    // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ñ–ª–∞–≥ –∞–∫—Ç–∏–≤–Ω–æ–≥–æ –æ–±—É—á–µ–Ω–∏—è –≤ sessionStorage
                    sessionStorage.setItem(activeTrainingKey, data.task_id);
                    monitorSacTask(data.task_id, button, originalButtonText);
                } else if (data && data.error) {
                    statusDiv.innerHTML = '<div class="status error">‚ùå ' + data.error + '</div>';
                } else if (resp.redirected) {
                    window.location.href = resp.url;
                } else {
                    statusDiv.innerHTML = '<div class="status error">‚ùå –ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π –æ—Ç–≤–µ—Ç —Å–µ—Ä–≤–µ—Ä–∞</div>';
                }
            } catch (e) {
                console.error('[startSacTrainingForSymbol] Fetch error:', e); // –î–æ–±–∞–≤–ª–µ–Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
                statusDiv.innerHTML = '<div class="status error">‚ùå –û—à–∏–±–∫–∞ –∑–∞–ø—É—Å–∫–∞ –æ–±—É—á–µ–Ω–∏—è SAC: ' + e.message + '</div>';
            } finally {
                if (!trainingStarted && button) {
                    button.disabled = false;
                    button.textContent = originalButtonText;
                    // –û—á–∏—â–∞–µ–º —Ñ–ª–∞–≥ –∞–∫—Ç–∏–≤–Ω–æ–≥–æ –æ–±—É—á–µ–Ω–∏—è, –µ—Å–ª–∏ –∑–∞–ø—É—Å–∫ –Ω–µ —É–¥–∞–ª—Å—è
                    sessionStorage.removeItem(activeTrainingKey);
                }
            }
        }

        async function monitorSacTask(taskId, button, originalButtonText) {
            console.log(`[monitorSacTask] Starting to monitor task: ${taskId}`); // –î–æ–±–∞–≤–ª–µ–Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
            const statusDiv = document.getElementById('trainStatus');
            const logsDiv = document.getElementById('trainingLogs');

            const fetchStatus = async () => {
                console.log(`[monitorSacTask] Fetching status for task: ${taskId}`); // –î–æ–±–∞–≤–ª–µ–Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
                const resp = await fetch(`/api/sac_runs/task_status/${taskId}`);
                if (!resp.ok) {
                    throw new Error(`HTTP ${resp.status}`);
                }
                return resp.json();
            };

            const poll = async () => {
                try {
                    const data = await fetchStatus();
                    console.log(`[monitorSacTask] Poll response for ${taskId}:`, data); // –î–æ–±–∞–≤–ª–µ–Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

                    if (!data.success) {
                        throw new Error(data.error || 'Unknown error');
                    }

                    statusDiv.innerHTML = `<div class="status info">üîÑ –°—Ç–∞—Ç—É—Å: ${data.state}</div>`;
                    const logs = data.info?.logs;
                    if (Array.isArray(logs)) {
                        logsDiv.textContent = logs.join('\n');
                        logsDiv.scrollTop = logsDiv.scrollHeight;
                    }

                    if (data.state === 'SUCCESS' || data.state === 'FAILURE') {
                        clearInterval(pollInterval);
                        if (button) {
                            button.disabled = false;
                            button.textContent = originalButtonText;
                        }
                        // –û—á–∏—â–∞–µ–º —Ñ–ª–∞–≥ –∞–∫—Ç–∏–≤–Ω–æ–≥–æ –æ–±—É—á–µ–Ω–∏—è
                        sessionStorage.removeItem(`sac_training_active_${symbol}`);
                        statusDiv.innerHTML = data.state === 'SUCCESS'
                            ? '<div class="status success">‚úÖ –û–±—É—á–µ–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ</div>'
                            : '<div class="status error">‚ùå –û–±—É—á–µ–Ω–∏–µ –∑–∞–≤–µ—Ä—à–∏–ª–æ—Å—å –æ—à–∏–±–∫–æ–π</div>';
                        console.log(`[monitorSacTask] Task ${taskId} finished with state: ${data.state}`); // –î–æ–±–∞–≤–ª–µ–Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
                    }
                } catch (e) {
                    console.error(`[monitorSacTask] Error polling task ${taskId}:`, e); // –î–æ–±–∞–≤–ª–µ–Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
                    clearInterval(pollInterval);
                    // –û—á–∏—â–∞–µ–º —Ñ–ª–∞–≥ –∞–∫—Ç–∏–≤–Ω–æ–≥–æ –æ–±—É—á–µ–Ω–∏—è –ø—Ä–∏ –æ—à–∏–±–∫–µ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
                    sessionStorage.removeItem(`sac_training_active_${symbol}`);
                    statusDiv.innerHTML = '<div class="status error">‚ùå –û—à–∏–±–∫–∞ –æ–ø—Ä–æ—Å–∞ —Å—Ç–∞—Ç—É—Å–∞: ' + e.message + '</div>';
                    if (button) {
                        button.disabled = false;
                        button.textContent = originalButtonText;
                    }
                }
            };

            const pollInterval = setInterval(poll, 1500);
            await poll();
        }

        async function startSacTrainingMulti() {
            const statusDiv = document.getElementById('trainStatus');
            const episodes = document.getElementById('episodesInput').value || 1000;
            const episodeLength = document.getElementById('episodeLengthInput').value || 2000;
            const seedVal = (document.getElementById('trainSeedInput')?.value || '').trim();
            if (statusDiv) statusDiv.innerHTML = '<div class="status info">‚è≥ –ó–∞–ø—É—Å–∫ –º—É–ª—å—Ç–∏–≤–∞–ª—é—Ç–Ω–æ–≥–æ –æ–±—É—á–µ–Ω–∏—è SAC...</div>';
            try {
                const resp = await fetch('/training/train_sac_multi_crypto', {
                    method: 'POST',
                    headers: { 'Accept': 'application/json', 'Content-Type': 'application/json' },
                    body: JSON.stringify({ episodes, episode_length: episodeLength, seed: seedVal })
                });
                const data = await resp.json().catch(() => null);
                if (data && data.success) {
                    if (statusDiv) statusDiv.innerHTML = '<div class="status success">‚úÖ –û–±—É—á–µ–Ω–∏–µ SAC (multi) –∑–∞–ø—É—â–µ–Ω–æ (task: ' + data.task_id + ')</div>';
                } else if (data && data.error) {
                    if (statusDiv) statusDiv.innerHTML = '<div class="status error">‚ùå ' + data.error + '</div>';
                } else if (resp.redirected) {
                    if (statusDiv) statusDiv.innerHTML = '<div class="status info">‚ÑπÔ∏è –û–±—É—á–µ–Ω–∏–µ –∑–∞–ø—É—â–µ–Ω–æ, –æ—Å—Ç–∞–≤–∞–π—Ç–µ—Å—å –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ.</div>';
                } else {
                    if (statusDiv) statusDiv.innerHTML = '<div class="status error">‚ùå –ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π –æ—Ç–≤–µ—Ç —Å–µ—Ä–≤–µ—Ä–∞</div>';
                }
            } catch (e) {
                if (statusDiv) statusDiv.innerHTML = '<div class="status error">‚ùå –û—à–∏–±–∫–∞ –∑–∞–ø—É—Å–∫–∞ –º—É–ª—å—Ç–∏–≤–∞–ª—é—Ç–Ω–æ–≥–æ –æ–±—É—á–µ–Ω–∏—è SAC: ' + e.message + '</div>';
            }
        }

    </script>
    <script src="/static/js/sidebar.js"></script>
</body>
</html>
