<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Search App</title>
    <style>
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        th, td {
            border: 1px solid black;
            padding: 8px;
            text-align: left;
        }
        th {
            background-color: #f2f2f2;
        }
        
        .test-section {
            margin: 20px 0;
            padding: 20px;
            border: 2px solid #007bff;
            border-radius: 8px;
            background-color: #f8f9fa;
        }
        
        .test-button {
            background-color: #28a745;
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px 5px;
        }
        
        .test-button:hover {
            background-color: #218838;
        }
        
        .test-button:disabled {
            background-color: #6c757d;
            cursor: not-allowed;
        }
        
        .test-status {
            margin: 15px 0;
            padding: 15px;
            border-radius: 6px;
            font-weight: bold;
        }
        
        .status-running {
            background-color: #fff3cd;
            border: 1px solid #ffeaa7;
            color: #856404;
        }
        
        .status-success {
            background-color: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
        }
        
        .status-error {
            background-color: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
        }
        
        .test-results {
            margin: 15px 0;
            padding: 15px;
            background-color: #e9ecef;
            border-radius: 6px;
            font-family: monospace;
            white-space: pre-wrap;
        }
        
        .progress-bar {
            width: 100%;
            height: 20px;
            background-color: #e9ecef;
            border-radius: 10px;
            overflow: hidden;
            margin: 10px 0;
        }
        
        .progress-fill {
            height: 100%;
            background-color: #007bff;
            transition: width 0.3s ease;
            width: 0%;
        }
    </style>
</head>
<body>
    <h1>Welcome to Search App</h1>

    <form action="/train_dqn" method="post">
        <input type="hidden" name="query" value="test_query">
        <button type="submit">–ó–∞–ø—É—Å—Ç–∏—Ç—å DQN –æ–±—É—á–µ–Ω–∏–µ</button>
    </form><br>
    
    <!-- –°–µ–∫—Ü–∏—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è DQN —É–ª—É—á—à–µ–Ω–∏–π -->
    <div class="test-section">
        <h2>üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ DQN –£–ª—É—á—à–µ–Ω–∏–π</h2>
        <p>–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å —É–ª—É—á—à–µ–Ω–Ω–æ–≥–æ DQN –∞–≥–µ–Ω—Ç–∞ –ø–µ—Ä–µ–¥ –æ–±—É—á–µ–Ω–∏–µ–º</p>
        
        <button id="testDqnBtn" class="test-button" onclick="startDqnTesting()">
            üöÄ –ó–∞–ø—É—Å—Ç–∏—Ç—å –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ DQN
        </button>
        
        <button id="checkStatusBtn" class="test-button" onclick="checkDqnStatus()" style="display: none;">
            üîç –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –°—Ç–∞—Ç—É—Å
        </button>
        
        <button id="viewResultsBtn" class="test-button" onclick="viewDqnResults()" style="display: none;">
            üìä –ü–æ–∫–∞–∑–∞—Ç—å –†–µ–∑—É–ª—å—Ç–∞—Ç—ã
        </button>
        
        <div id="testStatus" class="test-status" style="display: none;"></div>
        
        <div class="progress-bar" id="progressBar" style="display: none;">
            <div class="progress-fill" id="progressFill"></div>
        </div>
        
        <div id="testResults" class="test-results" style="display: none;"></div>
    </div>

    <!-- –°–µ–∫—Ü–∏—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è GPU Replay Buffer -->
    <div class="test-section">
        <h2>üöÄ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ GPU Replay Buffer</h2>
        <p>–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å GPU-–æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ replay buffer</p>
        
        <button id="testGpuReplayBtn" class="test-button" onclick="testGpuReplay()">
            ‚ö° –¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å GPU Replay Buffer
        </button>
        
        <div id="gpuReplayStatus" class="test-status" style="display: none;"></div>
        
        <div id="gpuReplayResults" class="test-results" style="display: none;"></div>
    </div>

    <!-- –°–µ–∫—Ü–∏—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –ø—Ä–µ–¥–≤—ã—á–∏—Å–ª–µ–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏–π -->
    <div class="test-section">
        <h2>‚ö° –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–µ–¥–≤—ã—á–∏—Å–ª–µ–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏–π</h2>
        <p>–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–∞–±–æ—Ç—É –ø—Ä–µ–¥–≤—ã—á–∏—Å–ª–µ–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏–π –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏</p>
        
        <button id="testPrecomputedBtn" class="test-button" onclick="testPrecomputedStates()">
            üîÑ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–µ–¥–≤—ã—á–∏—Å–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏–π
        </button>
        
        <div id="precomputedStatus" class="test-status" style="display: none;"></div>
        
        <div id="precomputedResults" class="test-results" style="display: none;"></div>
    </div>

    <!-- –°–µ–∫—Ü–∏—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è torch.compile -->
    <div class="test-section">
        <h2>üöÄ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ torch.compile</h2>
        <p>–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–∞–±–æ—Ç—É PyTorch 2.x compile –¥–ª—è –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–≥–æ —É—Å–∫–æ—Ä–µ–Ω–∏—è</p>
        
        <button id="testTorchCompileBtn" class="test-button" onclick="testTorchCompile()">
            ‚ö° –¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å torch.compile
        </button>
        
        <div id="torchCompileStatus" class="test-status" style="display: none;"></div>
        
        <div id="torchCompileResults" class="test-results" style="display: none;"></div>
    </div>

    <!-- –°–µ–∫—Ü–∏—è –∑–∞–ø—É—Å–∫–∞ –≤—Å–µ—Ö —Ç–µ—Å—Ç–æ–≤ -->
    <div class="test-section">
        <h2>üéØ –ó–∞–ø—É—Å–∫ –≤—Å–µ—Ö —Ç–µ—Å—Ç–æ–≤ DQN</h2>
        <p>–ó–∞–ø—É—Å—Ç–∏—Ç–µ –ø–æ–ª–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ DQN –∞–≥–µ–Ω—Ç–∞</p>
        
        <button id="runAllTestsBtn" class="test-button" onclick="runAllTests()">
            üöÄ –ó–∞–ø—É—Å—Ç–∏—Ç—å –≤—Å–µ —Ç–µ—Å—Ç—ã
        </button>
        
        <div id="allTestsStatus" class="test-status" style="display: none;"></div>
        
        <div id="allTestsResults" class="test-results" style="display: none;"></div>
    </div>

    <!-- –°–µ–∫—Ü–∏—è –∞–Ω–∞–ª–∏–∑–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –æ–±—É—á–µ–Ω–∏—è -->
    <div class="test-section">
        <h2>üìä –ê–Ω–∞–ª–∏–∑ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –æ–±—É—á–µ–Ω–∏—è</h2>
        <p>–ê–Ω–∞–ª–∏–∑–∏—Ä—É–π—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –æ–±—É—á–µ–Ω–∏—è DQN –º–æ–¥–µ–ª–∏ –∏ —Å–æ–∑–¥–∞–≤–∞–π—Ç–µ –≥—Ä–∞—Ñ–∏–∫–∏</p>
        
        <button id="listResultsBtn" class="test-button" onclick="listTrainingResults()">
            üìã –°–ø–∏—Å–æ–∫ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
        </button>
        
        <button id="analyzeResultsBtn" class="test-button" onclick="analyzeTrainingResults()">
            üìà –ê–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
        </button>
        
        <div id="analysisStatus" class="test-status" style="display: none;"></div>
        
        <div id="analysisResults" class="test-results" style="display: none;"></div>
        
        <div id="filesList" class="test-results" style="display: none;"></div>
    </div>

    <form action="/clean_data" method="post">
        <input type="hidden" name="query" value="test_query">
        <button type="submit">–ó–∞–ø—É—Å—Ç–∏—Ç—å –æ—á–∏—Å—Ç–∫—É postgers –æ—Ç –ø–∏–∫–æ–≤<</button>
    </form>    
    <br>
    <form action="/clean_db" method="post">
        <input type="hidden" name="query" value="test_query">
        <button type="submit">–ó–∞–ø—É—Å—Ç–∏—Ç—å –æ—á–∏—Å—Ç–∫—É postgers –æ—Çc—Å–≤–µ—á–µ–π<</button>
    </form>      
    <br>
    <form action="/parser" method="post">
        <input type="hidden" name="query" value="test_query">
        <button type="submit">–°–∫–∞—á–∞—Ç—å —Å–≤–µ—á–∏<</button>
    </form>   <br>   
        <form action="/task-start-search" method="post">
        <input type="hidden" name="query" value="test_query">
        <button type="submit">–ó–∞–ø—É—Å—Ç–∏—Ç—å RandomSearch</button>
    </form>

    <h2>–°—Ç–∞—Ç—É—Å –∑–∞–¥–∞—á</h2>
    <table>
        <thead>
            <tr>
                <th>Task ID</th>
                <th>State</th>
                <th>Result</th>
            </tr>
        </thead>
        <tbody>
            {% for task in tasks %}
            <tr>
                <td>{{ task.task_id }}</td>
                <td>{{ task.state }}</td>
                <td>{{ task.result if task.result else "–í—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è..." }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

    <script>
        let testInterval = null;
        let progressInterval = null;
        
        async function startDqnTesting() {
            const testBtn = document.getElementById('testDqnBtn');
            const statusBtn = document.getElementById('checkStatusBtn');
            const statusDiv = document.getElementById('testStatus');
            const progressBar = document.getElementById('progressBar');
            const progressFill = document.getElementById('progressFill');
            
            // –û—Ç–∫–ª—é—á–∞–µ–º –∫–Ω–æ–ø–∫—É –∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Å—Ç–∞—Ç—É—Å
            testBtn.disabled = true;
            testBtn.textContent = '‚è≥ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–ø—É—â–µ–Ω–æ...';
            statusDiv.style.display = 'block';
            statusDiv.className = 'test-status status-running';
            statusDiv.textContent = 'üöÄ –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è DQN —É–ª—É—á—à–µ–Ω–∏–π...';
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø—Ä–æ–≥—Ä–µ—Å—Å –±–∞—Ä
            progressBar.style.display = 'block';
            progressFill.style.width = '0%';
            
            try {
                // –ó–∞–ø—É—Å–∫–∞–µ–º —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
                const response = await fetch('/test_dqn_improvements', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    }
                });
                
                const result = await response.json();
                
                if (result.status === 'success') {
                    statusDiv.textContent = '‚úÖ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–ø—É—â–µ–Ω–æ —É—Å–ø–µ—à–Ω–æ! –û—Ç—Å–ª–µ–∂–∏–≤–∞–µ–º –ø—Ä–æ–≥—Ä–µ—Å—Å...';
                    
                    // –ó–∞–ø—É—Å–∫–∞–µ–º –∞–Ω–∏–º–∞—Ü–∏—é –ø—Ä–æ–≥—Ä–µ—Å—Å–∞
                    let progress = 0;
                    progressInterval = setInterval(() => {
                        progress += Math.random() * 15;
                        if (progress > 90) progress = 90;
                        progressFill.style.width = progress + '%';
                    }, 500);
                    
                    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å—Ç–∞—Ç—É—Å–∞
                    statusBtn.style.display = 'inline-block';
                    
                    // –ù–∞—á–∏–Ω–∞–µ–º –ø—Ä–æ–≤–µ—Ä–∫—É —Å—Ç–∞—Ç—É—Å–∞
                    startStatusChecking();
                    
                } else {
                    throw new Error(result.message);
                }
                
            } catch (error) {
                statusDiv.className = 'test-status status-error';
                statusDiv.textContent = '‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è: ' + error.message;
                testBtn.disabled = false;
                testBtn.textContent = 'üöÄ –ó–∞–ø—É—Å—Ç–∏—Ç—å –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ DQN';
                progressBar.style.display = 'none';
            }
        }
        
        function startStatusChecking() {
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç–∞—Ç—É—Å –∫–∞–∂–¥—ã–µ 2 —Å–µ–∫—É–Ω–¥—ã
            testInterval = setInterval(async () => {
                try {
                    const response = await fetch('/test_dqn_status');
                    const status = await response.json();
                    
                    const statusDiv = document.getElementById('testStatus');
                    const progressFill = document.getElementById('progressFill');
                    const viewResultsBtn = document.getElementById('viewResultsBtn');
                    
                    if (status.status === 'completed') {
                        // –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ
                        clearInterval(testInterval);
                        clearInterval(progressInterval);
                        
                        progressFill.style.width = '100%';
                        statusDiv.className = 'test-status status-success';
                        statusDiv.textContent = '‚úÖ ' + status.message;
                        
                        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
                        viewResultsBtn.style.display = 'inline-block';
                        
                        // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –æ—Å–Ω–æ–≤–Ω—É—é –∫–Ω–æ–ø–∫—É
                        const testBtn = document.getElementById('testDqnBtn');
                        testBtn.disabled = false;
                        testBtn.textContent = 'üöÄ –ó–∞–ø—É—Å—Ç–∏—Ç—å –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ DQN';
                        
                    } else if (status.status === 'failed') {
                        // –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ —Å –æ—à–∏–±–∫–∞–º–∏
                        clearInterval(testInterval);
                        clearInterval(progressInterval);
                        
                        progressFill.style.width = '100%';
                        statusDiv.className = 'test-status status-error';
                        statusDiv.textContent = '‚ùå ' + status.message;
                        
                        // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –æ—Å–Ω–æ–≤–Ω—É—é –∫–Ω–æ–ø–∫—É
                        const testBtn = document.getElementById('testDqnBtn');
                        testBtn.disabled = false;
                        testBtn.textContent = 'üöÄ –ó–∞–ø—É—Å—Ç–∏—Ç—å –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ DQN';
                        
                    } else if (status.status === 'error') {
                        // –û—à–∏–±–∫–∞ –ø—Ä–∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏
                        clearInterval(testInterval);
                        clearInterval(progressInterval);
                        
                        statusDiv.className = 'test-status status-error';
                        statusDiv.textContent = '‚ùå ' + status.message;
                        
                        // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –æ—Å–Ω–æ–≤–Ω—É—é –∫–Ω–æ–ø–∫—É
                        const testBtn = document.getElementById('testDqnBtn');
                        testBtn.disabled = false;
                        testBtn.textContent = 'üöÄ –ó–∞–ø—É—Å—Ç–∏—Ç—å –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ DQN';
                        
                    } else if (status.status === 'running') {
                        // –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è
                        statusDiv.textContent = '‚è≥ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è... –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–æ–¥–æ–∂–¥–∏—Ç–µ.';
                    }
                    
                } catch (error) {
                    console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ —Å—Ç–∞—Ç—É—Å–∞:', error);
                }
            }, 2000);
        }
        
        async function checkDqnStatus() {
            try {
                const response = await fetch('/test_dqn_status');
                const status = await response.json();
                
                const statusDiv = document.getElementById('testStatus');
                statusDiv.style.display = 'block';
                
                if (status.status === 'running') {
                    statusDiv.className = 'test-status status-running';
                    statusDiv.textContent = '‚è≥ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è...';
                } else if (status.status === 'completed') {
                    statusDiv.className = 'test-status status-success';
                    statusDiv.textContent = '‚úÖ ' + status.message;
                } else if (status.status === 'failed') {
                    statusDiv.className = 'test-status status-error';
                    statusDiv.textContent = '‚ùå ' + status.message;
                } else if (status.status === 'error') {
                    statusDiv.className = 'test-status status-error';
                    statusDiv.textContent = '‚ùå ' + status.message;
                }
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ —Å—Ç–∞—Ç—É—Å–∞:', error);
            }
        }
        
        async function viewDqnResults() {
            try {
                const response = await fetch('/test_dqn_results');
                const results = await response.json();
                
                const resultsDiv = document.getElementById('testResults');
                resultsDiv.style.display = 'block';
                
                if (results.status === 'completed' || results.status === 'failed') {
                    let resultsText = `üìä –†–ï–ó–£–õ–¨–¢–ê–¢–´ –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–Ø DQN\n`;
                    resultsText += `================================\n\n`;
                    resultsText += `–°—Ç–∞—Ç—É—Å: ${results.status}\n`;
                    resultsText += `–°–æ–æ–±—â–µ–Ω–∏–µ: ${results.message}\n`;
                    resultsText += `–í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è: ${results.duration ? results.duration.toFixed(2) + ' —Å–µ–∫' : 'N/A'}\n\n`;
                    
                    if (results.tests) {
                        resultsText += `–î–ï–¢–ê–õ–¨–ù–´–ï –†–ï–ó–£–õ–¨–¢–ê–¢–´:\n`;
                        resultsText += `===================\n\n`;
                        
                        for (const [testName, testResult] of Object.entries(results.tests)) {
                            const emoji = testResult.success ? '‚úÖ' : '‚ùå';
                            const status = testResult.success ? '–£–°–ü–ï–•' : '–û–®–ò–ë–ö–ê';
                            resultsText += `${emoji} ${testName.toUpperCase()}: ${status}\n`;
                            resultsText += `   –°–æ–æ–±—â–µ–Ω–∏–µ: ${testResult.message}\n\n`;
                        }
                    }
                    
                    if (results.overall_success) {
                        resultsText += `üéØ –í–°–ï –¢–ï–°–¢–´ –ü–†–û–ô–î–ï–ù–´ –£–°–ü–ï–®–ù–û!\n`;
                        resultsText += `DQN –∞–≥–µ–Ω—Ç –≥–æ—Ç–æ–≤ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é.\n\n`;
                        resultsText += `üìà –û–ñ–ò–î–ê–ï–ú–´–ï –£–õ–£–ß–®–ï–ù–ò–Ø:\n`;
                        resultsText += `   - Winrate: 50.23% ‚Üí 55-65%\n`;
                        resultsText += `   - P/L Ratio: 1.01 ‚Üí 1.3-1.5\n`;
                        resultsText += `   - Bad Trades: 31,352 ‚Üí 15,000-20,000\n`;
                        resultsText += `   - –°—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å: –ó–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ —É–ª—É—á—à–µ–Ω–∞\n`;
                    } else {
                        resultsText += `‚ö†Ô∏è –ù–ï–ö–û–¢–û–†–´–ï –¢–ï–°–¢–´ –ù–ï –ü–†–û–ô–î–ï–ù–´!\n`;
                        resultsText += `–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –∏ –∏—Å–ø—Ä–∞–≤—å—Ç–µ –æ—à–∏–±–∫–∏.\n`;
                    }
                    
                    resultsDiv.textContent = resultsText;
                } else {
                    resultsDiv.textContent = '–†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –µ—â–µ –Ω–µ –≥–æ—Ç–æ–≤—ã.';
                }
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤:', error);
                const resultsDiv = document.getElementById('testResults');
                resultsDiv.style.display = 'block';
                resultsDiv.textContent = '‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤: ' + error.message;
            }
        }
        
        async function testGpuReplay() {
            const testBtn = document.getElementById('testGpuReplayBtn');
            const statusDiv = document.getElementById('gpuReplayStatus');
            const resultsDiv = document.getElementById('gpuReplayResults');
            
            // –û—Ç–∫–ª—é—á–∞–µ–º –∫–Ω–æ–ø–∫—É –∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Å—Ç–∞—Ç—É—Å
            testBtn.disabled = true;
            testBtn.textContent = '‚è≥ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ GPU Replay...';
            statusDiv.style.display = 'block';
            statusDiv.className = 'test-status status-running';
            statusDiv.textContent = 'üöÄ –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è GPU Replay Buffer...';
            
            // –°–∫—Ä—ã–≤–∞–µ–º –ø—Ä–µ–¥—ã–¥—É—â–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
            resultsDiv.style.display = 'none';
            
            try {
                // –ó–∞–ø—É—Å–∫–∞–µ–º —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
                const response = await fetch('/test_gpu_replay', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    }
                });
                
                const result = await response.json();
                
                if (result.status === 'success' || result.status === 'failed') {
                    // –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ
                    statusDiv.className = result.success ? 'test-status status-success' : 'test-status status-error';
                    statusDiv.textContent = (result.success ? '‚úÖ ' : '‚ùå ') + result.message;
                    
                    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
                    resultsDiv.style.display = 'block';
                    
                    let resultsText = `üìä –†–ï–ó–£–õ–¨–¢–ê–¢–´ –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–Ø GPU REPLAY BUFFER\n`;
                    resultsText += `==========================================\n\n`;
                    resultsText += `–°—Ç–∞—Ç—É—Å: ${result.status}\n`;
                    resultsText += `–°–æ–æ–±—â–µ–Ω–∏–µ: ${result.message}\n\n`;
                    
                    if (result.metrics) {
                        resultsText += `–î–ï–¢–ê–õ–¨–ù–´–ï –ú–ï–¢–†–ò–ö–ò:\n`;
                        resultsText += `==================\n\n`;
                        resultsText += `‚Ä¢ –ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ: ${result.metrics.fill_rate?.toFixed(1) || 'N/A'} —ç–ª–µ–º–µ–Ω—Ç–æ–≤/—Å\n`;
                        resultsText += `‚Ä¢ –°—ç–º–ø–ª–∏—Ä–æ–≤–∞–Ω–∏–µ: ${result.metrics.sample_rate?.toFixed(1) || 'N/A'} –±–∞—Ç—á–µ–π/—Å\n`;
                        resultsText += `‚Ä¢ –û–±–Ω–æ–≤–ª–µ–Ω–∏—è: ${result.metrics.update_rate?.toFixed(1) || 'N/A'} –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π/—Å\n`;
                        resultsText += `‚Ä¢ –û–±—â–µ–µ –≤—Ä–µ–º—è: ${result.metrics.total_time?.toFixed(2) || 'N/A'}—Å\n`;
                        resultsText += `‚Ä¢ –¢–∏–ø —Ö—Ä–∞–Ω–µ–Ω–∏—è: ${result.metrics.storage_type || 'N/A'}\n`;
                        resultsText += `‚Ä¢ –£—Å—Ç—Ä–æ–π—Å—Ç–≤–æ: ${result.metrics.device || 'N/A'}\n`;
                        
                        if (result.metrics.gpu_memory > 0) {
                            resultsText += `‚Ä¢ GPU –ø–∞–º—è—Ç—å: ${result.metrics.gpu_memory.toFixed(1)}MB (–≤—ã–¥–µ–ª–µ–Ω–æ)\n`;
                            resultsText += `‚Ä¢ GPU –ø–∞–º—è—Ç—å: ${result.metrics.gpu_memory_reserved.toFixed(1)}MB (–∑–∞—Ä–µ–∑–µ—Ä–≤–∏—Ä–æ–≤–∞–Ω–æ)\n`;
                        }
                        
                        resultsText += `\nüéØ –û–¶–ï–ù–ö–ê –ü–†–û–ò–ó–í–û–î–ò–¢–ï–õ–¨–ù–û–°–¢–ò:\n`;
                        const fillRate = result.metrics.fill_rate || 0;
                        const sampleRate = result.metrics.sample_rate || 0;
                        
                        if (fillRate > 1000 && sampleRate > 50) {
                            resultsText += `üöÄ –û–¢–õ–ò–ß–ù–û - GPU –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç –∏–¥–µ–∞–ª—å–Ω–æ!\n`;
                        } else if (fillRate > 500 && sampleRate > 20) {
                            resultsText += `‚úÖ –•–û–†–û–®–û - GPU –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç —Ö–æ—Ä–æ—à–æ\n`;
                        } else {
                            resultsText += `‚ö†Ô∏è –¢–†–ï–ë–£–ï–¢ –û–ü–¢–ò–ú–ò–ó–ê–¶–ò–ò - –≤–æ–∑–º–æ–∂–Ω–æ, –Ω—É–∂–Ω–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã\n`;
                        }
                        
                        resultsText += `\nüí° –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò:\n`;
                        if (result.metrics.storage_type === 'GPU storage') {
                            resultsText += `‚Ä¢ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è GPU storage - –æ—Ç–ª–∏—á–Ω–æ –¥–ª—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏\n`;
                        } else {
                            resultsText += `‚Ä¢ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è Pinned memory - —Ö–æ—Ä–æ—à–æ –¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏\n`;
                        }
                        
                        if (fillRate < 500) {
                            resultsText += `‚Ä¢ –°–∫–æ—Ä–æ—Å—Ç—å –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è –Ω–∏–∑–∫–∞—è - –ø—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–∞–∑–º–µ—Ä —Å–æ—Å—Ç–æ—è–Ω–∏—è\n`;
                        }
                        
                        if (sampleRate < 20) {
                            resultsText += `‚Ä¢ –°–∫–æ—Ä–æ—Å—Ç—å —Å—ç–º–ø–ª–∏—Ä–æ–≤–∞–Ω–∏—è –Ω–∏–∑–∫–∞—è - –ø—Ä–æ–≤–µ—Ä—å—Ç–µ batch size\n`;
                        }
                    }
                    
                    resultsDiv.textContent = resultsText;
                    
                } else {
                    throw new Error(result.message);
                }
                
            } catch (error) {
                statusDiv.className = 'test-status status-error';
                statusDiv.textContent = '‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏: ' + error.message;
            } finally {
                // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∫–Ω–æ–ø–∫—É
                testBtn.disabled = false;
                testBtn.textContent = '‚ö° –¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å GPU Replay Buffer';
            }
        }
        
        async function testPrecomputedStates() {
            const testBtn = document.getElementById('testPrecomputedBtn');
            const statusDiv = document.getElementById('precomputedStatus');
            const resultsDiv = document.getElementById('precomputedResults');
            
            // –û—Ç–∫–ª—é—á–∞–µ–º –∫–Ω–æ–ø–∫—É –∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Å—Ç–∞—Ç—É—Å
            testBtn.disabled = true;
            testBtn.textContent = '‚è≥ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–µ–¥–≤—ã—á–∏—Å–ª–µ–Ω–∏—è...';
            statusDiv.style.display = 'block';
            statusDiv.className = 'test-status status-running';
            statusDiv.textContent = 'üöÄ –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –ø—Ä–µ–¥–≤—ã—á–∏—Å–ª–µ–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏–π...';
            
            // –°–∫—Ä—ã–≤–∞–µ–º –ø—Ä–µ–¥—ã–¥—É—â–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
            resultsDiv.style.display = 'none';
            
            try {
                // –ó–∞–ø—É—Å–∫–∞–µ–º —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
                const response = await fetch('/test_precomputed_states', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    }
                });
                
                const result = await response.json();
                
                if (result.status === 'success' || result.status === 'failed') {
                    // –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ
                    statusDiv.className = result.success ? 'test-status status-success' : 'test-status status-error';
                    statusDiv.textContent = (result.success ? '‚úÖ ' : '‚ùå ') + result.message;
                    
                    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
                    resultsDiv.style.display = 'block';
                    
                    let resultsText = `üìä –†–ï–ó–£–õ–¨–¢–ê–¢–´ –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–Ø –ü–†–ï–î–í–´–ß–ò–°–õ–ï–ù–ò–Ø –°–û–°–¢–û–Ø–ù–ò–ô\n`;
                    resultsText += `==================================================\n\n`;
                    resultsText += `–°—Ç–∞—Ç—É—Å: ${result.status}\n`;
                    resultsText += `–°–æ–æ–±—â–µ–Ω–∏–µ: ${result.message}\n\n`;
                    
                    if (result.metrics) {
                        resultsText += `–î–ï–¢–ê–õ–¨–ù–´–ï –ú–ï–¢–†–ò–ö–ò:\n`;
                        resultsText += `==================\n\n`;
                        resultsText += `‚Ä¢ –°—Ç–∞—Ç—É—Å: ${result.metrics.status || 'N/A'}\n`;
                        resultsText += `‚Ä¢ –°–æ–æ–±—â–µ–Ω–∏–µ: ${result.metrics.message || 'N/A'}\n`;
                    }
                    
                    resultsText += `\nüéØ –û–¶–ï–ù–ö–ê:\n`;
                    if (result.success) {
                        resultsText += `‚úÖ –ü—Ä–µ–¥–≤—ã—á–∏—Å–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏–π —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ\n`;
                        resultsText += `üöÄ –û–∫—Ä—É–∂–µ–Ω–∏–µ –≥–æ—Ç–æ–≤–æ –∫ –±—ã—Å—Ç—Ä–æ–π —Ä–∞–±–æ—Ç–µ\n`;
                        resultsText += `‚ö° –°–æ—Å—Ç–æ—è–Ω–∏—è –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–∞—Ç—å—Å—è –º–≥–Ω–æ–≤–µ–Ω–Ω–æ\n`;
                    } else {
                        resultsText += `‚ùå –û–±–Ω–∞—Ä—É–∂–µ–Ω—ã –ø—Ä–æ–±–ª–µ–º—ã —Å –ø—Ä–µ–¥–≤—ã—á–∏—Å–ª–µ–Ω–∏–µ–º\n`;
                        resultsText += `‚ö†Ô∏è –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –¥–ª—è –¥–µ—Ç–∞–ª–µ–π\n`;
                    }
                    
                    resultsText += `\nüí° –ü–†–ï–ò–ú–£–©–ï–°–¢–í–ê –ü–†–ï–î–í–´–ß–ò–°–õ–ï–ù–ò–Ø:\n`;
                    resultsText += `‚Ä¢ –ú–≥–Ω–æ–≤–µ–Ω–Ω—ã–π –¥–æ—Å—Ç—É–ø –∫ —Å–æ—Å—Ç–æ—è–Ω–∏—è–º\n`;
                    resultsText += `‚Ä¢ –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –∑–∞–¥–µ—Ä–∂–µ–∫ –ø—Ä–∏ –æ–±—É—á–µ–Ω–∏–∏\n`;
                    resultsText += `‚Ä¢ –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è hot-path –æ–ø–µ—Ä–∞—Ü–∏–π\n`;
                    resultsText += `‚Ä¢ –°–Ω–∏–∂–µ–Ω–∏–µ –Ω–∞–≥—Ä—É–∑–∫–∏ –Ω–∞ CPU\n`;
                    
                    resultsDiv.textContent = resultsText;
                    
                } else {
                    throw new Error(result.message);
                }
                
            } catch (error) {
                statusDiv.className = 'test-status status-error';
                statusDiv.textContent = '‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏: ' + error.message;
            } finally {
                // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∫–Ω–æ–ø–∫—É
                testBtn.disabled = false;
                testBtn.textContent = 'üîÑ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–µ–¥–≤—ã—á–∏—Å–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏–π';
            }
        }

        async function testTorchCompile() {
            const testBtn = document.getElementById('testTorchCompileBtn');
            const statusDiv = document.getElementById('torchCompileStatus');
            const resultsDiv = document.getElementById('torchCompileResults');
            
            // –û—Ç–∫–ª—é—á–∞–µ–º –∫–Ω–æ–ø–∫—É –∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Å—Ç–∞—Ç—É—Å
            testBtn.disabled = true;
            testBtn.textContent = '‚è≥ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ torch.compile...';
            statusDiv.style.display = 'block';
            statusDiv.className = 'test-status status-running';
            statusDiv.textContent = 'üöÄ –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è torch.compile...';
            
            // –°–∫—Ä—ã–≤–∞–µ–º –ø—Ä–µ–¥—ã–¥—É—â–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
            resultsDiv.style.display = 'none';
            
            try {
                // –ó–∞–ø—É—Å–∫–∞–µ–º —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
                const response = await fetch('/test_torch_compile', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    }
                });
                
                const result = await response.json();
                
                if (result.status === 'success' || result.status === 'failed') {
                    // –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ
                    statusDiv.className = result.success ? 'test-status status-success' : 'test-status status-error';
                    statusDiv.textContent = (result.success ? '‚úÖ ' : '‚ùå ') + result.message;
                    
                    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
                    resultsDiv.style.display = 'block';
                    
                    let resultsText = `üìä –†–ï–ó–£–õ–¨–¢–ê–¢–´ –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–Ø TORCH.COMPILE\n`;
                    resultsText += `==========================================\n\n`;
                    resultsText += `–°—Ç–∞—Ç—É—Å: ${result.status}\n`;
                    resultsText += `–°–æ–æ–±—â–µ–Ω–∏–µ: ${result.message}\n\n`;
                    
                    if (result.metrics) {
                        resultsText += `–î–ï–¢–ê–õ–¨–ù–´–ï –ú–ï–¢–†–ò–ö–ò:\n`;
                        resultsText += `==================\n\n`;
                        resultsText += `‚Ä¢ –°—Ç–∞—Ç—É—Å: ${result.metrics.status || 'N/A'}\n`;
                        resultsText += `‚Ä¢ –°–æ–æ–±—â–µ–Ω–∏–µ: ${result.metrics.message || 'N/A'}\n`;
                    }
                    
                    resultsText += `\nüéØ –û–¶–ï–ù–ö–ê:\n`;
                    if (result.success) {
                        resultsText += `‚úÖ torch.compile —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ\n`;
                        resultsText += `üöÄ –ú–æ–¥–µ–ª—å –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å —Å –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–º —É—Å–∫–æ—Ä–µ–Ω–∏–µ–º\n`;
                        resultsText += `‚ö° –û–∂–∏–¥–∞–µ—Ç—Å—è —É—Å–∫–æ—Ä–µ–Ω–∏–µ 30-50%\n`;
                    } else {
                        resultsText += `‚ùå torch.compile –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω –∏–ª–∏ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç\n`;
                        resultsText += `‚ö†Ô∏è –ú–æ–¥–µ–ª—å –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –±–µ–∑ –∫–æ–º–ø–∏–ª—è—Ü–∏–∏\n`;
                    }
                    
                    resultsText += `\nüí° –ü–†–ï–ò–ú–£–©–ï–°–¢–í–ê TORCH.COMPILE:\n`;
                    resultsText += `‚Ä¢ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –≥—Ä–∞—Ñ–æ–≤\n`;
                    resultsText += `‚Ä¢ –£—Å–∫–æ—Ä–µ–Ω–∏–µ –¥–æ 30-50%\n`;
                    resultsText += `‚Ä¢ –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø–∞–º—è—Ç–∏\n`;
                    resultsText += `‚Ä¢ –õ—É—á—à–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –Ω–∞ GPU\n`;
                    
                    resultsDiv.textContent = resultsText;
                    
                } else {
                    throw new Error(result.message);
                }
                
            } catch (error) {
                statusDiv.className = 'test-status status-error';
                statusDiv.textContent = '‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏: ' + error.message;
            } finally {
                // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∫–Ω–æ–ø–∫—É
                testBtn.disabled = false;
                testBtn.textContent = '‚ö° –¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å torch.compile';
            }
        }

        async function runAllTests() {
            const testBtn = document.getElementById('runAllTestsBtn');
            const statusDiv = document.getElementById('allTestsStatus');
            const resultsDiv = document.getElementById('allTestsResults');
            
            // –û—Ç–∫–ª—é—á–∞–µ–º –∫–Ω–æ–ø–∫—É –∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Å—Ç–∞—Ç—É—Å
            testBtn.disabled = true;
            testBtn.textContent = '‚è≥ –ó–∞–ø—É—Å–∫ –≤—Å–µ—Ö —Ç–µ—Å—Ç–æ–≤...';
            statusDiv.style.display = 'block';
            statusDiv.className = 'test-status status-running';
            statusDiv.textContent = 'üöÄ –ó–∞–ø—É—Å–∫ –≤—Å–µ—Ö —Ç–µ—Å—Ç–æ–≤ DQN...';
            
            // –°–∫—Ä—ã–≤–∞–µ–º –ø—Ä–µ–¥—ã–¥—É—â–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
            resultsDiv.style.display = 'none';
            
            try {
                // –ó–∞–ø—É—Å–∫–∞–µ–º —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
                const response = await fetch('/test_dqn_improvements', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    }
                });
                
                const result = await response.json();
                
                if (result.status === 'success') {
                    statusDiv.textContent = '‚úÖ –í—Å–µ —Ç–µ—Å—Ç—ã –∑–∞–ø—É—â–µ–Ω—ã! –û—Ç—Å–ª–µ–∂–∏–≤–∞–µ–º –ø—Ä–æ–≥—Ä–µ—Å—Å...';
                    
                    // –ù–∞—á–∏–Ω–∞–µ–º –ø—Ä–æ–≤–µ—Ä–∫—É —Å—Ç–∞—Ç—É—Å–∞
                    startAllTestsStatusChecking();
                    
                } else {
                    throw new Error(result.message);
                }
                
            } catch (error) {
                statusDiv.className = 'test-status status-error';
                statusDiv.textContent = '‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ —Ç–µ—Å—Ç–æ–≤: ' + error.message;
                testBtn.disabled = false;
                testBtn.textContent = 'üöÄ –ó–∞–ø—É—Å—Ç–∏—Ç—å –≤—Å–µ —Ç–µ—Å—Ç—ã';
            }
        }

        function startAllTestsStatusChecking() {
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç–∞—Ç—É—Å –∫–∞–∂–¥—ã–µ 2 —Å–µ–∫—É–Ω–¥—ã
            const interval = setInterval(async () => {
                try {
                    const response = await fetch('/test_dqn_status');
                    const status = await response.json();
                    
                    const statusDiv = document.getElementById('allTestsStatus');
                    const resultsDiv = document.getElementById('allTestsResults');
                    const testBtn = document.getElementById('runAllTestsBtn');
                    
                    if (status.status === 'completed') {
                        // –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ
                        clearInterval(interval);
                        
                        statusDiv.className = 'test-status status-success';
                        statusDiv.textContent = '‚úÖ ' + status.message;
                        
                        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
                        resultsDiv.style.display = 'block';
                        
                        let resultsText = `üìä –†–ï–ó–£–õ–¨–¢–ê–¢–´ –í–°–ï–• –¢–ï–°–¢–û–í DQN\n`;
                        resultsText += `================================\n\n`;
                        resultsText += `–°—Ç–∞—Ç—É—Å: ${status.status}\n`;
                        resultsText += `–°–æ–æ–±—â–µ–Ω–∏–µ: ${status.message}\n`;
                        resultsText += `–í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è: ${status.duration?.toFixed(2) || 'N/A'} —Å–µ–∫—É–Ω–¥\n\n`;
                        
                        if (status.tests) {
                            resultsText += `–î–ï–¢–ê–õ–¨–ù–´–ï –†–ï–ó–£–õ–¨–¢–ê–¢–´:\n`;
                            resultsText += `====================\n\n`;
                            
                            for (const [testName, testResult] of Object.entries(status.tests)) {
                                const emoji = testResult.success ? '‚úÖ' : '‚ùå';
                                resultsText += `${emoji} ${testName}: ${testResult.message}\n`;
                            }
                        }
                        
                        resultsText += `\nüéØ –û–ë–©–ê–Ø –û–¶–ï–ù–ö–ê:\n`;
                        if (status.overall_success) {
                            resultsText += `üéâ –í–°–ï –¢–ï–°–¢–´ –ü–†–û–ô–î–ï–ù–´ –£–°–ü–ï–®–ù–û!\n`;
                            resultsText += `üöÄ DQN –∞–≥–µ–Ω—Ç –≥–æ—Ç–æ–≤ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é\n`;
                            resultsText += `‚ö° –í—Å–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ —Ä–∞–±–æ—Ç–∞—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ\n`;
                        } else {
                            resultsText += `‚ö†Ô∏è –ù–ï–ö–û–¢–û–†–´–ï –¢–ï–°–¢–´ –ù–ï –ü–†–û–ô–î–ï–ù–´\n`;
                            resultsText += `üîß –¢—Ä–µ–±—É–µ—Ç—Å—è –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞\n`;
                        }
                        
                        resultsDiv.textContent = resultsText;
                        
                        // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∫–Ω–æ–ø–∫—É
                        testBtn.disabled = false;
                        testBtn.textContent = 'üöÄ –ó–∞–ø—É—Å—Ç–∏—Ç—å –≤—Å–µ —Ç–µ—Å—Ç—ã';
                        
                    } else if (status.status === 'failed') {
                        // –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ —Å –æ—à–∏–±–∫–∞–º–∏
                        clearInterval(interval);
                        
                        statusDiv.className = 'test-status status-error';
                        statusDiv.textContent = '‚ùå ' + status.message;
                        
                        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
                        resultsDiv.style.display = 'block';
                        resultsDiv.textContent = `‚ùå –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ —Å –æ—à–∏–±–∫–∞–º–∏:\n${status.message}`;
                        
                        // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∫–Ω–æ–ø–∫—É
                        testBtn.disabled = false;
                        testBtn.textContent = 'üöÄ –ó–∞–ø—É—Å—Ç–∏—Ç—å –≤—Å–µ —Ç–µ—Å—Ç—ã';
                        
                    } else if (status.status === 'running') {
                        // –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è
                        statusDiv.textContent = 'üîÑ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è... ' + status.message;
                    }
                    
                } catch (error) {
                    console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ —Å—Ç–∞—Ç—É—Å–∞:', error);
                }
            }, 2000);
        }

        // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –æ–±—É—á–µ–Ω–∏—è
        async function listTrainingResults() {
            const statusDiv = document.getElementById('analysisStatus');
            const filesDiv = document.getElementById('filesList');
            const listBtn = document.getElementById('listResultsBtn');
            
            // –û—Ç–∫–ª—é—á–∞–µ–º –∫–Ω–æ–ø–∫—É –∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Å—Ç–∞—Ç—É—Å
            listBtn.disabled = true;
            listBtn.textContent = '‚è≥ –ü–æ–∏—Å–∫ —Ñ–∞–π–ª–æ–≤...';
            statusDiv.style.display = 'block';
            statusDiv.className = 'test-status status-running';
            statusDiv.textContent = 'üîç –ü–æ–∏—Å–∫ —Ñ–∞–π–ª–æ–≤ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –æ–±—É—á–µ–Ω–∏—è...';
            
            try {
                const response = await fetch('/list_training_results', {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json',
                    }
                });
                
                const result = await response.json();
                
                if (result.success) {
                    statusDiv.className = 'test-status status-success';
                    statusDiv.textContent = '‚úÖ ' + result.message;
                    
                    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–ø–∏—Å–æ–∫ —Ñ–∞–π–ª–æ–≤
                    filesDiv.style.display = 'block';
                    
                    let filesText = `üìã –î–û–°–¢–£–ü–ù–´–ï –§–ê–ô–õ–´ –†–ï–ó–£–õ–¨–¢–ê–¢–û–í:\n`;
                    filesText += `=====================================\n\n`;
                    
                    if (result.files && result.files.length > 0) {
                        for (const file of result.files) {
                            const date = new Date(file.created * 1000).toLocaleString();
                            const sizeKB = (file.size / 1024).toFixed(1);
                            filesText += `üìÑ ${file.filename}\n`;
                            filesText += `   üìÖ –°–æ–∑–¥–∞–Ω: ${date}\n`;
                            filesText += `   üìè –†–∞–∑–º–µ—Ä: ${sizeKB} KB\n\n`;
                        }
                    } else {
                        filesText += `‚ùå –§–∞–π–ª—ã —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã\n`;
                        filesText += `üí° –°–Ω–∞—á–∞–ª–∞ –∑–∞–ø—É—Å—Ç–∏—Ç–µ –æ–±—É—á–µ–Ω–∏–µ –º–æ–¥–µ–ª–∏\n`;
                    }
                    
                    filesDiv.textContent = filesText;
                    
                } else {
                    throw new Error(result.message);
                }
                
            } catch (error) {
                statusDiv.className = 'test-status status-error';
                statusDiv.textContent = '‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–∏—Å–∫–µ —Ñ–∞–π–ª–æ–≤: ' + error.message;
            } finally {
                // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∫–Ω–æ–ø–∫—É
                listBtn.disabled = false;
                listBtn.textContent = 'üìã –°–ø–∏—Å–æ–∫ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤';
            }
        }

        async function analyzeTrainingResults() {
            const statusDiv = document.getElementById('analysisStatus');
            const resultsDiv = document.getElementById('analysisResults');
            const analyzeBtn = document.getElementById('analyzeResultsBtn');
            
            // –û—Ç–∫–ª—é—á–∞–µ–º –∫–Ω–æ–ø–∫—É –∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Å—Ç–∞—Ç—É—Å
            analyzeBtn.disabled = true;
            analyzeBtn.textContent = '‚è≥ –ê–Ω–∞–ª–∏–∑...';
            statusDiv.style.display = 'block';
            statusDiv.className = 'test-status status-running';
            statusDiv.textContent = 'üìä –ê–Ω–∞–ª–∏–∑ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –æ–±—É—á–µ–Ω–∏—è...';
            
            try {
                const response = await fetch('/analyze_training_results', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    }
                });
                
                const result = await response.json();
                
                if (result.success) {
                    statusDiv.className = 'test-status status-success';
                    statusDiv.textContent = '‚úÖ ' + result.message;
                    
                    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –∞–Ω–∞–ª–∏–∑–∞
                    resultsDiv.style.display = 'block';
                    
                    let analysisText = `üìä –ê–ù–ê–õ–ò–ó –†–ï–ó–£–õ–¨–¢–ê–¢–û–í –û–ë–£–ß–ï–ù–ò–Ø\n`;
                    analysisText += `=====================================\n\n`;
                    analysisText += `üìÑ –§–∞–π–ª: ${result.file_analyzed}\n`;
                    analysisText += `üìÖ –í—Ä–µ–º—è –∞–Ω–∞–ª–∏–∑–∞: ${new Date().toLocaleString()}\n\n`;
                    
                    if (result.output) {
                        analysisText += result.output;
                    } else {
                        analysisText += `‚ö†Ô∏è –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –∞–Ω–∞–ª–∏–∑–∞ –Ω–µ –ø–æ–ª—É—á–µ–Ω—ã\n`;
                    }
                    
                    if (result.available_files && result.available_files.length > 1) {
                        analysisText += `\nüìã –î—Ä—É–≥–∏–µ –¥–æ—Å—Ç—É–ø–Ω—ã–µ —Ñ–∞–π–ª—ã:\n`;
                        for (const file of result.available_files) {
                            if (file !== result.file_analyzed) {
                                analysisText += `   ‚Ä¢ ${file}\n`;
                            }
                        }
                    }
                    
                    resultsDiv.textContent = analysisText;
                    
                } else {
                    throw new Error(result.message);
                }
                
            } catch (error) {
                statusDiv.className = 'test-status status-error';
                statusDiv.textContent = '‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –∞–Ω–∞–ª–∏–∑–µ: ' + error.message;
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –¥–µ—Ç–∞–ª–∏ –æ—à–∏–±–∫–∏
                resultsDiv.style.display = 'block';
                resultsDiv.textContent = `‚ùå –û–®–ò–ë–ö–ê –ê–ù–ê–õ–ò–ó–ê:\n${error.message}\n\nüí° –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ:\n‚Ä¢ –û–±—É—á–µ–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ\n‚Ä¢ –§–∞–π–ª—ã —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ —Å—É—â–µ—Å—Ç–≤—É—é—Ç\n‚Ä¢ –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã matplotlib –∏ numpy`;
            } finally {
                // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∫–Ω–æ–ø–∫—É
                analyzeBtn.disabled = false;
                analyzeBtn.textContent = 'üìà –ê–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã';
            }
        }
    </script>
</body>
</html>

