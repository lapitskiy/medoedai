# –£–ª—É—á—à–µ–Ω–Ω—ã–π DQN –ê–≥–µ–Ω—Ç –¥–ª—è –¢–æ—Ä–≥–æ–≤–ª–∏ –ö—Ä–∏–ø—Ç–æ–≤–∞–ª—é—Ç–æ–π

## üöÄ –û—Å–Ω–æ–≤–Ω—ã–µ –£–ª—É—á—à–µ–Ω–∏—è

### 1. –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ù–µ–π—Ä–æ–Ω–Ω–æ–π –°–µ—Ç–∏
- **Dueling DQN**: –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –Ω–∞ Value –∏ Advantage –ø–æ—Ç–æ–∫–∏ –¥–ª—è –ª—É—á—à–µ–≥–æ –æ–±—É—á–µ–Ω–∏—è Q-–∑–Ω–∞—á–µ–Ω–∏–π
- **–£–≤–µ–ª–∏—á–µ–Ω–Ω—ã–µ —Ä–∞–∑–º–µ—Ä—ã —Å–ª–æ–µ–≤**: (512, 256, 128) –≤–º–µ—Å—Ç–æ (128, 64)
- **Layer Normalization**: –°—Ç–∞–±–∏–ª–∏–∑–∞—Ü–∏—è –æ–±—É—á–µ–Ω–∏—è
- **Dropout (20%)**: –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏–µ –ø–µ—Ä–µ–æ–±—É—á–µ–Ω–∏—è
- **–£–ª—É—á—à–µ–Ω–Ω–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –≤–µ—Å–æ–≤**: Kaiming –∏ Xavier –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è

### 2. Prioritized Experience Replay (PER)
- **–ü—Ä–∏–æ—Ä–∏—Ç–∏–∑–∞—Ü–∏—è –ø–æ TD-–æ—à–∏–±–∫–∞–º**: –ë–æ–ª–µ–µ –≤–∞–∂–Ω—ã–µ –ø–µ—Ä–µ—Ö–æ–¥—ã –æ–±—É—á–∞—é—Ç—Å—è —á–∞—â–µ
- **Importance Sampling**: –ö–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∞ —Å–º–µ—â–µ–Ω–∏—è –æ—Ç –ø—Ä–∏–æ—Ä–∏—Ç–∏–∑–∞—Ü–∏–∏
- **–ê–¥–∞–ø—Ç–∏–≤–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã**: alpha=0.6, beta=0.4 —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º —É–≤–µ–ª–∏—á–µ–Ω–∏–µ–º

### 3. Double DQN
- **–†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –≤—ã–±–æ—Ä–∞ –∏ –æ—Ü–µ–Ω–∫–∏ –¥–µ–π—Å—Ç–≤–∏–π**: –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –ø–µ—Ä–µ–æ—Ü–µ–Ω–∫–∏ Q-–∑–Ω–∞—á–µ–Ω–∏–π
- **–°—Ç–∞–±–∏–ª—å–Ω–æ–µ –æ–±—É—á–µ–Ω–∏–µ**: –õ—É—á—à–∞—è —Å—Ö–æ–¥–∏–º–æ—Å—Ç—å

### 4. –£–ª—É—á—à–µ–Ω–Ω—ã–µ –ì–∏–ø–µ—Ä–ø–∞—Ä–∞–º–µ—Ç—Ä—ã
- **Learning Rate**: 5e-4 (—É–º–µ–Ω—å—à–µ–Ω —Å 1e-3 –¥–ª—è —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏)
- **Gamma**: 0.99 (—É–º–µ–Ω—å—à–µ–Ω —Å 0.995 –¥–ª—è –±–æ–ª–µ–µ –±–ª–∏–∑–∫–æ–≥–æ –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è)
- **Epsilon Decay**: 50,000 —à–∞–≥–æ–≤ (—É–≤–µ–ª–∏—á–µ–Ω–æ —Å 10,000)
- **Batch Size**: 512 (—É–≤–µ–ª–∏—á–µ–Ω —Å 256)
- **Memory Size**: 500,000 (—É–≤–µ–ª–∏—á–µ–Ω —Å 200,000)

### 5. –ê–¥–∞–ø—Ç–∏–≤–Ω–æ–µ –ò—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ
- **–î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π Epsilon**: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —É–≤–µ–ª–∏—á–µ–Ω–∏–µ –ø—Ä–∏ –Ω–∏–∑–∫–æ–º winrate
- **Early Stopping**: –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ —É–ª—É—á—à–µ–Ω–∏–π
- **–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ª—É—á—à–∏—Ö –º–æ–¥–µ–ª–µ–π**: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–∏ —É–ª—É—á—à–µ–Ω–∏–∏

### 6. –û–±—Ä–∞–±–æ—Ç–∫–∞ –û—à–∏–±–æ–∫
- **NaN Guard**: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∑–∞–º–µ–Ω–∞ NaN –∑–Ω–∞—á–µ–Ω–∏–π
- **–ì—Ä–∞–¥–∏–µ–Ω—Ç–Ω—ã–π –∫–ª–∏–ø–ø–∏–Ω–≥**: –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏–µ –≤–∑—Ä—ã–≤–∞ –≥—Ä–∞–¥–∏–µ–Ω—Ç–æ–≤
- **–£–ª—É—á—à–µ–Ω–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –ø–æ—Ç–µ—Ä—å**: Huber Loss –≤–º–µ—Å—Ç–æ SmoothL1Loss

## üìä –û–∂–∏–¥–∞–µ–º—ã–µ –†–µ–∑—É–ª—å—Ç–∞—Ç—ã

–ü–æ—Å–ª–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è —É–ª—É—á—à–µ–Ω–∏–π –æ–∂–∏–¥–∞–µ—Ç—Å—è:

- **Winrate**: –£–≤–µ–ª–∏—á–µ–Ω–∏–µ —Å 50.23% –¥–æ 55-65%
- **P/L Ratio**: –£–ª—É—á—à–µ–Ω–∏–µ —Å 1.01 –¥–æ 1.3-1.5
- **Bad Trades**: –°–Ω–∏–∂–µ–Ω–∏–µ —Å 31,352 –¥–æ 15,000-20,000
- **–°—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å**: –ú–µ–Ω—å—à–µ NaN –æ—à–∏–±–æ–∫ –∏ –±–æ–ª–µ–µ —Å—Ç–∞–±–∏–ª—å–Ω–æ–µ –æ–±—É—á–µ–Ω–∏–µ

## üõ†Ô∏è –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### 1. –û–±—É—á–µ–Ω–∏–µ
```python
from agents.vdqn.v_train_model import train_model

# –ó–∞–≥—Ä—É–∑–∏—Ç–µ –≤–∞—à–∏ –¥–∞–Ω–Ω—ã–µ
dfs = {
    'df_5min': df_5min,
    'df_15min': df_15min, 
    'df_1h': df_1h
}

# –ó–∞–ø—É—Å—Ç–∏—Ç–µ –æ–±—É—á–µ–Ω–∏–µ
result = train_model(dfs, load_previous=False, episodes=1000)
```

### 2. –ê–Ω–∞–ª–∏–∑ –†–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
```python
from agents.vdqn.analysis import (
    analyze_training_performance,
    plot_training_metrics,
    generate_training_report,
    optimize_hyperparameters
)

# –ê–Ω–∞–ª–∏–∑ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
analysis = analyze_training_performance(metrics_data)

# –ü–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ –≥—Ä–∞—Ñ–∏–∫–æ–≤
plot_training_metrics(metrics_data, save_path='training_analysis.png')

# –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ç—á–µ—Ç–∞
report = generate_training_report(metrics_data, trades, save_path='training_report.txt')

# –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –≥–∏–ø–µ—Ä–ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º
recommendations = optimize_hyperparameters(metrics_data, trades)
```

## ‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

–û—Å–Ω–æ–≤–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –≤ `cfg/vconfig.py`:

```python
# –ò—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ
eps_start: float = 1.0
eps_final: float = 0.01
eps_decay_steps: int = 50_000

# –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞
hidden_sizes: tuple = (512, 256, 128)
dropout_rate: float = 0.2
layer_norm: bool = True

# –û–±—É—á–µ–Ω–∏–µ
lr: float = 5e-4
gamma: float = 0.99
batch_size: int = 512
memory_size: int = 500_000

# PER
prioritized: bool = True
alpha: float = 0.6
beta: float = 0.4
```

## üîç –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –û–±—É—á–µ–Ω–∏—è

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –ú–µ—Ç—Ä–∏–∫–∏
- **Winrate —Ç—Ä–µ–Ω–¥**: –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –ø–æ—Å–ª–µ–¥–Ω–∏—Ö 10 —ç–ø–∏–∑–æ–¥–æ–≤ —Å –æ–±—â–∏–º–∏
- **NaN —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞**: –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∑–∞–º–µ–Ω–∞
- **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å**: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ª—É—á—à–∏—Ö –º–æ–¥–µ–ª–µ–π

### –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
- **–ö–∞–∂–¥—ã–µ 50 —à–∞–≥–æ–≤**: –û—Å–Ω–æ–≤–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏
- **–ö–∞–∂–¥—ã–µ 100 –≥—Ä–∞–¥–∏–µ–Ω—Ç–Ω—ã—Ö —à–∞–≥–æ–≤**: TD loss, Q-–∑–Ω–∞—á–µ–Ω–∏—è
- **–ö–∞–∂–¥—ã–µ 10,000 —à–∞–≥–æ–≤**: –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ replay buffer

## üö® –†–µ—à–µ–Ω–∏–µ –ü—Ä–æ–±–ª–µ–º

### –ù–∏–∑–∫–∏–π Winrate
1. –£–≤–µ–ª–∏—á–∏—Ç—å epsilon (–±–æ–ª—å—à–µ –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è)
2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å reward function
3. –î–æ–±–∞–≤–∏—Ç—å –±–æ–ª—å—à–µ –ø—Ä–∏–∑–Ω–∞–∫–æ–≤ –≤ —Å–æ—Å—Ç–æ—è–Ω–∏–µ

### –ú–Ω–æ–≥–æ Bad Trades
1. –£–ª—É—á—à–∏—Ç—å stop-loss —Å—Ç—Ä–∞—Ç–µ–≥–∏—é
2. –õ—É—á—à–∏–π timing –≤—Ö–æ–¥–∞
3. –ü—Ä–∞–≤–∏–ª–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ä–∏—Å–∫–∞–º–∏

### NaN –û—à–∏–±–∫–∏
1. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–º–µ–Ω—è—é—Ç—Å—è –Ω–∞ –Ω—É–ª–∏
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
3. –£–º–µ–Ω—å—à–∏—Ç–µ learning rate

### –ü–µ—Ä–µ–æ–±—É—á–µ–Ω–∏–µ
1. –£–≤–µ–ª–∏—á–∏—Ç—å dropout
2. –î–æ–±–∞–≤–∏—Ç—å —Ä–µ–≥—É–ª—è—Ä–∏–∑–∞—Ü–∏—é
3. Early stopping

## üìà –î–∞–ª—å–Ω–µ–π—à–∏–µ –£–ª—É—á—à–µ–Ω–∏—è

### –í–æ–∑–º–æ–∂–Ω—ã–µ –†–∞—Å—à–∏—Ä–µ–Ω–∏—è
1. **Multi-step Learning**: N-step returns –¥–ª—è –ª—É—á—à–µ–≥–æ –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
2. **Distributional DQN**: –û—Ü–µ–Ω–∫–∞ –Ω–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ—Å—Ç–∏
3. **Noisy Networks**: –ü–∞—Ä–∞–º–µ—Ç—Ä–∏—á–µ—Å–∫–∏–π —à—É–º –¥–ª—è –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è
4. **Rainbow DQN**: –ö–æ–º–±–∏–Ω–∞—Ü–∏—è –≤—Å–µ—Ö —É–ª—É—á—à–µ–Ω–∏–π

### –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ì–∏–ø–µ—Ä–ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
1. **Bayesian Optimization**: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–æ–∏—Å–∫ –ª—É—á—à–∏—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
2. **Population-based Training**: –≠–≤–æ–ª—é—Ü–∏–æ–Ω–Ω–∞—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è
3. **Hyperband**: –≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—ã–π –ø–æ–∏—Å–∫ –ø–æ —Å–µ—Ç–∫–µ

## üìù –ü—Ä–∏–º–µ—á–∞–Ω–∏—è

- –ú–æ–¥–µ–ª—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –∫–∞–∂–¥—ã–µ 100 —ç–ø–∏–∑–æ–¥–æ–≤
- –õ—É—á—à–∞—è –º–æ–¥–µ–ª—å —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –ø—Ä–∏ —É–ª—É—á—à–µ–Ω–∏–∏ winrate
- Early stopping —Å—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –ø–æ—Å–ª–µ 50 —ç–ø–∏–∑–æ–¥–æ–≤ –±–µ–∑ —É–ª—É—á—à–µ–Ω–∏–π
- –í—Å–µ –º–µ—Ç—Ä–∏–∫–∏ –ª–æ–≥–∏—Ä—É—é—Ç—Å—è –≤ CSV —Ñ–∞–π–ª –¥–ª—è –¥–∞–ª—å–Ω–µ–π—à–µ–≥–æ –∞–Ω–∞–ª–∏–∑–∞

## ü§ù –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ü—Ä–∏ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–∏ –ø—Ä–æ–±–ª–µ–º:
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –Ω–∞ –Ω–∞–ª–∏—á–∏–µ –æ—à–∏–±–æ–∫
2. –£–±–µ–¥–∏—Ç–µ—Å—å –≤ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç–∏ –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
3. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —É–º–µ–Ω—å—à–∏—Ç—å learning rate
4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å GPU –∏ –ø–∞–º—è—Ç—å
